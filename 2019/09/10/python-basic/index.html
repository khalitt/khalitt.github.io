<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>python-basic | null</title><meta name="keywords" content="python,basic"><meta name="author" content="Walter"><meta name="copyright" content="Walter"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="从两个list(key list，value list)构建dict直接用zip dictionay &#x3D; dict(zip(key, value))     嵌套zip就是先把一个zip的item，和另一个iterable的item拼在一起，和普通zip没区别 for node, value in zip(split_sorted_indices.tolist(),">
<meta property="og:type" content="article">
<meta property="og:title" content="python-basic">
<meta property="og:url" content="https://khalitt.github.io/2019/09/10/python-basic/index.html">
<meta property="og:site_name">
<meta property="og:description" content="从两个list(key list，value list)构建dict直接用zip dictionay &#x3D; dict(zip(key, value))     嵌套zip就是先把一个zip的item，和另一个iterable的item拼在一起，和普通zip没区别 for node, value in zip(split_sorted_indices.tolist(),">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2019-09-10T03:17:42.000Z">
<meta property="article:modified_time" content="2021-01-12T02:15:43.369Z">
<meta property="article:author" content="Walter">
<meta property="article:tag" content="python">
<meta property="article:tag" content="basic">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://khalitt.github.io/2019/09/10/python-basic/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"5100G1WE6M","apiKey":"c2a0f74ed768aa33e0c961937aa244bc","indexName":"prod_khalitt_github_io","hits":{"per_page":8},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'python-basic',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-01-12 10:15:43'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="null" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/null" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">55</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">45</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">20</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Music"><i class="fa-fw /music/"></i><span> 0</span></a></li><li><a class="site-page child" href="/Movie"><i class="fa-fw /movies/"></i><span> 1</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/"></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Music"><i class="fa-fw /music/"></i><span> 0</span></a></li><li><a class="site-page child" href="/Movie"><i class="fa-fw /movies/"></i><span> 1</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">python-basic</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2019-09-10T03:17:42.000Z" title="Created 2019-09-10 11:17:42">2019-09-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-01-12T02:15:43.369Z" title="Updated 2021-01-12 10:15:43">2021-01-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/python/">python</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">7.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>34min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="python-basic"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="从两个list-key-list，value-list-构建dict"><a href="#从两个list-key-list，value-list-构建dict" class="headerlink" title="从两个list(key list，value list)构建dict"></a>从两个list(key list，value list)构建dict</h2><p>直接用zip</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">dictionay <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>




<h2 id="嵌套zip"><a href="#嵌套zip" class="headerlink" title="嵌套zip"></a>嵌套zip</h2><p>就是先把一个zip的item，和另一个iterable的item拼在一起，和普通zip没区别</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> node<span class="token punctuation">,</span> value <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>split_sorted_indices<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                       <span class="token builtin">zip</span><span class="token punctuation">(</span>split_sorted_node_features<span class="token punctuation">,</span> split_sorted_eval_label<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> split_sorted_loss<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                           split_original_label<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    attr_dict <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'node_features'</span><span class="token punctuation">,</span> <span class="token string">'eval_label'</span><span class="token punctuation">,</span> <span class="token string">'loss'</span><span class="token punctuation">,</span> <span class="token string">'original_label'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>
    g<span class="token punctuation">.</span>add_node<span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token operator">**</span>attr_dict<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>




<h2 id="路径问题"><a href="#路径问题" class="headerlink" title="路径问题. / .."></a>路径问题. / ..</h2><p><img src="https://raw.githubusercontent.com/khalitt/IMG_REPO/master/20190917094641.png"></p>
<ol>
<li>.就是本层（本package folder内）</li>
<li>.. 就是parent层</li>
</ol>
<h2 id="logging-twice"><a href="#logging-twice" class="headerlink" title="logging twice"></a>logging twice</h2><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6729268/log-messages-appearing-twice-with-python-logging">log messages appearing twice with Python Logging</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">while</span> logger<span class="token punctuation">.</span>handlers<span class="token punctuation">:</span>
     logger<span class="token punctuation">.</span>handlers<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h2 id="list-extend-与-append的联系与区别"><a href="#list-extend-与-append的联系与区别" class="headerlink" title="list extend 与 append的联系与区别"></a>list extend 与 append的联系与区别</h2><ul>
<li>二者都可以接受一个整个list作为参数。</li>
<li>不同的是，extend是把那个list中每一个element<strong>逐个添加到原来的list中</strong>， 而append<strong>则是把整个list作为一个新的element插入到原来的list当中。</strong></li>
</ul>
<h2 id="nested-list-flatten的方法"><a href="#nested-list-flatten的方法" class="headerlink" title="nested list flatten的方法"></a>nested list flatten的方法</h2><p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/952914/how-to-make-a-flat-list-out-of-list-of-lists">how-to-make-a-flat-list-out-of-list-of-lists</a></p>
<ul>
<li><p>用一行式：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">flat_list <span class="token operator">=</span> <span class="token punctuation">[</span>item <span class="token keyword">for</span> sublist <span class="token keyword">in</span> l <span class="token keyword">for</span> item <span class="token keyword">in</span> sublist<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


</li>
</ul>
<h2 id="PIL-与-numpy互转"><a href="#PIL-与-numpy互转" class="headerlink" title="PIL 与 numpy互转"></a>PIL 与 numpy互转</h2><ul>
<li><p>转成numpy：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">numpy<span class="token punctuation">.</span>array<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>转成PIL image</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">PIL<span class="token punctuation">.</span>Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>array<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><strong>注意这个函数一次只能接受一个image（即array的shape应该为(C, H, W））</strong>，若要同时处理多个，应该用for 循环一行式</li>
</ul>
</li>
</ul>
<h2 id="把kwargs-作为class-attributes："><a href="#把kwargs-作为class-attributes：" class="headerlink" title="把kwargs 作为class attributes："></a>把kwargs 作为class attributes：</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">self<span class="token punctuation">.</span>__dict__<span class="token punctuation">.</span>update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8187082/how-can-you-set-class-attributes-from-variable-arguments-kwargs-in-python">how-can-you-set-class-attributes-from-variable-arguments-kwargs-in-python</a></p>
<h2 id="把args-kwargs不断传递：-与"><a href="#把args-kwargs不断传递：-与" class="headerlink" title="把args kwargs不断传递：* 与 **"></a>把args kwargs不断传递：* 与 **</h2><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/44928140/how-to-pass-a-args-kwargs-type-of-attribute-to-a-function-within-class">how-to-pass-a-args-kwargs-type-of-attribute-to-a-function-within-class</a></p>
<h2 id="dict合并的方法"><a href="#dict合并的方法" class="headerlink" title="dict合并的方法"></a>dict合并的方法</h2><p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Jerry_1126/article/details/73017270">Python中字典合并的四种方法</a></p>
<ul>
<li>dict(ditc.items() + dict.items())</li>
</ul>
<h3 id="推荐用update的方法-dict-update-dict2"><a href="#推荐用update的方法-dict-update-dict2" class="headerlink" title="推荐用update的方法(dict.update(dict2))"></a>推荐用update的方法(dict.update(dict2))</h3><p>但是要注意的是，不能直接把updated list赋值给一个新的变量，新的变量会是NoneType，即如下的代码是无效的：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">new_dict <span class="token operator">=</span> old_dict<span class="token punctuation">.</span>update<span class="token punctuation">(</span>dict2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>正确的应该如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">new_dict<span class="token operator">=</span>old_dict
new_dict<span class="token punctuation">.</span>update<span class="token punctuation">(</span>dict2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h2 id="iter与next的使用"><a href="#iter与next的使用" class="headerlink" title="iter与next的使用"></a>iter与next的使用</h2><ul>
<li><p><code>iter()</code>首先作用于iterable（可迭代对象）上面（比如list），得到一个iterator</p>
</li>
<li><p><code>next()</code>再作用在由<code>iter()</code>生成的iterator，不断输出其中的值，直至结尾 / <strong>或者直接调用<code>iterator.next()</code>获得下一个元素</strong></p>
</li>
<li><p>若要重新开始，则再用一次<code>iter()</code>得到新的iterator，再用next</p>
</li>
<li><p>next<strong>可以添加当下一个元素为空时的返回值</strong>（即default)，<strong>这个非常有用</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">next</span><span class="token punctuation">(</span>iterator<span class="token punctuation">[</span><span class="token punctuation">,</span> default<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>可参考<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/4407157/how-to-use-python-iterators-elegantly">how-to-use-python-iterators-elegantly</a></p>
</li>
<li><p>每call一次next，<strong>只输出一个值</strong>，因此需要<strong>不断地调用next</strong>，才能不断地输出。</p>
</li>
<li><p>例子：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">ld3 <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
iterator <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>ld3<span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>iterator<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> StopIteration<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
        
<span class="token operator">>></span><span class="token operator">></span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上述例子把整个list print完</p>
</li>
</ul>
<h3 id="通过for-StopIteration控制读取次数："><a href="#通过for-StopIteration控制读取次数：" class="headerlink" title="通过for + StopIteration控制读取次数："></a>通过for + StopIteration控制读取次数：</h3><p>下面的例子通过for，输出5个batch</p>
  <pre class="line-numbers language-python" data-language="python"><code class="language-python">ld3 <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
iterator <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>ld3<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>iterator<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> StopIteration<span class="token punctuation">:</span>
        iterator <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>ld3<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>iterator<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  <pre class="line-numbers language-none"><code class="language-none">tensor([1, 2])
tensor([3, 4])
tensor([1, 2])
tensor([3, 4])
tensor([1, 2])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="通过for-next-默认值控制循环次数："><a href="#通过for-next-默认值控制循环次数：" class="headerlink" title="通过for + next 默认值控制循环次数："></a>通过for + next 默认值控制循环次数：</h3><p>注意在for循环中需要不断地赋值（调用next）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">ld3 <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
iterator <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>ld3<span class="token punctuation">)</span>
next_item <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>iterator<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> next_item <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>next_item<span class="token punctuation">)</span>
        next_item <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>iterator<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        iterator <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>ld3<span class="token punctuation">)</span>
        next_item <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>iterator<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>next_item<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">tensor([1, 2])
tensor([3, 4])
tensor([1, 2])
tensor([1, 2])
tensor([3, 4])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="通过next的default-value控制多个iterator："><a href="#通过next的default-value控制多个iterator：" class="headerlink" title="通过next的default value控制多个iterator："></a>通过next的default value控制多个iterator：</h3><p>ld4循环一次，ld5循环两次</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">ld4 <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
ld5 <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>
iterator4 <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>ld4<span class="token punctuation">)</span>
iterator5 <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>ld5<span class="token punctuation">)</span>
next_ld4 <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>iterator4<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
next_ld5 <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>iterator5<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> next_ld4 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>next_ld4<span class="token punctuation">,</span> next_ld5<span class="token punctuation">)</span>
    next_ld4 <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>iterator4<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
    next_ld5 <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>iterator5<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> next_ld5 <span class="token keyword">is</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
        iterator5 <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>ld5<span class="token punctuation">)</span>
        next_ld5 <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>iterator5<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">tensor([0, 1, 2]) tensor([0, 1, 2, 3, 4, 5])
tensor([3, 4, 5]) tensor([ 6,  7,  8,  9, 10, 11])
tensor([6, 7, 8]) tensor([0, 1, 2, 3, 4, 5])
tensor([ 9, 10, 11]) tensor([ 6,  7,  8,  9, 10, 11])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="也可通过for-while-loop控制多个循环："><a href="#也可通过for-while-loop控制多个循环：" class="headerlink" title="也可通过for + while loop控制多个循环："></a>也可通过for + while loop控制多个循环：</h3><p>更加直观（不用控制最外层的循环），但要注意在在except中要<strong>初始化iterator</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">ld4 <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
ld5 <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>
iterator4 <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>ld4<span class="token punctuation">)</span>
iterator5 <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>ld5<span class="token punctuation">)</span>

<span class="token keyword">for</span> next_ld4 <span class="token keyword">in</span> iterator4<span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        next_ld5 <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>iterator5<span class="token punctuation">)</span>
    <span class="token keyword">except</span> StopIteration<span class="token punctuation">:</span>
        iterator5 <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>ld5<span class="token punctuation">)</span>
        next_ld5 <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>iterator5<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>next_ld4<span class="token punctuation">,</span> next_ld5<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">tensor([0, 1, 2]) tensor([0, 1, 2, 3, 4, 5])
tensor([3, 4, 5]) tensor([ 6,  7,  8,  9, 10, 11])
tensor([6, 7, 8]) tensor([0, 1, 2, 3, 4, 5])
tensor([ 9, 10, 11]) tensor([ 6,  7,  8,  9, 10, 11])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="可以用容器（container）来装iterator，比如list"><a href="#可以用容器（container）来装iterator，比如list" class="headerlink" title="可以用容器（container）来装iterator，比如list"></a>可以用容器（container）来装iterator，比如list</h3><p>如果想一次过看完整个iterator所包含的元素，可以用list tuple的容器装起来，就可以一次过迭代完成了</p>
<h2 id="iter-iter-iterable-iterator-的联系与区别："><a href="#iter-iter-iterable-iterator-的联系与区别：" class="headerlink" title="__iter__, iter(), iterable, iterator 的联系与区别："></a><code>__iter__</code>, <code>iter()</code>, <code>iterable</code>, <code>iterator</code> 的联系与区别：</h2><p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/440150861">python的迭代器为什么一定要实现__iter__方法？</a> 说的比较清楚，参考前面两个答案，<strong>第一个答案还解释了python中for循环所支持的两种机制</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/dcf83643deeb">参考其中迭代器的定义</a></p>
<p>由第二个答案，可以有四个概念（两个类，两个对象，类主要是定义形式，对象就是具体实践这些规则的执行者）：</p>
<ol>
<li>可迭代类 class collections.abc.Iterable：包含<code>__iter__</code>或者<code>__getitem__</code>的类</li>
<li>迭代器类 class collections.abc.Iterator：需要同时包含<code>__iter__</code>和<code>__next__</code></li>
<li>可迭代对象（iterable）：实现了<code>__iter__</code>或者<code>__getitem__</code>方法的对象，如list, tuple, str等等。(对应1)</li>
<li>迭代器对象(iterator)：实现了<code>__next__</code>的类（对应2）</li>
</ol>
<p>综上，</p>
<ol>
<li>从字面意思看，iterator主要是为了取出元素，而iterable则表示支持迭代这一种属性</li>
<li>但因为iterator 实现了<code>__iter__</code>，所以iterator一定是 iterable (因为实现了<code>__iter__</code>方法)，<strong>因此iterable是比iterator更大的而概念</strong></li>
<li>至于为什么要实现<code>__iter__</code>方法(显而易见，iterator为了取出元素只需要<code>__next__</code>方法就好了)： 则是为了接口的统一，让iterator自己也能像iterable那样被<code>for in</code>的语句处理。否则对于一个返回iterator的方法来说就会变得很不方便，<strong>需要先返回一个iterable的对象，然后再让iterable返回一个iterator</strong></li>
</ol>
<p>而<code>iter()</code>的实现，则是为了取出那个对象的对应的迭代器iterator，有了iterator之后就可以用<code>next</code>遍历元素了了</p>
<h2 id="获取新list"><a href="#获取新list" class="headerlink" title="获取新list"></a>获取新list</h2><h3 id="直接extend或者append是不行的"><a href="#直接extend或者append是不行的" class="headerlink" title="直接extend或者append是不行的"></a>直接extend或者append是不行的</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">l1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
l2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
l3 <span class="token operator">=</span> l1<span class="token punctuation">.</span>append<span class="token punctuation">(</span>l2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>上述式子<code>l3</code>为<code>None</code>，因为<code>extend</code>或者<code>append</code>都是inplace操作</p>
<p>具体方法参考：</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2612802/how-to-clone-or-copy-a-list">how-to-clone-or-copy-a-list</a></p>
<h3 id="浅拷贝（list内的元素不复制）"><a href="#浅拷贝（list内的元素不复制）" class="headerlink" title="浅拷贝（list内的元素不复制）"></a>浅拷贝（list内的元素不复制）</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">new_list <span class="token operator">=</span> old_list<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">new_list &#x3D; old_list[:]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">new_list &#x3D; list(old_list)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">import copy
new_list &#x3D; copy.copy(old_list)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Better this way when dealing with two lists</span>
new_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">*</span>old_list_1<span class="token punctuation">,</span> <span class="token operator">*</span>old_list_2<span class="token punctuation">]</span>

<span class="token comment"># or </span>
new_list <span class="token operator">=</span> old_list_1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> old_list_2<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="深拷贝（list内的元素也复制一次）"><a href="#深拷贝（list内的元素也复制一次）" class="headerlink" title="深拷贝（list内的元素也复制一次）"></a>深拷贝（list内的元素也复制一次）</h3><pre class="line-numbers language-none"><code class="language-none">import copy
new_list &#x3D; copy.deepcopy(old_list)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h2 id="sorted函数用法"><a href="#sorted函数用法" class="headerlink" title="sorted函数用法"></a>sorted函数用法</h2><h3 id="对多个指标排序-Multiple-keys-sorting"><a href="#对多个指标排序-Multiple-keys-sorting" class="headerlink" title="对多个指标排序 Multiple keys sorting"></a>对多个指标排序 Multiple keys sorting</h3><p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/3/howto/sorting.html#operator-module-functions">operator-module-functions</a></p>
<p>通过指定顺序即可（排在前面的先排序）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> student_objects <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     Student<span class="token punctuation">(</span><span class="token string">'john'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     Student<span class="token punctuation">(</span><span class="token string">'jane'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     Student<span class="token punctuation">(</span><span class="token string">'dave'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>student_objects<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> student<span class="token punctuation">:</span> student<span class="token punctuation">.</span>age<span class="token punctuation">)</span>   <span class="token comment"># sort by age</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'dave'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'jane'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'john'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> operator <span class="token keyword">import</span> itemgetter<span class="token punctuation">,</span> attrgetter
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>student_objects<span class="token punctuation">,</span> key<span class="token operator">=</span>attrgetter<span class="token punctuation">(</span><span class="token string">'grade'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'john'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'dave'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'jane'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<h3 id="直接用lambda函数"><a href="#直接用lambda函数" class="headerlink" title="直接用lambda函数"></a>直接用lambda函数</h3><p>同样也能实现多个key效果，<strong>注意lambda函数内部应该返回一个tuple</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">files_name_sorted <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>files_name<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
files_name_sorted<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>输出</p>
<pre class="line-numbers language-none"><code class="language-none">[&#39;group_by_future_user_search_behaviour_20200406_20200407.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200406_20200408.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200406_20200409.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200406_20200410.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200406_20200411.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200406_20200412.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200406_20200413.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200407_20200408.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200407_20200409.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200407_20200410.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200407_20200411.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200407_20200412.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200407_20200413.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200407_20200414.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200408_20200409.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200408_20200410.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200408_20200411.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200408_20200412.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200408_20200413.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200408_20200414.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200408_20200415.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200409_20200410.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200409_20200411.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200409_20200412.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200409_20200413.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200409_20200414.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200409_20200415.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200409_20200416.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200410_20200411.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200410_20200412.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200410_20200413.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200410_20200414.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200410_20200415.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200410_20200416.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200410_20200417.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200411_20200412.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200411_20200413.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200411_20200414.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200411_20200415.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200411_20200416.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200411_20200417.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200411_20200418.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200412_20200413.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200412_20200414.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200412_20200415.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200412_20200416.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200412_20200417.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200412_20200418.csv&#39;,
 &#39;group_by_future_user_search_behaviour_20200412_20200419.csv&#39;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="排序的同时返回索引"><a href="#排序的同时返回索引" class="headerlink" title="排序的同时返回索引"></a>排序的同时返回索引</h3><p>参考</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>
<span class="token keyword">from</span> operator <span class="token keyword">import</span> itemgetter
indices<span class="token punctuation">,</span> L_sorted <span class="token operator">=</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">enumerate</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span>itemgetter<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token builtin">list</span><span class="token punctuation">(</span>L_sorted<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token builtin">list</span><span class="token punctuation">(</span>indices<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>本质上是把<code>enuemrate</code>的输出5个<code>tuple</code>按照key(即第一个变量)进行排序, 然后再用<code>zip(*)</code>实现解压, 变回两个tuple, <strong>更直接的方法是再套一个<code>map</code>, 注意<code>map</code>的第一个参数是<code>function</code>, 第二个才是<code>iterable object</code>!!!!!</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">In <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span> L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span> <span class="token keyword">from</span> operator <span class="token keyword">import</span> itemgetter

In <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">enumerate</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span>itemgetter<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span><span class="token builtin">zip</span> at <span class="token number">0x154dddb2848</span><span class="token operator">></span>

In <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">:</span> s<span class="token punctuation">,</span> r <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">,</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">enumerate</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span>itemgetter<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">:</span> s
Out<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>

In <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">:</span> r
Out<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>同时也要注意, 返回的indices是<strong>从1开始的!!, 而不是0</strong></p>
<h2 id="与-的用法"><a href="#与-的用法" class="headerlink" title="* 与 **的用法"></a>* 与 **的用法</h2><p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/36901/what-does-double-star-asterisk-and-star-asterisk-do-for-parameters">what-does-double-star-asterisk-and-star-asterisk-do-for-parameters</a></p>
<h3 id="的两种用法"><a href="#的两种用法" class="headerlink" title="*的两种用法"></a>*的两种用法</h3><ul>
<li>用于*args 或者 **kwargs</li>
<li>用于 *<em>unpack iterables，比如</em>list等价于把list中的内容摊开**</li>
</ul>
<h3 id="查看module位置-file"><a href="#查看module位置-file" class="headerlink" title="查看module位置:__file__"></a>查看module位置:<code>__file__</code></h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> dgl
<span class="token keyword">print</span><span class="token punctuation">(</span>dgl<span class="token punctuation">.</span>__file__<span class="token punctuation">)</span>
<span class="token operator">/</span>home<span class="token operator">/</span>weitaotang<span class="token operator">/</span><span class="token punctuation">.</span>local<span class="token operator">/</span>lib<span class="token operator">/</span>python3<span class="token punctuation">.</span><span class="token number">6</span><span class="token operator">/</span>site<span class="token operator">-</span>packages<span class="token operator">/</span>dgl<span class="token operator">/</span>__init__<span class="token punctuation">.</span>py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<h2 id="更改module导入的顺序：修改PYTHONPATH"><a href="#更改module导入的顺序：修改PYTHONPATH" class="headerlink" title="更改module导入的顺序：修改PYTHONPATH"></a>更改module导入的顺序：修改PYTHONPATH</h2><p>导入<code>sys</code>模块，然后通过<code>sys.path</code>修改。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys
p <span class="token operator">=</span> sys<span class="token punctuation">.</span>path
temporary <span class="token operator">=</span> p<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temporary<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>如此就成功把原来的</p>
<h3 id="conda-rename-env：只能先复制再删除"><a href="#conda-rename-env：只能先复制再删除" class="headerlink" title="conda rename env：只能先复制再删除"></a>conda rename env：只能先复制再删除</h3><p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/42231764/how-can-i-rename-a-conda-environment">how-can-i-rename-a-conda-environment)</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">conda create <span class="token operator">-</span><span class="token operator">-</span>name new_name <span class="token operator">-</span><span class="token operator">-</span>clone old_name
conda remove <span class="token operator">-</span><span class="token operator">-</span>name old_name <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">all</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h3 id="conda-env在jupyter-lab中显示"><a href="#conda-env在jupyter-lab中显示" class="headerlink" title="conda env在jupyter lab中显示"></a>conda env在jupyter lab中显示</h3><p>参考</p>
<p><a target="_blank" rel="noopener" href="https://ipython.readthedocs.io/en/stable/install/kernel_install.html#kernels-for-different-environments">kernels-for-different-environments</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/39604271/conda-environments-not-showing-up-in-jupyter-notebook">conda-environments-not-showing-up-in-jupyter-notebook</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">source activate myenv
python <span class="token operator">-</span>m ipykernel install <span class="token operator">-</span><span class="token operator">-</span>user <span class="token operator">-</span><span class="token operator">-</span>name myenv <span class="token operator">-</span><span class="token operator">-</span>display<span class="token operator">-</span>name <span class="token string">"Python (myenv)"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h3 id="logging的时候更改写入模式-FileHandler的mode参数"><a href="#logging的时候更改写入模式-FileHandler的mode参数" class="headerlink" title="logging的时候更改写入模式: FileHandler的mode参数"></a>logging的时候更改写入模式: FileHandler的mode参数</h3><p>默认是<code>mode = a</code>即每一次都追加到最后，如果要每一次都重新打开新的文件就用w吧</p>
<h3 id="把tuple变回list"><a href="#把tuple变回list" class="headerlink" title="把tuple变回list"></a>把tuple变回list</h3><p>[<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/12974474/how-to-unzip-a-list-of-tuples-into-individual-lists">How to unzip a list of tuples into individual lists? [duplicate]](https://stackoverflow.com/questions/12974474/how-to-unzip-a-list-of-tuples-into-individual-lists)</a></p>
<p><code>*</code>能够把list摊开来（变成一个个tuple），然后用<code>zip</code>把它们拼起来</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">list</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h2 id="离散的indices（arbitrary-indices）"><a href="#离散的indices（arbitrary-indices）" class="headerlink" title="离散的indices（arbitrary indices）"></a>离散的indices（arbitrary indices）</h2><h3 id="按照离散的indices-获取list中的index"><a href="#按照离散的indices-获取list中的index" class="headerlink" title="按照离散的indices 获取list中的index"></a>按照离散的indices 获取list中的index</h3><p>逐个返回然后拼起来</p>
<pre class="line-numbers language-none"><code class="language-none">idx &#x3D; [l.index(item) for item in query_list]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="用离散的indices来索引"><a href="#用离散的indices来索引" class="headerlink" title="用离散的indices来索引"></a>用离散的indices来索引</h3><p>用<a target="_blank" rel="noopener" href="https://docs.python.org/3.6/library/operator.html#operator.itemgetter">itemgetter</a></p>
<ol>
<li><p>用<code>*</code>辅助，默认返回是tuple，再加上一个list</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> operator <span class="token keyword">import</span> itemgetter
query_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>
original_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
item_wanted <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>itemgetter<span class="token punctuation">(</span><span class="token operator">*</span>query_list<span class="token punctuation">)</span><span class="token punctuation">(</span>original_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>用<code>map</code>辅助，同样在外面套上list。<strong>适用于提取tuple中的item作为key</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> inventory <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'banana'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'pear'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'orange'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> getcount <span class="token operator">=</span> itemgetter<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>getcount<span class="token punctuation">,</span> inventory<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>inventory<span class="token punctuation">,</span> key<span class="token operator">=</span>getcount<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'orange'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'banana'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'pear'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


</li>
</ol>
<h2 id="查看object的attribute"><a href="#查看object的attribute" class="headerlink" title="查看object的attribute"></a>查看object的attribute</h2><h3 id="通过-dict"><a href="#通过-dict" class="headerlink" title="通过__dict__"></a>通过<code>__dict__</code></h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">isinstance</span><span class="token punctuation">(</span>val_subdataset<span class="token punctuation">,</span> <span class="token builtin">object</span><span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">76</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token boolean">True</span>
val_subdataset<span class="token punctuation">.</span>__dict__<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">77</span><span class="token punctuation">]</span><span class="token punctuation">:</span> dict_keys<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'_original_labels'</span><span class="token punctuation">,</span> <span class="token string">'original_index'</span><span class="token punctuation">,</span> <span class="token string">'labels'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="通过vars（实际也是查看-dict"><a href="#通过vars（实际也是查看-dict" class="headerlink" title="通过vars（实际也是查看__dict__)"></a>通过vars（实际也是查看<code>__dict__</code>)</h3><pre class="line-numbers language-none"><code class="language-none">isinstance(val_subdataset, object)
Out[78]: True
vars(val_subdataset).keys()
Out[79]: dict_keys([&#39;data&#39;, &#39;_original_labels&#39;, &#39;original_index&#39;, &#39;labels&#39;])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>没有<code>__dict__</code>的报错：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">vars</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>g_list<span class="token punctuation">)</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"/home/weitaotang/.conda/envs/tfpt_cpu/lib/python3.6/site-packages/IPython/core/interactiveshell.py"</span><span class="token punctuation">,</span> line <span class="token number">3326</span><span class="token punctuation">,</span> <span class="token keyword">in</span> run_code
    <span class="token keyword">exec</span><span class="token punctuation">(</span>code_obj<span class="token punctuation">,</span> self<span class="token punctuation">.</span>user_global_ns<span class="token punctuation">,</span> self<span class="token punctuation">.</span>user_ns<span class="token punctuation">)</span>
  File <span class="token string">"&lt;ipython-input-74-c79c10a82ac7>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
    <span class="token builtin">vars</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>g_list<span class="token punctuation">)</span>
TypeError<span class="token punctuation">:</span> <span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span> argument must have __dict__ attribute<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="通过-dir-或者dir-列出全部"><a href="#通过-dir-或者dir-列出全部" class="headerlink" title="通过__dir__() 或者dir() 列出全部"></a>通过<code>__dir__()</code> 或者<code>dir()</code> 列出全部</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">val_subdataset<span class="token punctuation">.</span>__dir__<span class="token punctuation">(</span><span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">:</span> 
<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">,</span>
 <span class="token string">'_original_labels'</span><span class="token punctuation">,</span>
 <span class="token string">'original_index'</span><span class="token punctuation">,</span>
 <span class="token string">'labels'</span><span class="token punctuation">,</span>
 <span class="token string">'__module__'</span><span class="token punctuation">,</span>
 <span class="token string">'__init__'</span><span class="token punctuation">,</span>
 <span class="token string">'__len__'</span><span class="token punctuation">,</span>
 <span class="token string">'__getitem__'</span><span class="token punctuation">,</span>
 <span class="token string">'getitem_o'</span><span class="token punctuation">,</span>
 <span class="token string">'update_labels'</span><span class="token punctuation">,</span>
 <span class="token string">'original_labels'</span><span class="token punctuation">,</span>
 <span class="token string">'__doc__'</span><span class="token punctuation">,</span>
 <span class="token string">'__add__'</span><span class="token punctuation">,</span>
 <span class="token string">'__dict__'</span><span class="token punctuation">,</span>
 <span class="token string">'__weakref__'</span><span class="token punctuation">,</span>
 <span class="token string">'__repr__'</span><span class="token punctuation">,</span>
 <span class="token string">'__hash__'</span><span class="token punctuation">,</span>
 <span class="token string">'__str__'</span><span class="token punctuation">,</span>
 <span class="token string">'__getattribute__'</span><span class="token punctuation">,</span>
 <span class="token string">'__setattr__'</span><span class="token punctuation">,</span>
 <span class="token string">'__delattr__'</span><span class="token punctuation">,</span>
 <span class="token string">'__lt__'</span><span class="token punctuation">,</span>
 <span class="token string">'__le__'</span><span class="token punctuation">,</span>
 <span class="token string">'__eq__'</span><span class="token punctuation">,</span>
 <span class="token string">'__ne__'</span><span class="token punctuation">,</span>
 <span class="token string">'__gt__'</span><span class="token punctuation">,</span>
 <span class="token string">'__ge__'</span><span class="token punctuation">,</span>
 <span class="token string">'__new__'</span><span class="token punctuation">,</span>
 <span class="token string">'__reduce_ex__'</span><span class="token punctuation">,</span>
 <span class="token string">'__reduce__'</span><span class="token punctuation">,</span>
 <span class="token string">'__subclasshook__'</span><span class="token punctuation">,</span>
 <span class="token string">'__init_subclass__'</span><span class="token punctuation">,</span>
 <span class="token string">'__format__'</span><span class="token punctuation">,</span>
 <span class="token string">'__sizeof__'</span><span class="token punctuation">,</span>
 <span class="token string">'__dir__'</span><span class="token punctuation">,</span>
 <span class="token string">'__class__'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">dir</span><span class="token punctuation">(</span>val_subdataset<span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">81</span><span class="token punctuation">]</span><span class="token punctuation">:</span> 
<span class="token punctuation">[</span><span class="token string">'__add__'</span><span class="token punctuation">,</span>
 <span class="token string">'__class__'</span><span class="token punctuation">,</span>
 <span class="token string">'__delattr__'</span><span class="token punctuation">,</span>
 <span class="token string">'__dict__'</span><span class="token punctuation">,</span>
 <span class="token string">'__dir__'</span><span class="token punctuation">,</span>
 <span class="token string">'__doc__'</span><span class="token punctuation">,</span>
 <span class="token string">'__eq__'</span><span class="token punctuation">,</span>
 <span class="token string">'__format__'</span><span class="token punctuation">,</span>
 <span class="token string">'__ge__'</span><span class="token punctuation">,</span>
 <span class="token string">'__getattribute__'</span><span class="token punctuation">,</span>
 <span class="token string">'__getitem__'</span><span class="token punctuation">,</span>
 <span class="token string">'__gt__'</span><span class="token punctuation">,</span>
 <span class="token string">'__hash__'</span><span class="token punctuation">,</span>
 <span class="token string">'__init__'</span><span class="token punctuation">,</span>
 <span class="token string">'__init_subclass__'</span><span class="token punctuation">,</span>
 <span class="token string">'__le__'</span><span class="token punctuation">,</span>
 <span class="token string">'__len__'</span><span class="token punctuation">,</span>
 <span class="token string">'__lt__'</span><span class="token punctuation">,</span>
 <span class="token string">'__module__'</span><span class="token punctuation">,</span>
 <span class="token string">'__ne__'</span><span class="token punctuation">,</span>
 <span class="token string">'__new__'</span><span class="token punctuation">,</span>
 <span class="token string">'__reduce__'</span><span class="token punctuation">,</span>
 <span class="token string">'__reduce_ex__'</span><span class="token punctuation">,</span>
 <span class="token string">'__repr__'</span><span class="token punctuation">,</span>
 <span class="token string">'__setattr__'</span><span class="token punctuation">,</span>
 <span class="token string">'__sizeof__'</span><span class="token punctuation">,</span>
 <span class="token string">'__str__'</span><span class="token punctuation">,</span>
 <span class="token string">'__subclasshook__'</span><span class="token punctuation">,</span>
 <span class="token string">'__weakref__'</span><span class="token punctuation">,</span>
 <span class="token string">'_original_labels'</span><span class="token punctuation">,</span>
 <span class="token string">'data'</span><span class="token punctuation">,</span>
 <span class="token string">'getitem_o'</span><span class="token punctuation">,</span>
 <span class="token string">'labels'</span><span class="token punctuation">,</span>
 <span class="token string">'original_index'</span><span class="token punctuation">,</span>
 <span class="token string">'original_labels'</span><span class="token punctuation">,</span>
 <span class="token string">'update_labels'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




<h3 id="判断dict是否用某key：用in"><a href="#判断dict是否用某key：用in" class="headerlink" title="判断dict是否用某key：用in"></a>判断dict是否用某key：用<code>in</code></h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> key <span class="token keyword">is</span> <span class="token keyword">in</span> <span class="token builtin">dict</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h2 id="Ipdb-pdb条件断点设置"><a href="#Ipdb-pdb条件断点设置" class="headerlink" title="Ipdb/pdb条件断点设置"></a>Ipdb/pdb条件断点设置</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">break</span> line_number<span class="token punctuation">,</span> condition<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>or</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">b line_number<span class="token punctuation">,</span> condition<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://ikhlestov.github.io/pages/languages/python/packages/ipdb/">ipdb notes</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/17280575/pdb-ipdb-for-python-break-on-editable-condition">pdb-ipdb-for-python-break-on-editable-condition</a></p>
<h2 id="Argparser-部分使用技巧"><a href="#Argparser-部分使用技巧" class="headerlink" title="Argparser 部分使用技巧"></a>Argparser 部分使用技巧</h2><h3 id="args以dict形式返回：vars"><a href="#args以dict形式返回：vars" class="headerlink" title="args以dict形式返回：vars()"></a>args以dict形式返回：vars()</h3><p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/3.2/library/argparse.html#the-namespace-object">the-namespace-object)</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">vars</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h3 id="Partial-parse：-parse-known-args"><a href="#Partial-parse：-parse-known-args" class="headerlink" title="Partial parse：.parse_known_args"></a>Partial parse：<code>.parse_known_args</code></h3><p><a target="_blank" rel="noopener" href="https://docs.python.org/3.2/library/argparse.html#partial-parsing">partial-parsing</a></p>
<p>还会把无法解析的args一并返回到一个list里面</p>
<h3 id="部分parse（remove-unnecessary-args）：通过dict删除或者用sub-parser"><a href="#部分parse（remove-unnecessary-args）：通过dict删除或者用sub-parser" class="headerlink" title="部分parse（remove unnecessary args）：通过dict删除或者用sub parser"></a>部分parse（remove unnecessary args）：通过dict删除或者用<a target="_blank" rel="noopener" href="https://docs.python.org/3.2/library/argparse.html#argparse.ArgumentParser.add_subparsers">sub parser</a></h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Ignore args by dict</span>
args <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> <span class="token builtin">vars</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token keyword">if</span> v <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token comment"># Ignore items that are None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>




<h3 id="pdb-ipdb-在其他文件添加断点"><a href="#pdb-ipdb-在其他文件添加断点" class="headerlink" title="pdb/ipdb 在其他文件添加断点"></a>pdb/ipdb 在其他文件添加断点</h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/46317180/pdb-set-a-breakpoint-on-file-which-isnt-in-sys-path">pdb-set-a-breakpoint-on-file-which-isnt-in-sys-path</a></p>
<pre class="line-numbers language-none"><code class="language-none">b(reak) [[filename:]lineno | function[, condition]]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">b &#x2F;path&#x2F;to&#x2F;module.py:34
&gt; Breakpoint 1 at &#x2F;path&#x2F;to&#x2F;module.py:34<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h3 id="获取variable的name"><a href="#获取variable的name" class="headerlink" title="获取variable的name"></a>获取variable的name</h3><p>不可能，因为可能多个name都对应到同一个variable，那这个name就不是唯一的了</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/q/18425225">https://stackoverflow.com/q/18425225</a></p>
<h2 id="获取相对路径："><a href="#获取相对路径：" class="headerlink" title="获取相对路径："></a>获取相对路径：</h2><p>参考这个</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/57292232">ValueError: attempted relative import beyond top-level package</a></p>
<h2 id="python-同级目录包import问题，使用”-”错误"><a href="#python-同级目录包import问题，使用”-”错误" class="headerlink" title="python 同级目录包import问题，使用”.”错误"></a>python 同级目录包import问题，使用”.”错误</h2><p>参考最后的3：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/liuda9495/p/8351978.html">python 同级目录包导入问题，使用”.”错误</a></p>
<p>额外参考：<a target="_blank" rel="noopener" href="https://alex.dzyoba.com/blog/python-import/">Hitchhiker’s guide to the Python imports</a></p>
<h3 id="使用shell文件来运行python文件：注意路径"><a href="#使用shell文件来运行python文件：注意路径" class="headerlink" title="使用shell文件来运行python文件：注意路径"></a>使用shell文件来运行python文件：注意路径</h3><p>当使用shell script，在script其中输入python xxx.py指令时，此时<code>&#39;.&#39;</code>对应的是 <strong>shell  script的目录，而不是python script的目录</strong></p>
<h3 id="更改文件路径到当前目录："><a href="#更改文件路径到当前目录：" class="headerlink" title="更改文件路径到当前目录："></a>更改文件路径到当前目录：</h3><ul>
<li><p>思路：获取当前路径的dirname，然后chdir即可</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>




</li>
</ul>
<h2 id="argparser使用bool的问题："><a href="#argparser使用bool的问题：" class="headerlink" title="argparser使用bool的问题："></a>argparser使用bool的问题：</h2><p> <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/15008758/parsing-boolean-values-with-argparse/19233287">https://stackoverflow.com/questions/15008758/parsing-boolean-values-with-argparse/19233287</a> </p>
<ul>
<li><p><code>type=bool</code>是不行的，所有字符默认都被cast成True，<strong>即无论输入什么参数这个选项都会是True</strong></p>
</li>
<li><p>因此需要单独设置：</p>
<ul>
<li><p>可以通过设置两个exclusive的选项，分别store_true, store_false</p>
</li>
<li><p>也可以通过设置choise，先默认成str，然后再用if语句映射：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> <span class="token string">'pydev_debug'</span> <span class="token keyword">in</span> args<span class="token punctuation">:</span>
    <span class="token keyword">if</span> args<span class="token punctuation">[</span><span class="token string">'pydev_debug'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'True'</span><span class="token punctuation">:</span>
        args<span class="token punctuation">[</span><span class="token string">'pydev_debug'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        args<span class="token punctuation">[</span><span class="token string">'pydev_debug'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ul>
</li>
</ul>
<h2 id="获取object的大小"><a href="#获取object的大小" class="headerlink" title="获取object的大小"></a>获取object的大小</h2><h3 id="python内建的object的大小：sys-getsizeof"><a href="#python内建的object的大小：sys-getsizeof" class="headerlink" title="python内建的object的大小：sys.getsizeof()"></a>python内建的object的大小：<code>sys.getsizeof()</code></h3><h3 id="numpy-array的大小"><a href="#numpy-array的大小" class="headerlink" title="numpy array的大小"></a>numpy array的大小</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">array<span class="token punctuation">.</span>size <span class="token operator">*</span> array<span class="token punctuation">.</span>itemsize<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h2 id="在多个module（file）之间共享变量"><a href="#在多个module（file）之间共享变量" class="headerlink" title="在多个module（file）之间共享变量"></a>在多个module（file）之间共享变量</h2><p>参考 </p>
<ol>
<li><p><a target="_blank" rel="noopener" href="https://docs.python.org/3/faq/programming.html?highlight=global#how-do-i-share-global-variables-across-modules">How do I share global variables across modules</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/q/13034496">Using global variables between files</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/41978471">Access to global variable across modules and staticmethods in Python</a></p>
</li>
</ol>
<p>可以把所有需要共享的变量都放在一个py文件（一个module）中，然后其他各个需要用到这些变量的py文件都import这个module，如此就能实现复用。</p>
<h2 id="multiple-line-string的做法："><a href="#multiple-line-string的做法：" class="headerlink" title="multiple line string的做法："></a>multiple line string的做法：</h2><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/10660443">Pythonic way to create a long multi-line string</a>    </p>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/3.7/tutorial/introduction.html#strings">strings</a></p>
<ol>
<li><p>如果要跨行显示，用 <code>&quot;&quot;&quot;\ &quot;&quot;&quot;&quot;</code></p>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">"""\
Usage: thingy [OPTIONS]
    -h                        Display this usage message
    -H hostname               Hostname to connect to
"""</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>如果只是因为单行太长，需要分开成几行来写（本质就是自动concat）</p>
 <pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"this is a very"</span>
    <span class="token string">"long string too"</span>
    <span class="token string">"for sure ..."</span>
    <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="txt文件IO读取"><a href="#txt文件IO读取" class="headerlink" title="txt文件IO读取"></a>txt文件IO读取</h2></li>
</ol>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://funhacks.net/explore-python/File-Directory/text_file_io.html">IO读取</a> IO读取，十分详细</p>
<ul>
<li>推荐用<code>with</code>方法来open文件，这样能够自动close</li>
<li>open文件后，可以按照逐行读取，或者按照字节读取等方法。对于逐行读取来说，可以按照以下的方法来：<ol>
<li>用<code>for line in </code></li>
<li>用while循环来</li>
</ol>
</li>
</ul>
<h2 id="对dict排"><a href="#对dict排" class="headerlink" title="对dict排"></a>对dict排</h2><p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000004959880">Python dict sort排序 按照key，value</a></li>
</ul>
<h2 id="按照dict的key值排序"><a href="#按照dict的key值排序" class="headerlink" title="按照dict的key值排序"></a>按照dict的key值排序</h2><ol>
<li>还是用dict</li>
</ol>
<p>很简单，如下的一行式即可</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">new_dict <span class="token operator">=</span> <span class="token punctuation">&#123;</span>k<span class="token punctuation">:</span><span class="token builtin">dict</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="2">
<li>直接用OrderedDict</li>
</ol>
<p>直接用OrderedDict的好处就是能够 <strong>保持插入的顺序</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">new_dict <span class="token operator">=</span> OrderedDict<span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h2 id="按照dict的value值排序"><a href="#按照dict的value值排序" class="headerlink" title="按照dict的value值排序"></a>按照dict的value值排序</h2><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/613218">https://stackoverflow.com/a/613218</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>k<span class="token punctuation">:</span> v <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> item<span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<h2 id="python中删除文件"><a href="#python中删除文件" class="headerlink" title="python中删除文件"></a>python中删除文件</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/MuWinter/article/details/77196261">python 删除文件、目录</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lixingdefengzi/article/details/52637964">shutil.rmtree 函数 OSError: [Errno 39] Directory not empty: 错误原因</a></p>
<ol>
<li>删除单一文件：<code>os.remove(path)</code></li>
<li>删除 <strong>空</strong>目录：<code>os.rmdir()</code>或者 <code>os.removedirs()</code></li>
<li>整个目录与文件夹都删除：<code>shutil.rmtree()</code>其中对于Errno39的错误，需要 <strong>手动close了文件才行</strong></li>
</ol>
<h2 id="nonlocal和global的区别"><a href="#nonlocal和global的区别" class="headerlink" title="nonlocal和global的区别"></a>nonlocal和global的区别</h2><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/37743773/accessing-a-variable-from-outer-scope-via-global-keyword-in-python">Accessing a variable from outer scope via global keyword in Python</a></p>
<p>注意：nonlocal是从python3开始有的，python2并没有！</p>
<ul>
<li><p>nonlocal主要用在nested function中，global用在py文件中（<strong>即module level</strong>）</p>
</li>
<li><p>因此根据上述，如下的用法才是正确的：</p>
<p>  global的用法</p>
  <pre class="line-numbers language-python" data-language="python"><code class="language-python">A <span class="token operator">=</span> <span class="token number">1</span>

<span class="token keyword">def</span> <span class="token function">global_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token keyword">global</span> A
A <span class="token operator">=</span> <span class="token number">2</span>

<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
A <span class="token operator">=</span> <span class="token number">3</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span>
<span class="token comment"># 1</span>

global_func<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span>
<span class="token comment"># 2</span>

func<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span>
<span class="token comment"># 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>  nonlocal的用法：</p>
  <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">outside</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
a <span class="token operator">=</span> <span class="token number">1</span>

<span class="token keyword">def</span> <span class="token function">inside_nonlocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">nonlocal</span> a
    a <span class="token operator">=</span> <span class="token number">2</span>

<span class="token keyword">def</span> <span class="token function">inside</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> <span class="token number">3</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token comment"># 1</span>

inside_nonlocal<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token comment"># 2</span>

inside<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token comment"># 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
</ul>
<h2 id="切换了conda环境后，ipython的指向不正确"><a href="#切换了conda环境后，ipython的指向不正确" class="headerlink" title="切换了conda环境后，ipython的指向不正确"></a>切换了conda环境后，ipython的指向不正确</h2><p>参考：<a target="_blank" rel="noopener" href="https://github.com/ipython/ipython/issues/10986#issuecomment-358926623">IPython in a conda environment calls the wrong python</a></p>
<p>直接用<code>hash -r</code>即可</p>
<h2 id="递归地遍历获得某个文件夹（及其子文件夹）所有的文件"><a href="#递归地遍历获得某个文件夹（及其子文件夹）所有的文件" class="headerlink" title="递归地遍历获得某个文件夹（及其子文件夹）所有的文件"></a>递归地遍历获得某个文件夹（及其子文件夹）所有的文件</h2><p>参考：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_files</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> all_files<span class="token punctuation">)</span><span class="token punctuation">:</span>
    file_list <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> file_list<span class="token punctuation">:</span>
        cur_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>cur_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            get_files<span class="token punctuation">(</span>cur_path<span class="token punctuation">,</span> all_files<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            all_files<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> all_files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>还可以加入正则表达式进行文件筛选：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_files</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> all_files<span class="token punctuation">,</span> pattern<span class="token punctuation">)</span><span class="token punctuation">:</span>
    file_list <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> file_list<span class="token punctuation">:</span>
        cur_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>cur_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            get_files<span class="token punctuation">(</span>cur_path<span class="token punctuation">,</span> all_files<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            all_files<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> all_files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="或者直接用os-walk"><a href="#或者直接用os-walk" class="headerlink" title="或者直接用os.walk"></a>或者直接用<code>os.walk</code></h3><p>topdown为True表示从根目录到子目录输出，否则从子目录开始</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">root_dir <span class="token operator">=</span> <span class="token string">'../res/group_by_future_user_search_result/'</span>
files_name <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> root<span class="token punctuation">,</span> dirs<span class="token punctuation">,</span> files <span class="token keyword">in</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>root_dir<span class="token punctuation">,</span> topdown<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
  <span class="token comment"># 同时输出文件名和文件夹</span>
    <span class="token keyword">for</span> name <span class="token keyword">in</span> files<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
        files_name<span class="token punctuation">.</span>append<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
     <span class="token keyword">for</span> name <span class="token keyword">in</span> dirs<span class="token punctuation">:</span>
         <span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>

files_name_sorted <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>files_name<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="os-walk-排除文件夹"><a href="#os-walk-排除文件夹" class="headerlink" title="os.walk 排除文件夹"></a><code>os.walk</code> 排除文件夹</h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/19859907">Excluding directories in os.walk</a></p>
<p>需要注意：</p>
<ul>
<li>必须要用inplace的方式对<code>dirs</code>进行修改，<strong>而不能直接赋值</strong>，即必须使用：</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">dirs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>d <span class="token keyword">for</span> d <span class="token keyword">in</span> dirs <span class="token keyword">if</span> d <span class="token keyword">not</span> <span class="token keyword">in</span> exclude<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>




<h2 id="利用re模块同时利用多个分隔符"><a href="#利用re模块同时利用多个分隔符" class="headerlink" title="利用re模块同时利用多个分隔符"></a>利用re模块同时利用多个分隔符</h2><ul>
<li><p>基本和<code>str.split()</code>用法相同，但是要注意</p>
<ul>
<li><code>re.split()</code> 很多分隔符需要转义，但是<code>str.split()</code>不需要，如 <code>\.</code> vs <code>.</code></li>
</ul>
</li>
<li><p>分隔符使用如下：</p>
<ul>
<li>单个分隔符:<code>[.]</code></li>
<li>多个分隔符:<code>.|/</code></li>
</ul>
</li>
</ul>
<p>example：</p>
<ol>
<li>同时筛选<code>\\</code>和<code>.</code></li>
</ol>
<pre><code><pre class="line-numbers language-python" data-language="python"><code class="language-python">re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\\\|\.'</span><span class="token punctuation">,</span> string<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</code></pre>
<h2 id="用正则表达式筛选list"><a href="#用正则表达式筛选list" class="headerlink" title="用正则表达式筛选list"></a>用正则表达式筛选list</h2><p><code>filter</code>函数加<code>list</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">result <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">,</span> unfiltered_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>




<h2 id="二维数组的初始化"><a href="#二维数组的初始化" class="headerlink" title="二维数组的初始化"></a>二维数组的初始化</h2><p>要小心, 不能用<code>[None] * 5</code>这种方式, 因为这样会让数组之间<strong>有关联性</strong>, 会导致想修改一个cell的时候, 结果变成<strong>对一整列的值都进行了修改</strong>.</p>
<p>具体原因是因为在第二维乘的时候(即<code>[[None] *5] *3</code>中的3)时, 会让各个维度都指向第一个数组<code>[None] * 5</code>, <strong>即它们都是第一维度的浅拷贝</strong>, 所以任何一列都是指向同一个</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">In <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">]</span><span class="token punctuation">:</span> dp<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">5</span>

In <span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>dp<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

In <span class="token punctuation">[</span><span class="token number">49</span><span class="token punctuation">]</span><span class="token punctuation">:</span> dp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>

In <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>dp<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

In <span class="token punctuation">[</span><span class="token number">51</span><span class="token punctuation">]</span><span class="token punctuation">:</span> dp<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>

In <span class="token punctuation">[</span><span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>dp<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>正确的做法应该是**<code>[[None for  _ in range(5)] for _  in range(5)]</code>**</p>
<h2 id="defaultdict"><a href="#defaultdict" class="headerlink" title="defaultdict"></a>defaultdict</h2><p>参考<a target="_blank" rel="noopener" href="https://docs.python.org/3.7/library/collections.html#defaultdict-objects">defaultdict的官方文档</a></p>
<p>和 <code>dict</code>差不多, 主要在于对于构造函数做了改变, 能够实现在<strong>某个key不存在的情况下自动按照确定的函数进行初始化</strong>,  官方的一个例子就是用于记数, 这个非常有效:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token string">'mississippi'</span>
d <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> k <span class="token keyword">in</span> s<span class="token punctuation">:</span>
    d<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token builtin">sorted</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="lambda函数并不接受tuple-argument"><a href="#lambda函数并不接受tuple-argument" class="headerlink" title="lambda函数并不接受tuple argument"></a>lambda函数并不接受tuple argument</h2><p>下面的函数：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">lambda</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在python中并不合法，会直接报错</p>
<p>而下面这种则会提示缺少参数（因为传入的tuple只对应一个参数）</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">lambda</span> k<span class="token punctuation">,</span> v<span class="token punctuation">:</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p>具体的做法用下面的方式：</p>
<ol>
<li>用<code>itemgetter</code></li>
<li>或者直接传入一整个参数，后面indexing即可</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> operator <span class="token keyword">import</span> itemgetter

records <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'bob'</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token string">'manager'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'sue'</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token string">'developer'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

ages1 <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> records<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># [35, 40]</span>
ages2 <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>itemgetter<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> records<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># [35, 40]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="print-list的时候自动换行，美化输出"><a href="#print-list的时候自动换行，美化输出" class="headerlink" title="print list的时候自动换行，美化输出"></a>print list的时候自动换行，美化输出</h2><p>参考 <a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/pprint.html#module-pprint">数据美化输出</a></p>
<p>直接用<code>pprint.pprint()</code>即可</p>
<h2 id="eval可用于计算表达式-exec-可用于赋值"><a href="#eval可用于计算表达式-exec-可用于赋值" class="headerlink" title="eval可用于计算表达式, exec 可用于赋值"></a><code>eval</code>可用于计算表达式, <code>exec</code> 可用于赋值</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">In <span class="token punctuation">[</span><span class="token number">143</span><span class="token punctuation">]</span><span class="token punctuation">:</span> tt1<span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token string">'&#123;1:2,3:4&#125;'</span><span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">144</span><span class="token punctuation">]</span><span class="token punctuation">:</span> tt1
Out<span class="token punctuation">[</span><span class="token number">144</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p>但是直接用<code>eval</code>来赋值就会报错:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">In <span class="token punctuation">[</span><span class="token number">145</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token string">'dist_ssss=&#123;1:2,3:4&#125;'</span><span class="token punctuation">)</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>

  File <span class="token string">"/usr/local/Caskroom/miniconda/base/envs/py37/lib/python3.7/site-packages/IPython/core/interactiveshell.py"</span><span class="token punctuation">,</span> line <span class="token number">3331</span><span class="token punctuation">,</span> <span class="token keyword">in</span> run_code
    <span class="token keyword">exec</span><span class="token punctuation">(</span>code_obj<span class="token punctuation">,</span> self<span class="token punctuation">.</span>user_global_ns<span class="token punctuation">,</span> self<span class="token punctuation">.</span>user_ns<span class="token punctuation">)</span>

  File <span class="token string">"&lt;ipython-input-145-844f9625b034>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
    <span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token string">'dist_ssss=&#123;1:2,3:4&#125;'</span><span class="token punctuation">)</span>

  File <span class="token string">"&lt;string>"</span><span class="token punctuation">,</span> line <span class="token number">1</span>
    dist_ssss<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">&#125;</span>
             <span class="token operator">^</span>
SyntaxError<span class="token punctuation">:</span> invalid syntax<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>此时一个用<code>exec</code>来赋值</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">In <span class="token punctuation">[</span><span class="token number">146</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token string">'dist_ssss=&#123;1:2,3:4&#125;'</span><span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">147</span><span class="token punctuation">]</span><span class="token punctuation">:</span> dist_ssss
Out<span class="token punctuation">[</span><span class="token number">147</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="获取文本的最后一行：直接用readlines-然后取最后一个元素"><a href="#获取文本的最后一行：直接用readlines-然后取最后一个元素" class="headerlink" title="获取文本的最后一行：直接用readlines()然后取最后一个元素"></a>获取文本的最后一行：直接用<code>readlines()</code>然后取最后一个元素</h2><p>注意：</p>
<ol>
<li>这种方法不能处理太大的文本，<strong>因为<code>readlines()</code>是迭代器，直接把这个文件读入内存</strong></li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./full_preclick_&#123;&#125;_&#123;&#125;.txt'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> hour<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
  	last_line <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h2 id="生成器逐行读取文件的方法"><a href="#生成器逐行读取文件的方法" class="headerlink" title="生成器逐行读取文件的方法"></a>生成器逐行读取文件的方法</h2><p><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000006788420">python readline()逐行读,怎么判断已到末尾?</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fh<span class="token punctuation">:</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> fh<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fh<span class="token punctuation">:</span>
    line <span class="token operator">=</span> fh<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> line<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        line <span class="token operator">=</span> fh<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="获取给定目录下的所有文件"><a href="#获取给定目录下的所有文件" class="headerlink" title="获取给定目录下的所有文件"></a>获取给定目录下的所有文件</h2><h3 id="递归地获得（遍历所有子目录）-os-walk"><a href="#递归地获得（遍历所有子目录）-os-walk" class="headerlink" title="递归地获得（遍历所有子目录）:os.walk()"></a>递归地获得（遍历所有子目录）:<code>os.walk()</code></h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">In <span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">:</span> ll
total <span class="token number">4</span>
drwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">2</span> tangweitao<span class="token punctuation">.</span>walter <span class="token number">4096</span> Jun <span class="token number">10</span> <span class="token number">11</span><span class="token punctuation">:</span><span class="token number">43</span> ddd<span class="token operator">/</span>
<span class="token operator">-</span>rw<span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span>r<span class="token operator">-</span><span class="token operator">-</span> <span class="token number">1</span> tangweitao<span class="token punctuation">.</span>walter    <span class="token number">0</span> Jun <span class="token number">10</span> <span class="token number">11</span><span class="token punctuation">:</span><span class="token number">43</span> res_22

In <span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">:</span> pwd
Out<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">u'/data00/home/tangweitao.walter/Download/test_res'</span>

In <span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> k <span class="token keyword">in</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span><span class="token string">'/data00/home/tangweitao.walter/Download/test_res'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token punctuation">,</span>k<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>
<span class="token punctuation">(</span><span class="token string">'/data00/home/tangweitao.walter/Download/test_res'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'ddd'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'res_22'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'/data00/home/tangweitao.walter/Download/test_res/ddd'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>对每一个文件夹都进行遍历，返回<strong>当前文件夹的绝对路径，包含的子文件夹，包含的文件</strong></p>
<h2 id="只列出所有文件夹-文件名-os-listdir"><a href="#只列出所有文件夹-文件名-os-listdir" class="headerlink" title="只列出所有文件夹/文件名: os.listdir()"></a>只列出所有文件夹/文件名: <code>os.listdir()</code></h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">In <span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">]</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'/data00/home/tangweitao.walter/Download/test_res'</span><span class="token punctuation">)</span>
Out<span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'ddd'</span><span class="token punctuation">,</span> <span class="token string">'res_22'</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h2 id="在python中执行shell命令"><a href="#在python中执行shell命令" class="headerlink" title="在python中执行shell命令"></a>在python中执行shell命令</h2><p>使用Popen</p>
<p>一个比较好的例子， 无需split：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">cmd<span class="token operator">=</span><span class="token string">'wc . -l'</span>
child <span class="token operator">=</span> Popen<span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>




<h3 id="将输入的命令（字符串）分隔成shell-like-syntax-shlex-split"><a href="#将输入的命令（字符串）分隔成shell-like-syntax-shlex-split" class="headerlink" title="将输入的命令（字符串）分隔成shell-like syntax: shlex.split"></a>将输入的命令（字符串）分隔成shell-like syntax: shlex.split</h3><p><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/shlex.html">shlex</a> 模块</p>
<h3 id="看看是否成功执行"><a href="#看看是否成功执行" class="headerlink" title="看看是否成功执行"></a>看看是否成功执行</h3><p>看returncode</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">cmd<span class="token operator">=</span><span class="token string">'wc . -l'</span>
child <span class="token operator">=</span> Popen<span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span>

<span class="token keyword">if</span> child<span class="token punctuation">.</span>returncode <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Success!'</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Failed'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="查看结果"><a href="#查看结果" class="headerlink" title="查看结果"></a>查看结果</h3><ul>
<li>默认是直接输出到标准输出，即主进程的stdout（屏幕）</li>
</ul>
<h4 id="重定向至管道PIPE"><a href="#重定向至管道PIPE" class="headerlink" title="重定向至管道PIPE"></a>重定向至管道PIPE</h4><ul>
<li>如果需要对输出进行单独的处理，需要重定向到PIPE，然后就能用<code>prc.stdout</code>或者<code>prc.stderr</code>，类似文件那样进行读写处理（即能够使用<code>.read</code>, <code>readline</code>, <code>readlines</code>）</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">proc <span class="token operator">=</span> Popen<span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> stdout<span class="token operator">=</span>PIPE<span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    line <span class="token operator">=</span> proc<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> line<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">if</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r'\d+|instance'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>如果没有重定向到PIPE，直接按照文件对象那样进行读写会报错：</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 只把stderr重定向到管道，而没有把stdout重定向到管道</span>
proc <span class="token operator">=</span> Popen<span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> stderr<span class="token operator">=</span>PIPE<span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    line <span class="token operator">=</span> proc<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> line<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">if</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r'\d+|instance'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>此时对应的stdout应该是None：</p>
<p><img src="https://raw.githubusercontent.com/khalitt/IMG_REPO/master/20200626161306.png"></p>
<ul>
<li><p>重定向到管道之后，使用<code>communicate</code>将返回一个tuple <code>stdout, stderr</code>，分别对应前面子进程的两个管道，注意：</p>
<ul>
<li><p>只有在Popen的时候使用了PIPE的输出，使用<code>communicate</code>才会获得对应的结果，否则是None，如例子中的stdout将会是None</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># stdout将会是None，因为已经输出到默认的标准输出（屏幕）</span>
proc <span class="token operator">=</span> Popen<span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> stderr<span class="token operator">=</span>PIPE<span class="token punctuation">)</span>
stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> proc<span class="token punctuation">.</span>communicate<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><p>输出到PIPE之后，如果在使用communicate前尝试进行了读（read)，这部分被读的数据将不会进入communicate的返回中（因为已经被读取了）</p>
</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># stdout将会少了开头的50行</span>
proc <span class="token operator">=</span> Popen<span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> stderr<span class="token operator">=</span>PIPE<span class="token punctuation">)</span>
<span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   proc<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> proc<span class="token punctuation">.</span>communicate<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>如果没有使用communicate，而是直接不断地read/readline，<strong>将可能导致堵塞</strong>，如下面的这段代码，详细原因看后文 Popen(PIPE)阻塞，很重要的问题！！！，因此不建议这样</p>
</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">proc <span class="token operator">=</span> Popen<span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> stdout<span class="token operator">=</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>PIPE<span class="token punctuation">)</span>
<span class="token keyword">while</span> proc<span class="token punctuation">.</span>poll<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    line <span class="token operator">=</span> proc<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 将可能导致堵塞</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> line<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token comment"># print(line)</span>
    <span class="token keyword">if</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r'\d+|instance'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
    count <span class="token operator">+=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="Popen-PIPE-阻塞，很重要的问题！！！"><a href="#Popen-PIPE-阻塞，很重要的问题！！！" class="headerlink" title="Popen(PIPE)阻塞，很重要的问题！！！"></a>Popen(PIPE)阻塞，很重要的问题！！！</h2><h3 id="Popen-wait-和Popen-communicate-的区别"><a href="#Popen-wait-和Popen-communicate-的区别" class="headerlink" title="Popen.wait()和Popen.communicate()的区别"></a><code>Popen.wait()</code>和<code>Popen.communicate()</code>的区别</h3><p>当stdout和/或stderr被重定向到PIPE的时候，使用wait将可能导致deadlock（详细原因见下文 Popen(PIPE)阻塞）主要就是系统默认的PIPE大小是有限的（可以通过<code>ulimit -a</code>查看到），当cmd的输出直接将PIPE塞满之后，没办法继续写入，后面的read的代码也没办法执行到，因此会导致阻塞的情况出现。</p>
<p>而使用communicate就不会有这种情况，但由于communicate是直接缓存入内存，输出不能太大，否则直接OOM</p>
<blockquote>
<p>为了解决这个问题, Popen有一个communicate方法, 这个方法会将stdout和stderr数据读入到内存, 并且会一直独到两个流的结尾(EOF). communicate可以传入一个input参数, 用来表示向stdin中写入数据, 可以做到进程间的数据通信.</p>
<p>注意: 官方文档中提示, 读取的数据是缓存在内存中的, 所以当数据量非常大或者是无限制的时候, 不要使用communicate, 应该会导致OOM.</p>
<p>一般情况下, stdout和stderr数据量不是很大的时候, 使用communicate不会导致问题, 量特别大的时候可以考虑使用文件来替代PIPE, 例如stdout=open(“stdout”, “w”)</p>
</blockquote>
<h3 id="原因和解决方法"><a href="#原因和解决方法" class="headerlink" title="原因和解决方法"></a>原因和解决方法</h3><p><a target="_blank" rel="noopener" href="http://noops.me/?p=92">小心subprocess的PIPE卡住你的python程序</a></p>
<blockquote>
<p>查看python的源码发现，如果设置了stdout或stderr，subprocess就会调用os.pipe创建一个管道用于其和子进程之间的通信，而上面的问题正好是cmd输出的数据把pipe塞满，无法继续往pipe里写入数据导致程序hang住，<strong>而我们没有去读出pipe数据</strong>，而是死等子进程完成，导致死锁。</p>
</blockquote>
<p>上面这种情况产生的原因就是：</p>
<ul>
<li>cmd输出的数据太多</li>
<li>后续没有从pipe（stdout）中读取数据进行消费</li>
</ul>
<p>但是哪怕有用<code>read</code>，仍然是有可能出现阻塞的情况：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_34380781/article/details/92395819">python popen.stdout.read阻塞 解决办法</a></p>
<p><img src="https://raw.githubusercontent.com/khalitt/IMG_REPO/master/20200626113501.png"></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/16770371">Understanding Popen.communicate</a></p>
<blockquote>
<p><code>p.stdout.read()</code> hangs forever because it tries to read <em>all</em> output from the child at the same time as the child waits for input (<code>raw_input()</code>) that causes a deadlock.</p>
</blockquote>
<p>因为：</p>
<ul>
<li>read的语句可能也被阻塞了（child process一直没办法把输出打入stdout）</li>
<li>read不加参数的情况下，默认把所有输出一起读入，容易出错</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/5913629">pipe large amount of data to stdin while using subprocess.Popen</a></p>
<blockquote>
<p>If you don’t want to keep all the data in memory, you have to use select.</p>
</blockquote>
<p>即便能到read或者readline的语句，也可能由于管道中已经为空，此时尝试read或者readline导致阻塞：</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/18422264">live output from subprocess command</a></p>
<blockquote>
<p>Or you can create a <code>reader</code> and a <code>writer</code> file. Pass the <code>writer</code> to the <code>Popen</code> and read from the <code>reader</code></p>
<p>即存到一个文件中，然后不断重该文件读入，输出到stdout中</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> io
<span class="token keyword">import</span> time
<span class="token keyword">import</span> subprocess
<span class="token keyword">import</span> sys

filename <span class="token operator">=</span> <span class="token string">'test.log'</span>
<span class="token keyword">with</span> io<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> writer<span class="token punctuation">,</span> io<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> reader<span class="token punctuation">:</span>
    process <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span>command<span class="token punctuation">,</span> stdout<span class="token operator">=</span>writer<span class="token punctuation">)</span>
    <span class="token keyword">while</span> process<span class="token punctuation">.</span>poll<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span>reader<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token comment"># Read the remaining</span>
    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span>reader<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>When you use <code>PIPE</code>, <code>read</code> and <code>readline</code> functions <strong>will block until either one character is written to the pipe or a line is written to the pipe</strong> respectively.</p>
</blockquote>
<p>总结下来的解决方法：</p>
<ul>
<li>不在子进程运行的过程中使用read或者readline，而是直接使用<code>.communicate</code>，但这样无法实现实时读取，同时在输出非常大的情况下并不好</li>
<li>Popen中把stdout指定为一个文件，同时再另外设一个reader不断读该一个文件，但这样后续只能从文件读写了，传输也只能传输文件，同样也可以流式输出，而且可以避免read和readline的阻塞</li>
<li>使用select，实时流式处理输出，详细见下文</li>
</ul>
<h3 id="Popen流式的stdout-stderr输出"><a href="#Popen流式的stdout-stderr输出" class="headerlink" title="Popen流式的stdout/stderr输出"></a>Popen流式的stdout/stderr输出</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/icejoywoo/p/3627397.html">python的subprocess的简单使用和注意事项</a></p>
<p>其中描述了卡死的现象原因，两种解决的方法，以及最后的调优思路：</p>
<blockquote>
<p>有个bufsize的参数, 这个默认是0, 就是不缓存, 1表示行缓存, 其他正数表示缓存使用的大小, 负数-1表示是使用系统默认的缓存大小.</p>
<p>在运行性能遇到问题时, 可能是缓存区未开启或者太小, 导致了子进程被卡住, 效率低下, 可以考虑配置为-1或4096.</p>
<p><strong>需要实时读取stdout和stderr的, 可以查阅[参考2], 使用select来读取stdout和stderr流.</strong></p>
</blockquote>
<h2 id="合并字典（类似spark-reduceByKey）的方法"><a href="#合并字典（类似spark-reduceByKey）的方法" class="headerlink" title="合并字典（类似spark reduceByKey）的方法"></a>合并字典（类似spark reduceByKey）的方法</h2><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/11012181">Is there any pythonic way to combine two dicts (adding values for keys that appear in both)?</a></p>
<h2 id="print重定向到文件"><a href="#print重定向到文件" class="headerlink" title="print重定向到文件"></a>print重定向到文件</h2><ul>
<li>直接在bash的command里面重定向：</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">python <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">></span> output_log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>在python里面将重定向文件赋值给stdout</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys
sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"c:\\goat.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"test sys.stdout"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<h3 id="实时地写入（刷新）重定向文件"><a href="#实时地写入（刷新）重定向文件" class="headerlink" title="实时地写入（刷新）重定向文件"></a>实时地写入（刷新）重定向文件</h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/29178049">python stdout to file does not respond in real time</a></p>
<p>不论是在bash中实时地输出，还是说通过stdout重定向，都需要：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>




<h2 id="将多个元素（文件夹）用os-path-join-拼起来"><a href="#将多个元素（文件夹）用os-path-join-拼起来" class="headerlink" title="将多个元素（文件夹）用os.path.join()拼起来"></a>将多个元素（文件夹）用<code>os.path.join()</code>拼起来</h2><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/33299556">Join elements of a list into a path</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">list</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'L:'</span><span class="token punctuation">,</span> <span class="token string">'JM6'</span><span class="token punctuation">,</span> <span class="token string">'jm6'</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'turb'</span><span class="token punctuation">,</span> <span class="token string">'results'</span><span class="token punctuation">,</span> <span class="token string">'v6.2'</span><span class="token punctuation">,</span> <span class="token string">'examples'</span><span class="token punctuation">]</span>
os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">list</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h2 id="Popen实现超时关闭子进程"><a href="#Popen实现超时关闭子进程" class="headerlink" title="Popen实现超时关闭子进程"></a>Popen实现超时关闭子进程</h2><h3 id="错误做法：使用threading-Timer，实测不可行"><a href="#错误做法：使用threading-Timer，实测不可行" class="headerlink" title="错误做法：使用threading.Timer，实测不可行"></a>错误做法：使用<code>threading.Timer</code>，实测不可行</h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/10012262">Using module ‘subprocess’ with timeout</a></p>
<p>但是实际执行起来会一直有No such process的问题，具体原因参考 <a target="_blank" rel="noopener" href="https://www.ostricher.com/2015/01/python-subprocess-with-timeout/">Running a Time-Limited Subprocess In Python (concurrency caveats inside!)</a></p>
<p><img src="https://raw.githubusercontent.com/khalitt/IMG_REPO/master/20200630143921.png"></p>
<h3 id="正确做法：使用thread，和thread-terminate"><a href="#正确做法：使用thread，和thread-terminate" class="headerlink" title="正确做法：使用thread，和thread.terminate()"></a>正确做法：使用thread，和<code>thread.terminate()</code></h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/4825933">what about running the process in a separate thread?</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span>
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> subprocess
<span class="token keyword">import</span> traceback
<span class="token keyword">import</span> shlex


<span class="token keyword">class</span> <span class="token class-name">Command</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Enables to run subprocess commands in a different thread with TIMEOUT option.
    Based on jcollado's solution:
    http://stackoverflow.com/questions/1191374/subprocess-with-timeout/4825933#4825933
    """</span>
    command <span class="token operator">=</span> <span class="token boolean">None</span>
    process <span class="token operator">=</span> <span class="token boolean">None</span>
    status <span class="token operator">=</span> <span class="token boolean">None</span>
    stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">''</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> command<span class="token punctuation">,</span> logger<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            command <span class="token operator">=</span> shlex<span class="token punctuation">.</span>split<span class="token punctuation">(</span>command<span class="token punctuation">)</span>
            <span class="token comment"># print(command)</span>
        self<span class="token punctuation">.</span>command <span class="token operator">=</span> command
        self<span class="token punctuation">.</span>logger <span class="token operator">=</span> logger

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">""" Run a command then return: (status, output, error). """</span>

        <span class="token keyword">def</span> <span class="token function">target</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>process <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span>self<span class="token punctuation">.</span>command<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> self<span class="token punctuation">.</span>stderr <span class="token operator">=</span> self<span class="token punctuation">.</span>process<span class="token punctuation">.</span>communicate<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>stderr <span class="token operator">=</span> traceback<span class="token punctuation">.</span>format_exc<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token operator">-</span>self<span class="token punctuation">.</span>process<span class="token punctuation">.</span>returncode

        <span class="token comment"># default stdout and stderr</span>
        <span class="token keyword">if</span> <span class="token string">'stdout'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> kwargs<span class="token punctuation">:</span>
            kwargs<span class="token punctuation">[</span><span class="token string">'stdout'</span><span class="token punctuation">]</span> <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>PIPE
        <span class="token keyword">if</span> <span class="token string">'stderr'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> kwargs<span class="token punctuation">:</span>
            kwargs<span class="token punctuation">[</span><span class="token string">'stderr'</span><span class="token punctuation">]</span> <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>PIPE
        <span class="token comment"># thread</span>
        thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>target<span class="token punctuation">,</span> kwargs<span class="token operator">=</span>kwargs<span class="token punctuation">)</span>
        thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>
        <span class="token keyword">if</span> thread<span class="token punctuation">.</span>is_alive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>logger<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Kill process'</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Kill process'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>process<span class="token punctuation">.</span>terminate<span class="token punctuation">(</span><span class="token punctuation">)</span>
            thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> self<span class="token punctuation">.</span>status<span class="token punctuation">,</span> self<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> self<span class="token punctuation">.</span>stderr


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    command <span class="token operator">=</span> Command<span class="token punctuation">(</span><span class="token string">"sleep 2"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span>run<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span>run<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>同时注意，python的returncode为负数时，表示被SIGNAL N，如返回-15，对应SIGTERM</p>
<h3 id="kill整个进程组"><a href="#kill整个进程组" class="headerlink" title="kill整个进程组"></a>kill整个进程组</h3><p>上述做法中只能kill掉Popen的那个进程，并不能kill掉整个process（最多到子进程，无法处理子进程的进程，即grandchild process）。</p>
<p>最典型的例子就是传入的cmd是调用另一个bash脚本，而bash脚本中又调用了其他参数，此时直接低啊用上面的脚本将导致grandchild process无法被kill掉，导致一直没有结束。</p>
<p>而正确的做法应该如 <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/4791612">How to terminate a python subprocess launched with shell=True</a>，通过杀死整个进程组来实现kill。但要注意：</p>
<ul>
<li>Popen必须传入新的参数<code>preexec_fn=os.setsid</code>，使得这个Popen所对应的process（即开启bash脚本的那个process）成为进程组的父进程：</li>
</ul>
<blockquote>
<p>For that, you should attach a <a target="_blank" rel="noopener" href="http://pubs.opengroup.org/onlinepubs/009695399/functions/setsid.html">session id</a> to the parent process of the spawned/child processes, which is a shell in your case.This will make it the group leader of the processes. So now, when a signal is sent to the process group leader, it’s transmitted to all of the child processes of this group.</p>
</blockquote>
<ul>
<li>使用<code>os.killpg</code> + <code>signal.SIGTERM</code></li>
</ul>
<p>最后的代码：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># coding=utf-8</span>
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> subprocess
<span class="token keyword">import</span> traceback
<span class="token keyword">import</span> shlex
<span class="token keyword">import</span> os
<span class="token keyword">import</span> signal


<span class="token keyword">class</span> <span class="token class-name">Command</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Enables to run subprocess commands in a different thread with TIMEOUT option.
    Based on jcollado's solution:
    http://stackoverflow.com/questions/1191374/subprocess-with-timeout/4825933#4825933
    """</span>
    command <span class="token operator">=</span> <span class="token boolean">None</span>
    process <span class="token operator">=</span> <span class="token boolean">None</span>
    status <span class="token operator">=</span> <span class="token boolean">None</span>
    stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">''</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> command<span class="token punctuation">,</span> logger<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            command <span class="token operator">=</span> shlex<span class="token punctuation">.</span>split<span class="token punctuation">(</span>command<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>command <span class="token operator">=</span> command
        self<span class="token punctuation">.</span>logger <span class="token operator">=</span> logger

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">""" Run a command then return: (status, output, error). """</span>

        <span class="token keyword">def</span> <span class="token function">target</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># 传入preexec_fn</span>
                self<span class="token punctuation">.</span>process <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span>self<span class="token punctuation">.</span>command<span class="token punctuation">,</span> preexec_fn<span class="token operator">=</span>os<span class="token punctuation">.</span>setsid<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> self<span class="token punctuation">.</span>stderr <span class="token operator">=</span> self<span class="token punctuation">.</span>process<span class="token punctuation">.</span>communicate<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>stderr <span class="token operator">=</span> traceback<span class="token punctuation">.</span>format_exc<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token operator">-</span>self<span class="token punctuation">.</span>process<span class="token punctuation">.</span>returncode <span class="token keyword">if</span> self<span class="token punctuation">.</span>process<span class="token punctuation">.</span>returncode <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">else</span> self<span class="token punctuation">.</span>process<span class="token punctuation">.</span>returncode

        <span class="token comment"># default stdout and stderr</span>
        <span class="token keyword">if</span> <span class="token string">'stdout'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> kwargs<span class="token punctuation">:</span>
            kwargs<span class="token punctuation">[</span><span class="token string">'stdout'</span><span class="token punctuation">]</span> <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>PIPE
        <span class="token keyword">if</span> <span class="token string">'stderr'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> kwargs<span class="token punctuation">:</span>
            kwargs<span class="token punctuation">[</span><span class="token string">'stderr'</span><span class="token punctuation">]</span> <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>PIPE
        <span class="token comment"># thread</span>
        thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>target<span class="token punctuation">,</span> kwargs<span class="token operator">=</span>kwargs<span class="token punctuation">)</span>
        thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>
        <span class="token keyword">if</span> thread<span class="token punctuation">.</span>is_alive<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 不再使用kill</span>
            os<span class="token punctuation">.</span>killpg<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getpgid<span class="token punctuation">(</span>self<span class="token punctuation">.</span>process<span class="token punctuation">.</span>pid<span class="token punctuation">)</span><span class="token punctuation">,</span> signal<span class="token punctuation">.</span>SIGTERM<span class="token punctuation">)</span>
            thread<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>logger<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Kill process due to time limit'</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Kill process due to time limit'</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> self<span class="token punctuation">.</span>status<span class="token punctuation">,</span> self<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> self<span class="token punctuation">.</span>stderr


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    command <span class="token operator">=</span> Command<span class="token punctuation">(</span><span class="token string">"sleep 2"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span>run<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>command<span class="token punctuation">.</span>run<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="添加timeout-retry操作"><a href="#添加timeout-retry操作" class="headerlink" title="添加timeout + retry操作"></a>添加timeout + retry操作</h2><p>参考 <a target="_blank" rel="noopener" href="https://pypi.org/project/func-timeout/">func-timeout 4.3.5</a>的介绍</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> func_timeout <span class="token keyword">import</span> func_timeout<span class="token punctuation">,</span> FunctionTimedOut

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>

	doitReturnValue <span class="token operator">=</span> func_timeout<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> doit<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'arg1'</span><span class="token punctuation">,</span> <span class="token string">'arg2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">except</span> FunctionTimedOut<span class="token punctuation">:</span>
	<span class="token keyword">print</span> <span class="token punctuation">(</span> <span class="token string">"doit('arg1', 'arg2') could not complete within 5 seconds and was terminated.\n"</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
	<span class="token comment"># Handle any exceptions that doit might raise here</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>比如下面这个，就retry了一次，如果想retry多次，可以手动for循环然后成功之后break loop</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> epoch <span class="token operator">%</span> self<span class="token punctuation">.</span>save_period <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> best<span class="token punctuation">:</span>
    timeout <span class="token operator">=</span> <span class="token number">300</span>
    timeout_exception <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        func_timeout<span class="token punctuation">(</span>timeout<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_save_checkpoint<span class="token punctuation">,</span> kwargs<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'epoch'</span><span class="token punctuation">:</span> epoch<span class="token punctuation">,</span> <span class="token string">'save_best'</span><span class="token punctuation">:</span> best<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> FunctionTimedOut <span class="token keyword">as</span> fte<span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">'Failed to save checkpoint of epoch &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>epoch<span class="token punctuation">)</span><span class="token punctuation">)</span>
        timeout_exception <span class="token operator">=</span> fte

    <span class="token keyword">if</span> timeout_exception<span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            timeout_exception<span class="token punctuation">.</span>retry<span class="token punctuation">(</span>timeout <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> FunctionTimedOut<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">'Failed to save checkpoint of epoch &#123;&#125; for second trial'</span> <span class="token operator">+</span>
                                <span class="token string">'with double timeout'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>epoch<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Walter</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://khalitt.github.io/2019/09/10/python-basic/">https://khalitt.github.io/2019/09/10/python-basic/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/python/">python</a><a class="post-meta__tags" href="/tags/basic/">basic</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/09/10/network-basic/"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">networkx基础</div></div></a></div><div class="next-post pull-right"><a href="/2019/09/10/pytorch-basic/"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">pytorch的基本操作</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2020/05/06/matplotlib-usage/" title="matplotlib使用"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-06</div><div class="title">matplotlib使用</div></div></a></div><div><a href="/2020/01/16/opencv-usage/" title="OpenCV基础使用"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-01-16</div><div class="title">OpenCV基础使用</div></div></a></div><div><a href="/2020/04/22/pandas-usage-md/" title="pandas基础使用"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-22</div><div class="title">pandas基础使用</div></div></a></div><div><a href="/2019/09/10/python-configparser/" title="python config 读取与config parser的使用"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-10</div><div class="title">python config 读取与config parser的使用</div></div></a></div><div><a href="/2019/09/17/python-generator-yield/" title="pythons生成器(generator)、yield的理解"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-17</div><div class="title">pythons生成器(generator)、yield的理解</div></div></a></div><div><a href="/2020/04/30/python-multi-thread-usage/" title="python多线程的使用"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-30</div><div class="title">python多线程的使用</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8E%E4%B8%A4%E4%B8%AAlist-key-list%EF%BC%8Cvalue-list-%E6%9E%84%E5%BB%BAdict"><span class="toc-number">1.</span> <span class="toc-text">从两个list(key list，value list)构建dict</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97zip"><span class="toc-number">2.</span> <span class="toc-text">嵌套zip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98"><span class="toc-number">3.</span> <span class="toc-text">路径问题. &#x2F; ..</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#logging-twice"><span class="toc-number">4.</span> <span class="toc-text">logging twice</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#list-extend-%E4%B8%8E-append%E7%9A%84%E8%81%94%E7%B3%BB%E4%B8%8E%E5%8C%BA%E5%88%AB"><span class="toc-number">5.</span> <span class="toc-text">list extend 与 append的联系与区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nested-list-flatten%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">6.</span> <span class="toc-text">nested list flatten的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PIL-%E4%B8%8E-numpy%E4%BA%92%E8%BD%AC"><span class="toc-number">7.</span> <span class="toc-text">PIL 与 numpy互转</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%8Akwargs-%E4%BD%9C%E4%B8%BAclass-attributes%EF%BC%9A"><span class="toc-number">8.</span> <span class="toc-text">把kwargs 作为class attributes：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%8Aargs-kwargs%E4%B8%8D%E6%96%AD%E4%BC%A0%E9%80%92%EF%BC%9A-%E4%B8%8E"><span class="toc-number">9.</span> <span class="toc-text">把args kwargs不断传递：* 与 **</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dict%E5%90%88%E5%B9%B6%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">10.</span> <span class="toc-text">dict合并的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A8%E8%8D%90%E7%94%A8update%E7%9A%84%E6%96%B9%E6%B3%95-dict-update-dict2"><span class="toc-number">10.1.</span> <span class="toc-text">推荐用update的方法(dict.update(dict2))</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iter%E4%B8%8Enext%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">11.</span> <span class="toc-text">iter与next的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87for-StopIteration%E6%8E%A7%E5%88%B6%E8%AF%BB%E5%8F%96%E6%AC%A1%E6%95%B0%EF%BC%9A"><span class="toc-number">11.1.</span> <span class="toc-text">通过for + StopIteration控制读取次数：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87for-next-%E9%BB%98%E8%AE%A4%E5%80%BC%E6%8E%A7%E5%88%B6%E5%BE%AA%E7%8E%AF%E6%AC%A1%E6%95%B0%EF%BC%9A"><span class="toc-number">11.2.</span> <span class="toc-text">通过for + next 默认值控制循环次数：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87next%E7%9A%84default-value%E6%8E%A7%E5%88%B6%E5%A4%9A%E4%B8%AAiterator%EF%BC%9A"><span class="toc-number">11.3.</span> <span class="toc-text">通过next的default value控制多个iterator：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%9F%E5%8F%AF%E9%80%9A%E8%BF%87for-while-loop%E6%8E%A7%E5%88%B6%E5%A4%9A%E4%B8%AA%E5%BE%AA%E7%8E%AF%EF%BC%9A"><span class="toc-number">11.4.</span> <span class="toc-text">也可通过for + while loop控制多个循环：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%AE%B9%E5%99%A8%EF%BC%88container%EF%BC%89%E6%9D%A5%E8%A3%85iterator%EF%BC%8C%E6%AF%94%E5%A6%82list"><span class="toc-number">11.5.</span> <span class="toc-text">可以用容器（container）来装iterator，比如list</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iter-iter-iterable-iterator-%E7%9A%84%E8%81%94%E7%B3%BB%E4%B8%8E%E5%8C%BA%E5%88%AB%EF%BC%9A"><span class="toc-number">12.</span> <span class="toc-text">__iter__, iter(), iterable, iterator 的联系与区别：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%96%B0list"><span class="toc-number">13.</span> <span class="toc-text">获取新list</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5extend%E6%88%96%E8%80%85append%E6%98%AF%E4%B8%8D%E8%A1%8C%E7%9A%84"><span class="toc-number">13.1.</span> <span class="toc-text">直接extend或者append是不行的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%85%E6%8B%B7%E8%B4%9D%EF%BC%88list%E5%86%85%E7%9A%84%E5%85%83%E7%B4%A0%E4%B8%8D%E5%A4%8D%E5%88%B6%EF%BC%89"><span class="toc-number">13.2.</span> <span class="toc-text">浅拷贝（list内的元素不复制）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E6%8B%B7%E8%B4%9D%EF%BC%88list%E5%86%85%E7%9A%84%E5%85%83%E7%B4%A0%E4%B9%9F%E5%A4%8D%E5%88%B6%E4%B8%80%E6%AC%A1%EF%BC%89"><span class="toc-number">13.3.</span> <span class="toc-text">深拷贝（list内的元素也复制一次）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sorted%E5%87%BD%E6%95%B0%E7%94%A8%E6%B3%95"><span class="toc-number">14.</span> <span class="toc-text">sorted函数用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E5%A4%9A%E4%B8%AA%E6%8C%87%E6%A0%87%E6%8E%92%E5%BA%8F-Multiple-keys-sorting"><span class="toc-number">14.1.</span> <span class="toc-text">对多个指标排序 Multiple keys sorting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E7%94%A8lambda%E5%87%BD%E6%95%B0"><span class="toc-number">14.2.</span> <span class="toc-text">直接用lambda函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E7%9A%84%E5%90%8C%E6%97%B6%E8%BF%94%E5%9B%9E%E7%B4%A2%E5%BC%95"><span class="toc-number">14.3.</span> <span class="toc-text">排序的同时返回索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E-%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-number">15.</span> <span class="toc-text">* 与 **的用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9A%84%E4%B8%A4%E7%A7%8D%E7%94%A8%E6%B3%95"><span class="toc-number">15.1.</span> <span class="toc-text">*的两种用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Bmodule%E4%BD%8D%E7%BD%AE-file"><span class="toc-number">15.2.</span> <span class="toc-text">查看module位置:__file__</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9module%E5%AF%BC%E5%85%A5%E7%9A%84%E9%A1%BA%E5%BA%8F%EF%BC%9A%E4%BF%AE%E6%94%B9PYTHONPATH"><span class="toc-number">16.</span> <span class="toc-text">更改module导入的顺序：修改PYTHONPATH</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#conda-rename-env%EF%BC%9A%E5%8F%AA%E8%83%BD%E5%85%88%E5%A4%8D%E5%88%B6%E5%86%8D%E5%88%A0%E9%99%A4"><span class="toc-number">16.1.</span> <span class="toc-text">conda rename env：只能先复制再删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#conda-env%E5%9C%A8jupyter-lab%E4%B8%AD%E6%98%BE%E7%A4%BA"><span class="toc-number">16.2.</span> <span class="toc-text">conda env在jupyter lab中显示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#logging%E7%9A%84%E6%97%B6%E5%80%99%E6%9B%B4%E6%94%B9%E5%86%99%E5%85%A5%E6%A8%A1%E5%BC%8F-FileHandler%E7%9A%84mode%E5%8F%82%E6%95%B0"><span class="toc-number">16.3.</span> <span class="toc-text">logging的时候更改写入模式: FileHandler的mode参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%8Atuple%E5%8F%98%E5%9B%9Elist"><span class="toc-number">16.4.</span> <span class="toc-text">把tuple变回list</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A6%BB%E6%95%A3%E7%9A%84indices%EF%BC%88arbitrary-indices%EF%BC%89"><span class="toc-number">17.</span> <span class="toc-text">离散的indices（arbitrary indices）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%85%A7%E7%A6%BB%E6%95%A3%E7%9A%84indices-%E8%8E%B7%E5%8F%96list%E4%B8%AD%E7%9A%84index"><span class="toc-number">17.1.</span> <span class="toc-text">按照离散的indices 获取list中的index</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E7%A6%BB%E6%95%A3%E7%9A%84indices%E6%9D%A5%E7%B4%A2%E5%BC%95"><span class="toc-number">17.2.</span> <span class="toc-text">用离散的indices来索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Bobject%E7%9A%84attribute"><span class="toc-number">18.</span> <span class="toc-text">查看object的attribute</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-dict"><span class="toc-number">18.1.</span> <span class="toc-text">通过__dict__</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87vars%EF%BC%88%E5%AE%9E%E9%99%85%E4%B9%9F%E6%98%AF%E6%9F%A5%E7%9C%8B-dict"><span class="toc-number">18.2.</span> <span class="toc-text">通过vars（实际也是查看__dict__)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-dir-%E6%88%96%E8%80%85dir-%E5%88%97%E5%87%BA%E5%85%A8%E9%83%A8"><span class="toc-number">18.3.</span> <span class="toc-text">通过__dir__() 或者dir() 列出全部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%ADdict%E6%98%AF%E5%90%A6%E7%94%A8%E6%9F%90key%EF%BC%9A%E7%94%A8in"><span class="toc-number">18.4.</span> <span class="toc-text">判断dict是否用某key：用in</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ipdb-pdb%E6%9D%A1%E4%BB%B6%E6%96%AD%E7%82%B9%E8%AE%BE%E7%BD%AE"><span class="toc-number">19.</span> <span class="toc-text">Ipdb&#x2F;pdb条件断点设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Argparser-%E9%83%A8%E5%88%86%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7"><span class="toc-number">20.</span> <span class="toc-text">Argparser 部分使用技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#args%E4%BB%A5dict%E5%BD%A2%E5%BC%8F%E8%BF%94%E5%9B%9E%EF%BC%9Avars"><span class="toc-number">20.1.</span> <span class="toc-text">args以dict形式返回：vars()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Partial-parse%EF%BC%9A-parse-known-args"><span class="toc-number">20.2.</span> <span class="toc-text">Partial parse：.parse_known_args</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E5%88%86parse%EF%BC%88remove-unnecessary-args%EF%BC%89%EF%BC%9A%E9%80%9A%E8%BF%87dict%E5%88%A0%E9%99%A4%E6%88%96%E8%80%85%E7%94%A8sub-parser"><span class="toc-number">20.3.</span> <span class="toc-text">部分parse（remove unnecessary args）：通过dict删除或者用sub parser</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pdb-ipdb-%E5%9C%A8%E5%85%B6%E4%BB%96%E6%96%87%E4%BB%B6%E6%B7%BB%E5%8A%A0%E6%96%AD%E7%82%B9"><span class="toc-number">20.4.</span> <span class="toc-text">pdb&#x2F;ipdb 在其他文件添加断点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96variable%E7%9A%84name"><span class="toc-number">20.5.</span> <span class="toc-text">获取variable的name</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84%EF%BC%9A"><span class="toc-number">21.</span> <span class="toc-text">获取相对路径：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python-%E5%90%8C%E7%BA%A7%E7%9B%AE%E5%BD%95%E5%8C%85import%E9%97%AE%E9%A2%98%EF%BC%8C%E4%BD%BF%E7%94%A8%E2%80%9D-%E2%80%9D%E9%94%99%E8%AF%AF"><span class="toc-number">22.</span> <span class="toc-text">python 同级目录包import问题，使用”.”错误</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8shell%E6%96%87%E4%BB%B6%E6%9D%A5%E8%BF%90%E8%A1%8Cpython%E6%96%87%E4%BB%B6%EF%BC%9A%E6%B3%A8%E6%84%8F%E8%B7%AF%E5%BE%84"><span class="toc-number">22.1.</span> <span class="toc-text">使用shell文件来运行python文件：注意路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E5%88%B0%E5%BD%93%E5%89%8D%E7%9B%AE%E5%BD%95%EF%BC%9A"><span class="toc-number">22.2.</span> <span class="toc-text">更改文件路径到当前目录：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#argparser%E4%BD%BF%E7%94%A8bool%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="toc-number">23.</span> <span class="toc-text">argparser使用bool的问题：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96object%E7%9A%84%E5%A4%A7%E5%B0%8F"><span class="toc-number">24.</span> <span class="toc-text">获取object的大小</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#python%E5%86%85%E5%BB%BA%E7%9A%84object%E7%9A%84%E5%A4%A7%E5%B0%8F%EF%BC%9Asys-getsizeof"><span class="toc-number">24.1.</span> <span class="toc-text">python内建的object的大小：sys.getsizeof()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#numpy-array%E7%9A%84%E5%A4%A7%E5%B0%8F"><span class="toc-number">24.2.</span> <span class="toc-text">numpy array的大小</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E5%A4%9A%E4%B8%AAmodule%EF%BC%88file%EF%BC%89%E4%B9%8B%E9%97%B4%E5%85%B1%E4%BA%AB%E5%8F%98%E9%87%8F"><span class="toc-number">25.</span> <span class="toc-text">在多个module（file）之间共享变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#multiple-line-string%E7%9A%84%E5%81%9A%E6%B3%95%EF%BC%9A"><span class="toc-number">26.</span> <span class="toc-text">multiple line string的做法：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#txt%E6%96%87%E4%BB%B6IO%E8%AF%BB%E5%8F%96"><span class="toc-number">27.</span> <span class="toc-text">txt文件IO读取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9dict%E6%8E%92"><span class="toc-number">28.</span> <span class="toc-text">对dict排</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E7%85%A7dict%E7%9A%84key%E5%80%BC%E6%8E%92%E5%BA%8F"><span class="toc-number">29.</span> <span class="toc-text">按照dict的key值排序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E7%85%A7dict%E7%9A%84value%E5%80%BC%E6%8E%92%E5%BA%8F"><span class="toc-number">30.</span> <span class="toc-text">按照dict的value值排序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python%E4%B8%AD%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6"><span class="toc-number">31.</span> <span class="toc-text">python中删除文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nonlocal%E5%92%8Cglobal%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">32.</span> <span class="toc-text">nonlocal和global的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E4%BA%86conda%E7%8E%AF%E5%A2%83%E5%90%8E%EF%BC%8Cipython%E7%9A%84%E6%8C%87%E5%90%91%E4%B8%8D%E6%AD%A3%E7%A1%AE"><span class="toc-number">33.</span> <span class="toc-text">切换了conda环境后，ipython的指向不正确</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E5%9C%B0%E9%81%8D%E5%8E%86%E8%8E%B7%E5%BE%97%E6%9F%90%E4%B8%AA%E6%96%87%E4%BB%B6%E5%A4%B9%EF%BC%88%E5%8F%8A%E5%85%B6%E5%AD%90%E6%96%87%E4%BB%B6%E5%A4%B9%EF%BC%89%E6%89%80%E6%9C%89%E7%9A%84%E6%96%87%E4%BB%B6"><span class="toc-number">34.</span> <span class="toc-text">递归地遍历获得某个文件夹（及其子文件夹）所有的文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%96%E8%80%85%E7%9B%B4%E6%8E%A5%E7%94%A8os-walk"><span class="toc-number">34.1.</span> <span class="toc-text">或者直接用os.walk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#os-walk-%E6%8E%92%E9%99%A4%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">34.2.</span> <span class="toc-text">os.walk 排除文件夹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8re%E6%A8%A1%E5%9D%97%E5%90%8C%E6%97%B6%E5%88%A9%E7%94%A8%E5%A4%9A%E4%B8%AA%E5%88%86%E9%9A%94%E7%AC%A6"><span class="toc-number">35.</span> <span class="toc-text">利用re模块同时利用多个分隔符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%AD%9B%E9%80%89list"><span class="toc-number">36.</span> <span class="toc-text">用正则表达式筛选list</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">37.</span> <span class="toc-text">二维数组的初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#defaultdict"><span class="toc-number">38.</span> <span class="toc-text">defaultdict</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda%E5%87%BD%E6%95%B0%E5%B9%B6%E4%B8%8D%E6%8E%A5%E5%8F%97tuple-argument"><span class="toc-number">39.</span> <span class="toc-text">lambda函数并不接受tuple argument</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#print-list%E7%9A%84%E6%97%B6%E5%80%99%E8%87%AA%E5%8A%A8%E6%8D%A2%E8%A1%8C%EF%BC%8C%E7%BE%8E%E5%8C%96%E8%BE%93%E5%87%BA"><span class="toc-number">40.</span> <span class="toc-text">print list的时候自动换行，美化输出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eval%E5%8F%AF%E7%94%A8%E4%BA%8E%E8%AE%A1%E7%AE%97%E8%A1%A8%E8%BE%BE%E5%BC%8F-exec-%E5%8F%AF%E7%94%A8%E4%BA%8E%E8%B5%8B%E5%80%BC"><span class="toc-number">41.</span> <span class="toc-text">eval可用于计算表达式, exec 可用于赋值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%96%87%E6%9C%AC%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E8%A1%8C%EF%BC%9A%E7%9B%B4%E6%8E%A5%E7%94%A8readlines-%E7%84%B6%E5%90%8E%E5%8F%96%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0"><span class="toc-number">42.</span> <span class="toc-text">获取文本的最后一行：直接用readlines()然后取最后一个元素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E9%80%90%E8%A1%8C%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">43.</span> <span class="toc-text">生成器逐行读取文件的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BB%99%E5%AE%9A%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6"><span class="toc-number">44.</span> <span class="toc-text">获取给定目录下的所有文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E5%9C%B0%E8%8E%B7%E5%BE%97%EF%BC%88%E9%81%8D%E5%8E%86%E6%89%80%E6%9C%89%E5%AD%90%E7%9B%AE%E5%BD%95%EF%BC%89-os-walk"><span class="toc-number">44.1.</span> <span class="toc-text">递归地获得（遍历所有子目录）:os.walk()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AA%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6%E5%A4%B9-%E6%96%87%E4%BB%B6%E5%90%8D-os-listdir"><span class="toc-number">45.</span> <span class="toc-text">只列出所有文件夹&#x2F;文件名: os.listdir()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8python%E4%B8%AD%E6%89%A7%E8%A1%8Cshell%E5%91%BD%E4%BB%A4"><span class="toc-number">46.</span> <span class="toc-text">在python中执行shell命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E8%BE%93%E5%85%A5%E7%9A%84%E5%91%BD%E4%BB%A4%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89%E5%88%86%E9%9A%94%E6%88%90shell-like-syntax-shlex-split"><span class="toc-number">46.1.</span> <span class="toc-text">将输入的命令（字符串）分隔成shell-like syntax: shlex.split</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%8B%E7%9C%8B%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F%E6%89%A7%E8%A1%8C"><span class="toc-number">46.2.</span> <span class="toc-text">看看是否成功执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%BB%93%E6%9E%9C"><span class="toc-number">46.3.</span> <span class="toc-text">查看结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91%E8%87%B3%E7%AE%A1%E9%81%93PIPE"><span class="toc-number">46.3.1.</span> <span class="toc-text">重定向至管道PIPE</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Popen-PIPE-%E9%98%BB%E5%A1%9E%EF%BC%8C%E5%BE%88%E9%87%8D%E8%A6%81%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%81%EF%BC%81%EF%BC%81"><span class="toc-number">47.</span> <span class="toc-text">Popen(PIPE)阻塞，很重要的问题！！！</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Popen-wait-%E5%92%8CPopen-communicate-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">47.1.</span> <span class="toc-text">Popen.wait()和Popen.communicate()的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="toc-number">47.2.</span> <span class="toc-text">原因和解决方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Popen%E6%B5%81%E5%BC%8F%E7%9A%84stdout-stderr%E8%BE%93%E5%87%BA"><span class="toc-number">47.3.</span> <span class="toc-text">Popen流式的stdout&#x2F;stderr输出</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E5%AD%97%E5%85%B8%EF%BC%88%E7%B1%BB%E4%BC%BCspark-reduceByKey%EF%BC%89%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">48.</span> <span class="toc-text">合并字典（类似spark reduceByKey）的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#print%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0%E6%96%87%E4%BB%B6"><span class="toc-number">49.</span> <span class="toc-text">print重定向到文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%97%B6%E5%9C%B0%E5%86%99%E5%85%A5%EF%BC%88%E5%88%B7%E6%96%B0%EF%BC%89%E9%87%8D%E5%AE%9A%E5%90%91%E6%96%87%E4%BB%B6"><span class="toc-number">49.1.</span> <span class="toc-text">实时地写入（刷新）重定向文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86%E5%A4%9A%E4%B8%AA%E5%85%83%E7%B4%A0%EF%BC%88%E6%96%87%E4%BB%B6%E5%A4%B9%EF%BC%89%E7%94%A8os-path-join-%E6%8B%BC%E8%B5%B7%E6%9D%A5"><span class="toc-number">50.</span> <span class="toc-text">将多个元素（文件夹）用os.path.join()拼起来</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Popen%E5%AE%9E%E7%8E%B0%E8%B6%85%E6%97%B6%E5%85%B3%E9%97%AD%E5%AD%90%E8%BF%9B%E7%A8%8B"><span class="toc-number">51.</span> <span class="toc-text">Popen实现超时关闭子进程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%81%9A%E6%B3%95%EF%BC%9A%E4%BD%BF%E7%94%A8threading-Timer%EF%BC%8C%E5%AE%9E%E6%B5%8B%E4%B8%8D%E5%8F%AF%E8%A1%8C"><span class="toc-number">51.1.</span> <span class="toc-text">错误做法：使用threading.Timer，实测不可行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E7%A1%AE%E5%81%9A%E6%B3%95%EF%BC%9A%E4%BD%BF%E7%94%A8thread%EF%BC%8C%E5%92%8Cthread-terminate"><span class="toc-number">51.2.</span> <span class="toc-text">正确做法：使用thread，和thread.terminate()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kill%E6%95%B4%E4%B8%AA%E8%BF%9B%E7%A8%8B%E7%BB%84"><span class="toc-number">51.3.</span> <span class="toc-text">kill整个进程组</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0timeout-retry%E6%93%8D%E4%BD%9C"><span class="toc-number">52.</span> <span class="toc-text">添加timeout + retry操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-number">52.1.</span> <span class="toc-text">例子</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Walter</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>