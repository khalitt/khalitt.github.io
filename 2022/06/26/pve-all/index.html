<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>pve安装使用全流程 | null</title><meta name="keywords" content="pve"><meta name="author" content="Walter"><meta name="copyright" content="Walter"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="PVE安装参考：主要来源于张大妈  https:&#x2F;&#x2F;post.smzdm.com&#x2F;p&#x2F;ar6zmoox&#x2F; https:&#x2F;&#x2F;post.smzdm.com&#x2F;p&#x2F;a4dm98ok&#x2F;  下载 使用ultraiso安装   用diskgenius删除所有分区重新格式化如果插入u盘时提示需要格式化，大概率要重新格式化才能写入  格式化需要用到DiskGenius    恢复成功后应该就能够打开u盘了  upd">
<meta property="og:type" content="article">
<meta property="og:title" content="pve安装使用全流程">
<meta property="og:url" content="https://khalitt.github.io/2022/06/26/pve-all/index.html">
<meta property="og:site_name">
<meta property="og:description" content="PVE安装参考：主要来源于张大妈  https:&#x2F;&#x2F;post.smzdm.com&#x2F;p&#x2F;ar6zmoox&#x2F; https:&#x2F;&#x2F;post.smzdm.com&#x2F;p&#x2F;a4dm98ok&#x2F;  下载 使用ultraiso安装   用diskgenius删除所有分区重新格式化如果插入u盘时提示需要格式化，大概率要重新格式化才能写入  格式化需要用到DiskGenius    恢复成功后应该就能够打开u盘了  upd">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2022-06-26T06:44:47.000Z">
<meta property="article:modified_time" content="2022-09-04T14:06:47.945Z">
<meta property="article:author" content="Walter">
<meta property="article:tag" content="pve">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://khalitt.github.io/2022/06/26/pve-all/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"5100G1WE6M","apiKey":"c2a0f74ed768aa33e0c961937aa244bc","indexName":"prod_khalitt_github_io","hits":{"per_page":6},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'pve安装使用全流程',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-09-04 22:06:47'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="null" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/null" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">56</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">21</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Music"><i class="fa-fw /music/"></i><span> 0</span></a></li><li><a class="site-page child" href="/Movie"><i class="fa-fw /movies/"></i><span> 1</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/"></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Music"><i class="fa-fw /music/"></i><span> 0</span></a></li><li><a class="site-page child" href="/Movie"><i class="fa-fw /movies/"></i><span> 1</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">pve安装使用全流程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-06-26T06:44:47.000Z" title="Created 2022-06-26 14:44:47">2022-06-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-09-04T14:06:47.945Z" title="Updated 2022-09-04 22:06:47">2022-09-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/nas/">nas</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">11.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>47min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="pve安装使用全流程"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="PVE安装"><a href="#PVE安装" class="headerlink" title="PVE安装"></a>PVE安装</h1><p>参考：主要来源于张大妈</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://post.smzdm.com/p/ar6zmoox/">https://post.smzdm.com/p/ar6zmoox/</a></li>
<li><a target="_blank" rel="noopener" href="https://post.smzdm.com/p/a4dm98ok/">https://post.smzdm.com/p/a4dm98ok/</a></li>
</ol>
<p>下载</p>
<p>使用ultraiso安装</p>
<p><img src="/2022/06/26/pve-all/image-20220626152733835.png" alt="image-20220626152733835"></p>
<p><img src="/2022/06/26/pve-all/image-20220626152807814.png" alt="image-20220626152807814"></p>
<h2 id="用diskgenius删除所有分区重新格式化"><a href="#用diskgenius删除所有分区重新格式化" class="headerlink" title="用diskgenius删除所有分区重新格式化"></a>用diskgenius删除所有分区重新格式化</h2><p>如果插入u盘时提示需要格式化，大概率要重新格式化才能写入</p>
<p><img src="/2022/06/26/pve-all/image-20220626153040221.png" alt="image-20220626153040221"></p>
<p>格式化需要用到DiskGenius</p>
<p><img src="/2022/06/26/pve-all/image-20220626152930413.png" alt="image-20220626152930413"></p>
<p><img src="/2022/06/26/pve-all/image-20220626153200746.png" alt="image-20220626153200746"></p>
<p><img src="/2022/06/26/pve-all/image-20220626153234507.png" alt="image-20220626153234507"></p>
<p>恢复成功后应该就能够打开u盘了</p>
<p><img src="/2022/06/26/pve-all/image-20220626153324459.png" alt="image-20220626153324459"></p>
<h2 id="update-先用rufus安装，再切换到ultraiso重新安装就可以了"><a href="#update-先用rufus安装，再切换到ultraiso重新安装就可以了" class="headerlink" title="update 先用rufus安装，再切换到ultraiso重新安装就可以了"></a>update 先用rufus安装，再切换到ultraiso重新安装就可以了</h2><p><img src="/2022/06/26/pve-all/image-20220626154419319.png" alt="image-20220626154419319"></p>
<p><img src="/2022/06/26/pve-all/image-20220626154603331.png" alt="image-20220626154603331"></p>
<p><img src="/2022/06/26/pve-all/image-20220626155439675.png" alt="image-20220626155439675"></p>
<h1 id="pve设置"><a href="#pve设置" class="headerlink" title="pve设置"></a>pve设置</h1><h2 id="ssh免密登陆"><a href="#ssh免密登陆" class="headerlink" title="ssh免密登陆"></a>ssh免密登陆</h2><p>直接搜ssh免密登陆，新建或者把已有的公钥黏贴到<code>~/.ssh/authorized_keys</code>即可</p>
<p><img src="/2022/06/26/pve-all/image-20220626163626565.png" alt="image-20220626163626565"></p>
<p><img src="/2022/06/26/pve-all/image-20220626163702658.png" alt="image-20220626163702658"></p>
<h2 id="网络设置"><a href="#网络设置" class="headerlink" title="网络设置"></a>网络设置</h2><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/tangobravo/article/details/119336503">https://blog.csdn.net/tangobravo/article/details/119336503</a></p>
<p>网络不通，检查以下几个参数</p>
<p><code>/etc/network/interfaces</code>，其中gateway填写路由器地址即可</p>
<p><img src="/2022/06/26/pve-all/image-20220626164007247.png" alt="image-20220626164007247"></p>
<p><code>/etc/hosts</code>一般不用改，安装的时候已经设置好了</p>
<p><img src="/2022/06/26/pve-all/image-20220626164026759.png" alt="image-20220626164026759"></p>
<p><code>/etc/resolv.conf </code>重头戏，需要改，主要是添加dns，比如下面添加了两个，一个国内一个国外</p>
<p><img src="/2022/06/26/pve-all/image-20220626164157731.png" alt="image-20220626164157731"></p>
<p>最后运行下面的命令重启网络服务</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">service</span> networking restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h2 id="更换源（强烈建议更换）"><a href="#更换源（强烈建议更换）" class="headerlink" title="更换源（强烈建议更换）"></a>更换源（强烈建议更换）</h2><h3 id="APT源"><a href="#APT源" class="headerlink" title="APT源"></a>APT源</h3><p>参考：</p>
<ol>
<li>强烈推荐USTC的源设置说明，非常方便<a target="_blank" rel="noopener" href="https://mirrors.ustc.edu.cn/help/proxmox.html">https://mirrors.ustc.edu.cn/help/proxmox.html</a></li>
</ol>
<p>这一步不是必选的，可以在没有配置上proxychains全局代理前先替换为国内源，方便安装各种依赖包</p>
<p>先备份源</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /etc/apt/s
<span class="token function">cp</span> sources.list sources.list.bak<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p>然后参考上述参考1</p>
<ul>
<li>更换<code>source.list</code></li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s|^deb http://ftp.debian.org|deb https://mirrors.ustc.edu.cn|g'</span> /etc/apt/sources.list
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s|^deb http://security.debian.org|deb https://mirrors.ustc.edu.cn/debian-security|g'</span> /etc/apt/sources.list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2022/06/26/pve-all/image-20220626171021868.png" alt="image-20220626171021868"></p>
<ul>
<li>新增<code>pve-no-subscription.list</code></li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> /etc/os-release
<span class="token builtin class-name">echo</span> <span class="token string">"deb https://mirrors.ustc.edu.cn/proxmox/debian/pve <span class="token variable">$VERSION_CODENAME</span> pve-no-subscription"</span> <span class="token operator">></span> /etc/apt/sources.list.d/pve-no-subscription.list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<ul>
<li>最后更新（可选）</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> dist-upgrade <span class="token parameter variable">-y</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h3 id="CT-template源"><a href="#CT-template源" class="headerlink" title="CT template源"></a>CT template源</h3><p>参考：</p>
<ol>
<li>强烈推荐<a target="_blank" rel="noopener" href="https://mirrors.ustc.edu.cn/help/proxmox.html">USTC的源设置说明</a>，非常方便</li>
</ol>
<blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> /usr/share/perl5/PVE/APLInfo.pm /usr/share/perl5/PVE/APLInfo.pm_back
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s|http://download.proxmox.com|https://mirrors.ustc.edu.cn/proxmox|g'</span> /usr/share/perl5/PVE/APLInfo.pm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</blockquote>
<h2 id="安装proxychains-ng以及Txray"><a href="#安装proxychains-ng以及Txray" class="headerlink" title="安装proxychains-ng以及Txray"></a>安装proxychains-ng以及Txray</h2><h3 id="proxychains-ng安装"><a href="#proxychains-ng安装" class="headerlink" title="proxychains-ng安装"></a>proxychains-ng安装</h3><p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/news/245605">使用proxychains-ng实现全局代理</a></li>
<li></li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/rofl0r/proxychains-ng
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span>  gcc automake autoconf libtool <span class="token function">make</span> <span class="token comment"># 安装依赖</span>

<span class="token builtin class-name">cd</span> proxychains-ng/
./configure <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr <span class="token parameter variable">--sysconfdir</span><span class="token operator">=</span>/etc
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>安装好以后配置代理<code>/etc/proxychains.conf</code>，其中<code>1080</code>是后面Txray的默认端口</p>
<p><img src="/2022/06/26/pve-all/image-20220626172109110.png" alt="image-20220626172109110"></p>
<h3 id="Txray安装"><a href="#Txray安装" class="headerlink" title="Txray安装"></a>Txray安装</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> Txray-linux-64/Xray-core <span class="token operator">&amp;&amp;</span> <span class="token function">unzip</span> Xray-linux-64.zip <span class="token parameter variable">-d</span> Txray-linux-64/Xray-core
<span class="token function">chmod</span> u+x Txray-linux-64/Txray <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> u+x Txray-linux-64/Xray-core/xray<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p>配置环境变量</p>
<p><img src="/2022/06/26/pve-all/image-20220626175533572.png" alt="image-20220626175533572"></p>
<h3 id="Txray使用"><a href="#Txray使用" class="headerlink" title="Txray使用"></a>Txray使用</h3><ul>
<li><code>Get &quot;https://www.youtube.com&quot;: context deadline exceeded (Client.Timeout exceeded while awaiting headers)</code></li>
</ul>
<p><img src="/2022/06/26/pve-all/image-20220626222403547.png" alt="image-20220626222403547"></p>
<p><img src="/2022/06/26/pve-all/image-20220626222409739.png" alt="image-20220626222409739"></p>
<p>打开 允许来自局域网的连接，<strong>可能能缓解</strong>，问题原因未知</p>
<p><img src="/2022/06/26/pve-all/image-20220626222442872.png" alt="image-20220626222442872"></p>
<p><img src="/2022/06/26/pve-all/image-20220626222511550.png" alt="image-20220626222511550"></p>
<h1 id="linux基础使用"><a href="#linux基础使用" class="headerlink" title="linux基础使用"></a>linux基础使用</h1><h2 id="用wget或者curl下载github-release"><a href="#用wget或者curl下载github-release" class="headerlink" title="用wget或者curl下载github release"></a>用wget或者curl下载github release</h2><p>参考：<a target="_blank" rel="noopener" href="https://iogogogo.github.io/2020/02/14/cmd-download-file/">https://iogogogo.github.io/2020/02/14/cmd-download-file/</a></p>
<p>例子：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> --no-check-certificate --content-disposition https://github.com/ctripcorp/apollo/releases/download/v1.5.1/apollo-adminservice-1.5.1-github.zip

<span class="token function">curl</span> <span class="token parameter variable">-LJO</span> https://github.com/ctripcorp/apollo/releases/download/v1.5.1/apollo-adminservice-1.5.1-github.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<p>前面加上proxychains4即可实现通过代理下载</p>
<h1 id="安装群晖"><a href="#安装群晖" class="headerlink" title="安装群晖"></a>安装群晖</h1><p>参考：</p>
<ol>
<li>相当详细，<a target="_blank" rel="noopener" href="https://post.smzdm.com/p/a0dol3wr/">https://post.smzdm.com/p/a0dol3wr/</a></li>
<li>wxgas的教程，<a target="_blank" rel="noopener" href="https://wp.gxnas.com/11213.html%EF%BC%8C%E4%B9%9F%E5%BE%88%E8%AF%A6%E7%BB%86">https://wp.gxnas.com/11213.html，也很详细</a></li>
<li>很不错的教程，<a target="_blank" rel="noopener" href="https://www.modb.pro/db/337817">https://www.modb.pro/db/337817</a></li>
<li>DSM7.0.1的引导和pat下载，<a target="_blank" rel="noopener" href="https://www.openos.org/threads/2022613dsm7-x.3529/">https://www.openos.org/threads/2022613dsm7-x.3529/</a></li>
</ol>
<p>需要注意的是，下面的教程是融合了<strong>上述三个教程 + 单独试验的参数</strong>，不同的机器或者pve教程都不尽相同。除此之外，DSM的镜像也可以自己单独编译</p>
<h2 id="创建虚拟机"><a href="#创建虚拟机" class="headerlink" title="创建虚拟机"></a>创建虚拟机</h2><p><img src="/2022/06/26/pve-all/image-20220626223528093.png" alt="image-20220626223528093"></p>
<p><img src="/2022/06/26/pve-all/image-20220626223538363.png" alt="image-20220626223538363"></p>
<p>BIOS改为SeaBIOS</p>
<p><img src="/2022/06/26/pve-all/image-20220626223622184.png" alt="image-20220626223622184"></p>
<p>设成1即可，因为后面还要删掉</p>
<p><img src="/2022/06/26/pve-all/image-20220626223644630.png" alt="image-20220626223644630"></p>
<p>CPU可选host或者默认</p>
<p><img src="/2022/06/26/pve-all/image-20220626223726728.png" alt="image-20220626223726728"></p>
<p><img src="/2022/06/26/pve-all/image-20220626223733127.png" alt="image-20220626223733127"></p>
<p>分离硬盘</p>
<p><img src="/2022/06/26/pve-all/image-20220626223852711.png" alt="image-20220626223852711"></p>
<p><img src="/2022/06/26/pve-all/image-20220626223911943.png" alt="image-20220626223911943"></p>
<p>再重新添加硬盘</p>
<p><img src="/2022/06/26/pve-all/image-20220626225138966.png" alt="image-20220626225138966"></p>
<p>上传镜像</p>
<p><img src="/2022/06/26/pve-all/image-20220626223942710.png" alt="image-20220626223942710"></p>
<p><img src="/2022/06/26/pve-all/image-20220626224107775.png" alt="image-20220626224107775"></p>
<h2 id="导入镜像（推荐方法）"><a href="#导入镜像（推荐方法）" class="headerlink" title="导入镜像（推荐方法）"></a>导入镜像（推荐方法）</h2><p>找到上传的镜像位置，比如<code>/var/lib/vz/template/iso/DS918__7.1.0-42661______.img</code>，对应的虚拟机的编号是100，则<code>importdisk</code>的命令为：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">qm importdisk <span class="token number">100</span> /var/lib/vz/template/iso/DS918__7.1.0-42661______.img local-lvm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>先分离一开始新建的硬盘，然后再在这里设置，确保是sata0</p>
<p><img src="/2022/06/26/pve-all/image-20220627000933024.png" alt="image-20220627000933024"></p>
<p>然后在修改启动选项，勾选sata0</p>
<p><img src="/2022/06/26/pve-all/image-20220627005744665.png" alt="image-20220627005744665"></p>
<h2 id="配置虚拟机conf（不推荐这个方法）"><a href="#配置虚拟机conf（不推荐这个方法）" class="headerlink" title="配置虚拟机conf（不推荐这个方法）"></a><del>配置虚拟机conf（不推荐这个方法）</del></h2><p><img src="/2022/06/26/pve-all/image-20220626224615076.png" alt="image-20220626224615076"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">args: <span class="token parameter variable">-device</span> <span class="token string">'qemu-xhci,addr=0x18'</span> <span class="token parameter variable">-drive</span> <span class="token string">'id=synoboot,file=/var/lib/vz/template/iso/DS918__7.1.0-42661______.img,if=none,format=raw'</span> <span class="token parameter variable">-device</span> <span class="token string">'usb-storage,id=synoboot,drive=synoboot,bootindex=5'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这个方法存在的问题是，<strong>安装完成后不会自动重启</strong></p>
<h2 id="修改镜像文件中的grub"><a href="#修改镜像文件中的grub" class="headerlink" title="修改镜像文件中的grub"></a>修改镜像文件中的grub</h2><p>参考wxgas的教程</p>
<p>主要就是修改这两行，后面的参数</p>
<p><img src="/2022/06/26/pve-all/image-20220626231959598.png" alt="image-20220626231959598"></p>
<p>主要有：</p>
<ul>
<li>删除双网卡的设定</li>
</ul>
<p>旧版：</p>
<p>usb：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">syno_hw_version</span><span class="token operator">=</span>DS918+ <span class="token assign-left variable">console</span><span class="token operator">=</span>ttyS0,115200n8 <span class="token assign-left variable">netif_num</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">pid</span><span class="token operator">=</span>0x0001 <span class="token assign-left variable">earlycon</span><span class="token operator">=</span>uart8250,io,0x3f8,115200n8 <span class="token assign-left variable">syno_port_thaw</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">SasIdxMap</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">mac2</span><span class="token operator">=</span>001132123457 <span class="token assign-left variable">mac1</span><span class="token operator">=</span>001132123456 <span class="token assign-left variable">sn</span><span class="token operator">=</span>2022NAS123456 <span class="token assign-left variable">vid</span><span class="token operator">=</span>0x46f4 <span class="token assign-left variable">elevator</span><span class="token operator">=</span>elevator <span class="token assign-left variable">loglevel</span><span class="token operator">=</span><span class="token number">15</span> <span class="token assign-left variable">HddHotplug</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">DiskIdxMap</span><span class="token operator">=</span>00 <span class="token assign-left variable">syno_hdd_detect</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">vender_format_version</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">syno_hdd_powerup_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">log_buf_len</span><span class="token operator">=</span>32M <span class="token assign-left variable">root</span><span class="token operator">=</span>/dev/md0 <span class="token assign-left variable">SataPortMap</span><span class="token operator">=</span><span class="token number">1</span> 

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p>sata</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">syno_hw_version</span><span class="token operator">=</span>DS918+ <span class="token assign-left variable">console</span><span class="token operator">=</span>ttyS0,115200n8 <span class="token assign-left variable">netif_num</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">pid</span><span class="token operator">=</span>0x0001 <span class="token assign-left variable">earlycon</span><span class="token operator">=</span>uart8250,io,0x3f8,115200n8 <span class="token assign-left variable">synoboot_satadom</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">syno_port_thaw</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">SasIdxMap</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">mac2</span><span class="token operator">=</span>001132123457 <span class="token assign-left variable">mac1</span><span class="token operator">=</span>001132123456 <span class="token assign-left variable">sn</span><span class="token operator">=</span>2022NAS123456 <span class="token assign-left variable">vid</span><span class="token operator">=</span>0x46f4 <span class="token assign-left variable">elevator</span><span class="token operator">=</span>elevator <span class="token assign-left variable">loglevel</span><span class="token operator">=</span><span class="token number">15</span> <span class="token assign-left variable">HddHotplug</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">DiskIdxMap</span><span class="token operator">=</span>00 <span class="token assign-left variable">syno_hdd_detect</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">vender_format_version</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">syno_hdd_powerup_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">log_buf_len</span><span class="token operator">=</span>32M <span class="token assign-left variable">root</span><span class="token operator">=</span>/dev/md0 <span class="token assign-left variable">SataPortMap</span><span class="token operator">=</span><span class="token number">1</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>





<p>新版：</p>
<p>usb：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">syno_hw_version</span><span class="token operator">=</span>DS918+ <span class="token assign-left variable">console</span><span class="token operator">=</span>ttyS0,115200n8 <span class="token assign-left variable">netif_num</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">pid</span><span class="token operator">=</span>0x0001 <span class="token assign-left variable">earlycon</span><span class="token operator">=</span>uart8250,io,0x3f8,115200n8 <span class="token assign-left variable">syno_port_thaw</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">SasIdxMap</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">mac1</span><span class="token operator">=</span>001132123456 <span class="token assign-left variable">sn</span><span class="token operator">=</span>2022NAS123456 <span class="token assign-left variable">vid</span><span class="token operator">=</span>0x46f4 <span class="token assign-left variable">elevator</span><span class="token operator">=</span>elevator <span class="token assign-left variable">loglevel</span><span class="token operator">=</span><span class="token number">15</span> <span class="token assign-left variable">HddHotplug</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">DiskIdxMap</span><span class="token operator">=</span>00 <span class="token assign-left variable">syno_hdd_detect</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">vender_format_version</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">syno_hdd_powerup_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">log_buf_len</span><span class="token operator">=</span>32M <span class="token assign-left variable">root</span><span class="token operator">=</span>/dev/md0 <span class="token assign-left variable">SataPortMap</span><span class="token operator">=</span><span class="token number">1</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>sata：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">syno_hw_version</span><span class="token operator">=</span>DS918+ <span class="token assign-left variable">console</span><span class="token operator">=</span>ttyS0,115200n8 <span class="token assign-left variable">netif_num</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">pid</span><span class="token operator">=</span>0x0001 <span class="token assign-left variable">earlycon</span><span class="token operator">=</span>uart8250,io,0x3f8,115200n8 <span class="token assign-left variable">synoboot_satadom</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">syno_port_thaw</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">SasIdxMap</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">mac1</span><span class="token operator">=</span>001132123456 <span class="token assign-left variable">sn</span><span class="token operator">=</span>2022NAS123456 <span class="token assign-left variable">vid</span><span class="token operator">=</span>0x46f4 <span class="token assign-left variable">elevator</span><span class="token operator">=</span>elevator <span class="token assign-left variable">loglevel</span><span class="token operator">=</span><span class="token number">15</span> <span class="token assign-left variable">HddHotplug</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">DiskIdxMap</span><span class="token operator">=</span>00 <span class="token assign-left variable">syno_hdd_detect</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">vender_format_version</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">syno_hdd_powerup_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">log_buf_len</span><span class="token operator">=</span>32M <span class="token assign-left variable">root</span><span class="token operator">=</span>/dev/md0 <span class="token assign-left variable">SataPortMap</span><span class="token operator">=</span><span class="token number">1</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>成品grub（省略其余未修改部分）：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">menuentry <span class="token string">'RedPill DS918+ v7.1.0-42661 (USB, Verbose)'</span> <span class="token punctuation">&#123;</span>
	savedefault
	<span class="token builtin class-name">set</span> <span class="token assign-left variable">root</span><span class="token operator">=</span><span class="token punctuation">(</span>hd0,msdos1<span class="token punctuation">)</span>
	<span class="token builtin class-name">echo</span> Loading Linux<span class="token punctuation">..</span>.
	linux /zImage withefi earlyprintk <span class="token assign-left variable">syno_hw_version</span><span class="token operator">=</span>DS918+ <span class="token assign-left variable">console</span><span class="token operator">=</span>ttyS0,115200n8 <span class="token assign-left variable">netif_num</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">pid</span><span class="token operator">=</span>0x0001 <span class="token assign-left variable">earlycon</span><span class="token operator">=</span>uart8250,io,0x3f8,115200n8 <span class="token assign-left variable">syno_port_thaw</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">SasIdxMap</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">mac1</span><span class="token operator">=</span>001132123456 <span class="token assign-left variable">sn</span><span class="token operator">=</span>2022NAS123456 <span class="token assign-left variable">vid</span><span class="token operator">=</span>0x46f4 <span class="token assign-left variable">elevator</span><span class="token operator">=</span>elevator <span class="token assign-left variable">loglevel</span><span class="token operator">=</span><span class="token number">15</span> <span class="token assign-left variable">HddHotplug</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">DiskIdxMap</span><span class="token operator">=</span>00 <span class="token assign-left variable">syno_hdd_detect</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">vender_format_version</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">syno_hdd_powerup_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">log_buf_len</span><span class="token operator">=</span>32M <span class="token assign-left variable">root</span><span class="token operator">=</span>/dev/md0 <span class="token assign-left variable">SataPortMap</span><span class="token operator">=</span><span class="token number">1</span> 
	<span class="token builtin class-name">echo</span> Loading initramfs<span class="token punctuation">..</span>.
	initrd /rd.gz /custom.gz
	<span class="token builtin class-name">echo</span> Starting kernel with USB boot
<span class="token punctuation">&#125;</span>

menuentry <span class="token string">'RedPill DS918+ v7.1.0-42661 (SATA, Verbose)'</span> <span class="token punctuation">&#123;</span>
	savedefault
	<span class="token builtin class-name">set</span> <span class="token assign-left variable">root</span><span class="token operator">=</span><span class="token punctuation">(</span>hd0,msdos1<span class="token punctuation">)</span>
	<span class="token builtin class-name">echo</span> Loading Linux<span class="token punctuation">..</span>.
	linux /zImage withefi earlyprintk <span class="token assign-left variable">syno_hw_version</span><span class="token operator">=</span>DS918+ <span class="token assign-left variable">console</span><span class="token operator">=</span>ttyS0,115200n8 <span class="token assign-left variable">netif_num</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">pid</span><span class="token operator">=</span>0x0001 <span class="token assign-left variable">earlycon</span><span class="token operator">=</span>uart8250,io,0x3f8,115200n8 <span class="token assign-left variable">synoboot_satadom</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">syno_port_thaw</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">SasIdxMap</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">mac1</span><span class="token operator">=</span>001132123456 <span class="token assign-left variable">sn</span><span class="token operator">=</span>2022NAS123456 <span class="token assign-left variable">vid</span><span class="token operator">=</span>0x46f4 <span class="token assign-left variable">elevator</span><span class="token operator">=</span>elevator <span class="token assign-left variable">loglevel</span><span class="token operator">=</span><span class="token number">15</span> <span class="token assign-left variable">HddHotplug</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">DiskIdxMap</span><span class="token operator">=</span>00 <span class="token assign-left variable">syno_hdd_detect</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">vender_format_version</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">syno_hdd_powerup_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">log_buf_len</span><span class="token operator">=</span>32M <span class="token assign-left variable">root</span><span class="token operator">=</span>/dev/md0 <span class="token assign-left variable">SataPortMap</span><span class="token operator">=</span><span class="token number">1</span> 
	<span class="token builtin class-name">echo</span> Loading initramfs<span class="token punctuation">..</span>.
	initrd /rd.gz /custom.gz
	<span class="token builtin class-name">echo</span> Starting kernel with SATA boot
	<span class="token builtin class-name">echo</span> WARNING: SATA boot support on this platform is experimental<span class="token operator">!</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="设置硬盘直通"><a href="#设置硬盘直通" class="headerlink" title="设置硬盘直通"></a>设置硬盘直通</h2><p>参考 参考3</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ls</span> <span class="token parameter variable">-l</span> /dev/disk/by-id<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/06/26/pve-all/image-20220627005950628.png" alt="image-20220627005950628"></p>
<p>虚拟机的编号是100，sata1已经被占用，因此命令是：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># qm set VMID -sata2 /dev/disk/by-id/</span>
qm <span class="token builtin class-name">set</span> <span class="token number">100</span> <span class="token parameter variable">-sata2</span> /dev/disk/by-id/ata-WDC_WD40PURX-78AKYY0_WD-WX42DA1L45TC<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2022/06/26/pve-all/image-20220627010206578.png" alt="image-20220627010206578"></p>
<ul>
<li>最后的成品设置</li>
</ul>
<p><img src="/2022/06/26/pve-all/image-20220627010814793.png" alt="image-20220627010814793"></p>
<h3 id="关于硬盘直通的问题"><a href="#关于硬盘直通的问题" class="headerlink" title="关于硬盘直通的问题"></a>关于硬盘直通的问题</h3><p>参考：<a target="_blank" rel="noopener" href="https://wangxingcs.com/2020/0227/1411/">https://wangxingcs.com/2020/0227/1411/</a></p>
<p><img src="/2022/06/26/pve-all/image-20220702013030758.png" alt="image-20220702013030758"></p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><h3 id="一直在还原界面循环"><a href="#一直在还原界面循环" class="headerlink" title="一直在还原界面循环"></a>一直在还原界面循环</h3><p>参考：<a target="_blank" rel="noopener" href="https://www.openos.org/threads/vmware7-1-0-42661.4413/">https://www.openos.org/threads/vmware7-1-0-42661.4413/</a></p>
<p><img src="/2022/06/26/pve-all/image-20220627005238849.png" alt="image-20220627005238849"></p>
<p><strong>在安装的时候完全断外网（可以在路由器上断）</strong>，就解决了</p>
<h2 id="无法识别千兆网卡（实测并不是，virtio能够跑满千兆）"><a href="#无法识别千兆网卡（实测并不是，virtio能够跑满千兆）" class="headerlink" title="无法识别千兆网卡（实测并不是，virtio能够跑满千兆）"></a><del>无法识别千兆网卡</del>（实测并不是，virtio能够跑满千兆）</h2><p>参照iperf3使用<a target="_blank" rel="noopener" href="https://post.smzdm.com/p/ag89wxk7/%E3%80%82%E7%BE%A4%E6%99%96%E4%BD%9C%E4%B8%BA%E6%9C%8D%E5%8A%A1%E7%AB%AF%EF%BC%8Cwindows%E6%88%96%E8%80%85linux%E4%BD%9C%E4%B8%BA%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8B%E8%AF%95%E3%80%82%E9%BB%98%E8%AE%A4%E7%9A%84virtio%E9%80%9F%E5%BA%A6%E5%8F%AA%E6%9C%89%E7%99%BE%E5%85%86%EF%BC%9A">https://post.smzdm.com/p/ag89wxk7/。群晖作为服务端，windows或者linux作为客户端测试。默认的virtio速度只有百兆：</a></p>
<p><img src="/2022/06/26/pve-all/image-20220730013505676.png" alt="image-20220730013505676"></p>
<p><strong>最后发现是WiFi的问题。</strong>使用有线直接连接路由器的wan口后，速度达到了千兆。<strong>说明使用virtio做虚拟化是能够跑满千兆的！！！</strong></p>
<p><img src="/2022/06/26/pve-all/image-20220730214342969.png" alt="image-20220730214342969"></p>
<h1 id="群晖使用"><a href="#群晖使用" class="headerlink" title="群晖使用"></a>群晖使用</h1><h2 id="存储池"><a href="#存储池" class="headerlink" title="存储池"></a>存储池</h2><h3 id="导入已有的存储池"><a href="#导入已有的存储池" class="headerlink" title="导入已有的存储池"></a>导入已有的存储池</h3><p>利用<strong>在线重组</strong></p>
<p><img src="/2022/06/26/pve-all/image-20220627010520959.png" alt="image-20220627010520959"></p>
<p><img src="/2022/06/26/pve-all/image-20220627010536669.png" alt="image-20220627010536669"></p>
<p>硬盘上原有的资料都在</p>
<p><img src="/2022/06/26/pve-all/image-20220627010553909.png" alt="image-20220627010553909"></p>
<h2 id="设置NFS"><a href="#设置NFS" class="headerlink" title="设置NFS"></a>设置NFS</h2><p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://post.smzdm.com/p/a4dz4do7/">https://post.smzdm.com/p/a4dz4do7/</a></li>
<li>更推荐这种方法：<a target="_blank" rel="noopener" href="https://post.smzdm.com/p/a85g06k7/">https://post.smzdm.com/p/a85g06k7/</a></li>
</ol>
<p><img src="/2022/06/26/pve-all/image-20220629232705899.png" alt="image-20220629232705899"></p>
<p><del>更好的方法：</del></p>
<p><del>通过pve前端设置，这样所有容器都能共用</del></p>
<p>下面这种方法实际上是把NFS重新挂载处理，方便pve处理而已</p>
<p><img src="/2022/06/26/pve-all/image-20220630005051914.png" alt="image-20220630005051914"></p>
<h3 id="更好的挂载方法"><a href="#更好的挂载方法" class="headerlink" title="更好的挂载方法"></a>更好的挂载方法</h3><p>注意到群晖本身就支持网路区段设置。所以实际上是可以将整个路由器的区段都加进的</p>
<p><img src="/2022/06/26/pve-all/image-20220703142733221.png" alt="image-20220703142733221"></p>
<p>参考<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/450407655">https://zhuanlan.zhihu.com/p/450407655</a></p>
<p><img src="/2022/06/26/pve-all/image-20220703142821671.png" alt="image-20220703142821671"></p>
<p>所以这里只需要根据路由器的区段，整个一起设置。比如路由器是192.168.68.1，那么可以设置为192.168.68.0&#x2F;24。<strong>这样子就把整个192.168.68.1~196.168.68.254都囊括了进来</strong></p>
<p><img src="/2022/06/26/pve-all/image-20220703142928806.png" alt="image-20220703142928806"></p>
<p>实测也没有问题</p>
<h3 id="20220904更新（以这个为准）"><a href="#20220904更新（以这个为准）" class="headerlink" title="20220904更新（以这个为准）"></a>20220904更新（以这个为准）</h3><p>强烈建议除了使用网段之外，也把权限映射加上，这样就可以避免后续的权限问题</p>
<p><img src="/2022/06/26/pve-all/image-20220904121405132.png" alt="image-20220904121405132"></p>
<p>实在没法连接的，考虑单独添加进来也可以</p>
<p><img src="/2022/06/26/pve-all/image-20220904121434878.png" alt="image-20220904121434878"></p>
<h2 id="和windows-x2F-Mac文件共享"><a href="#和windows-x2F-Mac文件共享" class="headerlink" title="和windows&#x2F;Mac文件共享"></a>和windows&#x2F;Mac文件共享</h2><p>建议直接用Samba协议，Mac和windows用起来都非常方便，其中账户直接用登陆DSM管理界面的账号即可，进去以后所有文件都能看到</p>
<p><img src="/2022/06/26/pve-all/image-20220701233425046.png" alt="image-20220701233425046"></p>
<p><img src="/2022/06/26/pve-all/image-20220701233440403.png" alt="image-20220701233440403"></p>
<p>速度和直接NFS差不多</p>
<p><img src="/2022/06/26/pve-all/image-20220701233528414.png" alt="image-20220701233528414"></p>
<p>NFS：</p>
<p>实测更慢……</p>
<p><img src="/2022/06/26/pve-all/image-20220703113450907.png" alt="image-20220703113450907"></p>
<h3 id="NFS-x2F-SMB速度慢的问题（实测并不存在速度不同的问题）"><a href="#NFS-x2F-SMB速度慢的问题（实测并不存在速度不同的问题）" class="headerlink" title="NFS&#x2F;SMB速度慢的问题（实测并不存在速度不同的问题）"></a><del>NFS&#x2F;SMB速度慢的问题</del>（实测并不存在速度不同的问题）</h3><p><img src="/2022/06/26/pve-all/image-20220703113522759.png" alt="image-20220703113522759"></p>
<p>依旧很慢</p>
<p><img src="/2022/06/26/pve-all/image-20220703113657188.png" alt="image-20220703113657188"></p>
<p>在mac上用NFS和SMB都测试过了，速度基本能够达到800M+，说明已经跑满了。按住option键点击wifi按钮即可看到</p>
<p>SMB：</p>
<p><img src="/2022/06/26/pve-all/image-20220703114548367.png" alt="image-20220703114548367"></p>
<p>NFS mac下基本也能达到这个速率，但是实际感受SMB更快</p>
<p><img src="/2022/06/26/pve-all/image-20220703120619778.png" alt="image-20220703120619778"></p>
<p>实际最后通过在windows下的wsl和mac的terminal中直接用iperf3对群晖的ip测速，发现二者的速度是一样的：</p>
<ul>
<li>在WiFi状态下只能达到百兆级别</li>
<li>只有在有线连接（网线接路由器wan口）才能达到千兆级别</li>
</ul>
<p><strong>因此可以断定，所谓windows速度比mac慢的问题并不存在。在WiFi状态下，windows和mac一样慢，要跑满千兆必须得使用有线连接，或者更换路由器！！</strong></p>
<h2 id="portainer中添加了自动挂载，但是docker-jellyfin经常没有挂载成功的问题"><a href="#portainer中添加了自动挂载，但是docker-jellyfin经常没有挂载成功的问题" class="headerlink" title="portainer中添加了自动挂载，但是docker jellyfin经常没有挂载成功的问题"></a>portainer中添加了自动挂载，但是docker jellyfin经常没有挂载成功的问题</h2><p>但是手动重启portainer的LXC容器，或者重启docker jellyfin之后，又可以了，怀疑是启动顺序的原因。因此调整启动顺序：</p>
<ul>
<li>群晖先于portainer启动</li>
<li>群晖的启动延时至少有30s。<strong>这点才是关键！！群晖启动之后NFS服务并不是马上成功的，因此需要延时！！！</strong></li>
</ul>
<p><img src="/2022/06/26/pve-all/image-20220904121724733.png" alt="image-20220904121724733"></p>
<h2 id="DDNS"><a href="#DDNS" class="headerlink" title="DDNS"></a>DDNS</h2><h3 id="前置工作"><a href="#前置工作" class="headerlink" title="前置工作"></a>前置工作</h3><p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.ioiox.com/archives/105.html%EF%BC%8C%E4%B8%BB%E8%A6%81%E5%8F%82%E8%80%83%E5%89%8D%E9%9D%A2cloudflare%E8%AE%BE%E7%BD%AE%E7%9A%84%E9%83%A8%E5%88%86">https://www.ioiox.com/archives/105.html，主要参考前面cloudflare设置的部分</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ioiox.com/archives/106.html%EF%BC%8C%E4%B8%BB%E8%A6%81%E5%8F%82%E8%80%83%E5%90%8E%E9%9D%A2docker%E8%AE%BE%E7%BD%AE%E7%9A%84%E9%83%A8%E5%88%86">https://www.ioiox.com/archives/106.html，主要参考后面docker设置的部分</a></li>
</ol>
<h4 id="cloudflare配置，不推荐，已经无法通过api修改freenom免费域名记录"><a href="#cloudflare配置，不推荐，已经无法通过api修改freenom免费域名记录" class="headerlink" title="cloudflare配置，不推荐，已经无法通过api修改freenom免费域名记录"></a><del>cloudflare配置</del>，不推荐，已经无法通过api修改freenom免费域名记录</h4><p>先添加站点，选免费的就好</p>
<p><img src="/2022/06/26/pve-all/image-20220904163935451.png" alt="image-20220904163935451"></p>
<p><img src="/2022/06/26/pve-all/image-20220904164001036.png" alt="image-20220904164001036"></p>
<p>先全部跳过，按照默认设置来，然后进入到主页面之后，复制右边的api</p>
<p><img src="/2022/06/26/pve-all/image-20220904164108987.png" alt="image-20220904164108987"></p>
<p>获取api令牌，直接使用模板，改成所有区域即可</p>
<p><img src="/2022/06/26/pve-all/image-20220904164220078.png" alt="image-20220904164220078"></p>
<p><img src="/2022/06/26/pve-all/image-20220904164332330.png" alt="image-20220904164332330"></p>
<p>注意保管好生成的令牌！后续看不到</p>
<p><img src="/2022/06/26/pve-all/image-20220904164423318.png" alt="image-20220904164423318"></p>
<p>再去到freenom的页面，修改对应的namserver</p>
<p><img src="/2022/06/26/pve-all/image-20220904173003150.png" alt="image-20220904173003150"></p>
<p><img src="/2022/06/26/pve-all/image-20220904173046071.png" alt="image-20220904173046071"></p>
<p>等待几分钟之后就好了</p>
<p><img src="/2022/06/26/pve-all/image-20220904173628746.png" alt="image-20220904173628746"></p>
<p><strong>实测会失败！！！！无法通过API修改！！！</strong></p>
<p><img src="/2022/06/26/pve-all/image-20220904183724089.png" alt="image-20220904183724089"></p>
<h3 id="dnspod"><a href="#dnspod" class="headerlink" title="dnspod"></a>dnspod</h3><p><img src="/2022/06/26/pve-all/image-20220904185425181.png" alt="image-20220904185425181"></p>
<p><img src="/2022/06/26/pve-all/image-20220904185524781.png" alt="image-20220904185524781"></p>
<p>同样是修改DNS服务器</p>
<p><img src="/2022/06/26/pve-all/image-20220904185829151.png" alt="image-20220904185829151"></p>
<p>没问题之后获取API密匙</p>
<p><img src="/2022/06/26/pve-all/image-20220904190007029.png" alt="image-20220904190007029"></p>
<p><img src="/2022/06/26/pve-all/image-20220904190111921.png" alt="image-20220904190111921"></p>
<p><img src="/2022/06/26/pve-all/image-20220904190139183.png" alt="image-20220904190139183"></p>
<p>id和token都需要</p>
<h3 id="ddns-go部署"><a href="#ddns-go部署" class="headerlink" title="ddns go部署"></a>ddns go部署</h3><p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://csyan.cn/2021/08/%E7%BE%A4%E6%99%96%EF%BC%9A%E4%BD%BF%E7%94%A8ddns-go%E5%A5%97%E4%BB%B6%E5%AE%9E%E7%8E%B0ipv6%E5%8A%A8%E6%80%81%E8%A7%A3%E6%9E%90.html%EF%BC%8C%E6%AF%94%E8%BE%83%E8%AF%A6%E7%BB%86%E7%9A%84%E6%95%99%E7%A8%8B">https://csyan.cn/2021/08/%E7%BE%A4%E6%99%96%EF%BC%9A%E4%BD%BF%E7%94%A8ddns-go%E5%A5%97%E4%BB%B6%E5%AE%9E%E7%8E%B0ipv6%E5%8A%A8%E6%80%81%E8%A7%A3%E6%9E%90.html，比较详细的教程</a></li>
</ol>
<p><img src="/2022/06/26/pve-all/image-20220904164807974.png" alt="image-20220904164807974"></p>
<p>参考<a target="_blank" rel="noopener" href="https://registry.hub.docker.com/r/jeessy/ddns-go/">官方文档</a>的配置：</p>
<p><img src="/2022/06/26/pve-all/image-20220904164909186.png" alt="image-20220904164909186"></p>
<p><img src="/2022/06/26/pve-all/image-20220904164939168.png" alt="image-20220904164939168"></p>
<p>打开<code>http://群晖IP:9876</code>，填入刚刚获得的token，并启用ipv6，修改成网卡获取</p>
<p><img src="/2022/06/26/pve-all/image-20220904171232058.png" alt="image-20220904171232058"></p>
<p><img src="/2022/06/26/pve-all/image-20220904171416076.png" alt="image-20220904171416076"></p>
<p>**注意domains那里要填写需要的域名，可以添加主机记录，比如域名是<code>example.com</code>，那么可以填写<code>ddns.example.com</code>**。如果希望多个域名，则可以用<code>ddns1:ddns2:example.com</code>这样</p>
<p><img src="/2022/06/26/pve-all/image-20220904190915797.png" alt="image-20220904190915797"></p>
<p>推送方面，可以通过注册个人企业微信，在企业微信群中添加机器人，得到对应的webhook，然后</p>
<p>参考的信息：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"msgtype"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
    <span class="token property">"text"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"#&#123;ipv6Domains&#125; 获取ipv6地址结果：#&#123;ipv6Result&#125;，新的ipv6地址：#&#123;ipv6Addr&#125;"</span><span class="token punctuation">,</span>
		<span class="token property">"mentioned_list"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"@all"</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>设置成功的话，可以在日志里看到</p>
<p><img src="/2022/06/26/pve-all/image-20220904190623519.png" alt="image-20220904190623519"></p>
<h2 id="安全设置"><a href="#安全设置" class="headerlink" title="安全设置"></a>安全设置</h2><p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://hin.cool/posts/nasec.html">https://hin.cool/posts/nasec.html</a> 很详细</li>
</ol>
<p>主要就设置几个地方：</p>
<ol>
<li>关闭admin账号</li>
<li>如果开启ssh，要把默认的端口改成其他的，非22&#x2F;23&#x2F;80&#x2F;8080的</li>
<li>开启账户保护</li>
</ol>
<p><img src="/2022/06/26/pve-all/image-20220904175734244.png" alt="image-20220904175734244"></p>
<p><img src="/2022/06/26/pve-all/image-20220904175717212.png" alt="image-20220904175717212"></p>
<h1 id="PVE使用windows系统"><a href="#PVE使用windows系统" class="headerlink" title="PVE使用windows系统"></a>PVE使用windows系统</h1><p>参考：</p>
<ol>
<li>教程贴，虽然不是很详细，但是总体还不错，<strong>注意并不一定需要用到物理的U盘来安装</strong>，<a target="_blank" rel="noopener" href="https://www.right.com.cn/forum/thread-6546634-1-1.html">https://www.right.com.cn/forum/thread-6546634-1-1.html</a></li>
<li><del>精简版windows server系统来源，包含部分使用说明，<a target="_blank" rel="noopener" href="https://www.right.com.cn/forum/forum.php?mod=viewthread&amp;tid=7500317&amp;highlight=%D1%B8%EF%BF%BD%EF%BF%BD">https://www.right.com.cn/forum/forum.php?mod=viewthread&amp;tid=7500317&amp;highlight=%D1%B8%C0%D7</a></del>，<strong>但这个版本不包含NFS管理器，不推荐</strong></li>
<li><strong>强烈建议按照这篇的进行安装！！</strong><a target="_blank" rel="noopener" href="https://www.right.com.cn/forum/thread-4129536-1-1.html%EF%BC%8C%E9%9D%9E%E5%B8%B8%E4%B8%8D%E9%94%99%EF%BC%81%EF%BC%81">https://www.right.com.cn/forum/thread-4129536-1-1.html，非常不错！！</a></li>
<li>张大妈上的文章，注意看esd是怎么转化成iso的，<a target="_blank" rel="noopener" href="https://post.smzdm.com/p/a78e79ll/">https://post.smzdm.com/p/a78e79ll/</a></li>
</ol>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="关于windows版本选择"><a href="#关于windows版本选择" class="headerlink" title="关于windows版本选择"></a>关于windows版本选择</h3><p>参考<a target="_blank" rel="noopener" href="https://www.423down.com/10032.html">https://www.423down.com/10032.html</a></p>
<p><img src="/2022/06/26/pve-all/image-20220702180537741.png" alt="image-20220702180537741"></p>
<p><del>最后选择了小修的系统<a target="_blank" rel="noopener" href="https://www.423down.com/12361.html/comment-page-2#comments">https://www.423down.com/12361.html/comment-page-2#comments</a></del>，<strong>但小修的系统依旧没有NFS</strong></p>
<p>不忘初心的系统也还行 <a target="_blank" rel="noopener" href="https://www.mpyit.com/win10ltsc2019bwcx.html%EF%BC%8C**%E5%AE%9E%E6%B5%8B%E6%9C%89NFS">https://www.mpyit.com/win10ltsc2019bwcx.html，**实测有NFS</a>**</p>
<p><img src="/2022/06/26/pve-all/image-20220702221112714.png" alt="image-20220702221112714"></p>
<p>有NFS</p>
<p><img src="/2022/06/26/pve-all/image-20220702221310172.png" alt="image-20220702221310172"></p>
<p>驱动更全，只有网卡和PCI设备没有识别</p>
<p><img src="/2022/06/26/pve-all/image-20220702221205539.png" alt="image-20220702221205539"></p>
<p>美中不足的是比较耗资源（内存）</p>
<p><img src="/2022/06/26/pve-all/image-20220702225611848.png" alt="image-20220702225611848"></p>
<p>最后的结论：</p>
<ol>
<li><strong>使用不忘初心的版本最好！！，但是比较耗资源，远程桌面略卡</strong>。可以考虑用上面的windows server精简版，用SMB协议挂载，道理是类似的，可能SMB的性能没那么好，但是也够用了。<strong>但后面切换mac发现，远程桌面卡的问题应该是笔记本的问题</strong></li>
<li>官方LTSC 2019版本不是那么好用，需要自己设置很多东西，比如远程桌面就需要自己单独设置。<strong>还不如不忘初心的。</strong></li>
</ol>
<h3 id="准备ISO"><a href="#准备ISO" class="headerlink" title="准备ISO"></a>准备ISO</h3><p>主要参考 参考4</p>
<p><img src="/2022/06/26/pve-all/image-20220702002451649.png" alt="image-20220702002451649"></p>
<p>第一步，利用winpe生成iso，此时的iso里面包含了winpe工具箱</p>
<p><img src="/2022/06/26/pve-all/image-20220701234022881.png" alt="image-20220701234022881"></p>
<p>第二步，打开ultraiso，把esd文件直接拖进去，再把KMS激活程序也解压出来，一起加进去，另存为另一个iso</p>
<p><img src="/2022/06/26/pve-all/image-20220702183922214.png" alt="image-20220702183922214"></p>
<p>最后得到两个ISO</p>
<p><img src="/2022/06/26/pve-all/image-20220701235907183.png" alt="image-20220701235907183"></p>
<p>再算上参考3的驱动ISO，总共3个</p>
<h3 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h3><h4 id="进入PE安装（esd格式的安装方法）"><a href="#进入PE安装（esd格式的安装方法）" class="headerlink" title="进入PE安装（esd格式的安装方法）"></a>进入PE安装（esd格式的安装方法）</h4><p>同样是先上传到local节点</p>
<p><img src="/2022/06/26/pve-all/image-20220702002708874.png" alt="image-20220702002708874"></p>
<p>实测用小修的系统的话，12G也够了</p>
<p><img src="/2022/06/26/pve-all/image-20220702000209128.png" alt="image-20220702000209128"></p>
<p><img src="/2022/06/26/pve-all/image-20220702000303523.png" alt="image-20220702000303523"></p>
<p><img src="/2022/06/26/pve-all/image-20220702000316480.png" alt="image-20220702000316480"></p>
<p>依次把三个ISO挂载上</p>
<p><img src="/2022/06/26/pve-all/image-20220702000418371.png" alt="image-20220702000418371"></p>
<p><img src="/2022/06/26/pve-all/image-20220702182648947.png" alt="image-20220702182648947"></p>
<p>默认使用的硬盘要注意开启SSD仿真。如果无法直接修改，就先分离硬屏，就可以修改参数了</p>
<p><img src="/2022/06/26/pve-all/image-20220828215436332.png" alt="image-20220828215436332"></p>
<p>调整启动的顺序，让wepe的iso在最上面</p>
<p><img src="/2022/06/26/pve-all/image-20220702000507951.png" alt="image-20220702000507951"></p>
<p><img src="/2022/06/26/pve-all/image-20220702182723788.png" alt="image-20220702182723788"></p>
<p>启动之后很快进入了PE</p>
<p><img src="/2022/06/26/pve-all/image-20220702000620809.png" alt="image-20220702000620809"></p>
<p>打开我的电脑，可以看到两个ISO都被挂载了，其中D盘包含了我们需要的esd</p>
<p><img src="/2022/06/26/pve-all/image-20220702000805301.png" alt="image-20220702000805301"></p>
<p>先用DiskGenius分区</p>
<p><img src="/2022/06/26/pve-all/image-20220702182033796.png" alt="image-20220702182033796"></p>
<p><img src="/2022/06/26/pve-all/image-20220702182052119.png" alt="image-20220702182052119"></p>
<p><img src="/2022/06/26/pve-all/image-20220702182106504.png" alt="image-20220702182106504"></p>
<p><img src="/2022/06/26/pve-all/image-20220702182136528.png" alt="image-20220702182136528"></p>
<p><img src="/2022/06/26/pve-all/image-20220702182150608.png" alt="image-20220702182150608"></p>
<p>建议还是不要勾选自动重启，方便后续调整虚拟机的启动顺序</p>
<p><img src="/2022/06/26/pve-all/image-20220702182213238.png" alt="image-20220702182213238"></p>
<p>安装完成后，在重启前调整启动顺序</p>
<p><img src="/2022/06/26/pve-all/image-20220702182505998.png" alt="image-20220702182505998"></p>
<p>顺利进入安装页面</p>
<p><img src="/2022/06/26/pve-all/image-20220702002159907.png" alt="image-20220702002159907"></p>
<p>最后自动进入桌面</p>
<p><img src="/2022/06/26/pve-all/image-20220702002810227.png" alt="image-20220702002810227"></p>
<h4 id="直接挂载iso安装"><a href="#直接挂载iso安装" class="headerlink" title="直接挂载iso安装"></a>直接挂载iso安装</h4><p>针对的是像不忘初心这种，下载下来就是iso的情况，直接传输到local节点。（或者直接下载到硬盘里），然后挂载到虚拟机里</p>
<p>接下来同样是先进入pe，<strong>格式化硬盘（包括建立引导）</strong>，注意这一步必不可少！！！，否则空间不足</p>
<p>然后在pe系统下，选择加载为ImDisk虚拟磁盘，可以看到多了一个盘符</p>
<p><img src="/2022/06/26/pve-all/image-20220702220045335.png" alt="image-20220702220045335"></p>
<p><img src="/2022/06/26/pve-all/image-20220702220128430.png" alt="image-20220702220128430"></p>
<p>选择sources目录下的install.esd即可</p>
<p><img src="/2022/06/26/pve-all/image-20220702220232175.png" alt="image-20220702220232175"></p>
<p>其余步骤和上面基于esd格式的安装一致</p>
<p>注意默认的是Admin版本的。如果需要普通user版本的，则需要通过iso安装。具体而言：</p>
<ul>
<li>把原始的安装iso上传到local节点并挂载</li>
<li>开机顺序选择该iso启动</li>
<li>进入安装界面后继续选择</li>
</ul>
<p>LTSC 2019版本的配置</p>
<p><img src="/2022/06/26/pve-all/image-20220828221635270.png" alt="image-20220828221635270"></p>
<p><img src="/2022/06/26/pve-all/image-20220828221652824.png" alt="image-20220828221652824"></p>
<h4 id="PS：如何直接从硬盘从挂载而不先传到local-实测下面的方法不行，必须先得导入成cd-rom镜像"><a href="#PS：如何直接从硬盘从挂载而不先传到local-实测下面的方法不行，必须先得导入成cd-rom镜像" class="headerlink" title="PS：如何直接从硬盘从挂载而不先传到local  实测下面的方法不行，必须先得导入成cd rom镜像"></a><del>PS：如何直接从硬盘从挂载而不先传到local</del>  实测下面的方法不行，必须先得导入成cd rom镜像</h4><p>创建好虚拟机之后，直接用命令即可</p>
<pre class="line-numbers language-none"><code class="language-none">qm importdisk vm-id path&#x2F;to&#x2F;iso local-lvm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<ul>
<li>首先找到镜像的位置：</li>
</ul>
<p><img src="/2022/06/26/pve-all/image-20220828214808960.png" alt="image-20220828214808960"></p>
<p>比如这里是<code>/mnt/pve/wd_nas_4t/images/cn_windows_10_enterprise_ltsc_2019_x64_dvd_9c09ff24.iso</code></p>
<ul>
<li>然后按照上面的命令格式来：</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">qm importdisk 103 &#x2F;mnt&#x2F;pve&#x2F;wd_nas_4t&#x2F;images&#x2F;cn_windows_10_enterprise_ltsc_2019_x64_dvd_9c09ff24.iso local-lvm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>可以看到传输速度更快</p>
<p><img src="/2022/06/26/pve-all/image-20220828215026935.png" alt="image-20220828215026935"></p>
<ul>
<li>导入完成后，可以看到这里有个未使用磁盘</li>
</ul>
<p><img src="/2022/06/26/pve-all/image-20220828215050871.png" alt="image-20220828215050871"></p>
<p>把这个改成sata格式即可</p>
<h5 id="正确做法"><a href="#正确做法" class="headerlink" title="正确做法"></a>正确做法</h5><ul>
<li><p>先找到位置硬屏上iso的位置</p>
</li>
<li><p>然后用<code>cp</code>命令复制到iso目录下</p>
</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> /mnt/pve/wd_nas_4t/images/cn_windows_10_enterprise_ltsc_2019_x64_dvd_9c09ff24.iso /var/lib/vz/template/iso/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<ul>
<li>其余步骤和一般的导入cdrom一样</li>
</ul>
<h3 id="安装完成后，调整启动顺序"><a href="#安装完成后，调整启动顺序" class="headerlink" title="安装完成后，调整启动顺序"></a>安装完成后，调整启动顺序</h3><p>安装完成后，先不要直接重启， 而是先关机，调整完启动顺序后再重启</p>
<p><img src="/2022/06/26/pve-all/image-20220828222029366.png" alt="image-20220828222029366"></p>
<h3 id="驱动安装"><a href="#驱动安装" class="headerlink" title="驱动安装"></a>驱动安装</h3><p><strong>可以先安装好驱动，再激活</strong></p>
<p>默认情况下可以看到以太网设备是不通的，所以需要参照参考3里面的驱动安装步骤</p>
<p>下载最新版本的驱动，<a target="_blank" rel="noopener" href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.217-2/">https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.217-2/</a></p>
<p><img src="/2022/06/26/pve-all/image-20220702003035410.png" alt="image-20220702003035410"></p>
<p><img src="/2022/06/26/pve-all/image-20220702003049286.png" alt="image-20220702003049286"></p>
<p>同样是上传后挂载，然后重启，就能在windows系统里看到了</p>
<p><img src="/2022/06/26/pve-all/image-20220702003703900.png" alt="image-20220702003703900"></p>
<p>网卡驱动：</p>
<p><img src="/2022/06/26/pve-all/image-20220702003643978.png" alt="image-20220702003643978"></p>
<p><img src="/2022/06/26/pve-all/image-20220702003724174.png" alt="image-20220702003724174"></p>
<p><img src="/2022/06/26/pve-all/image-20220702003739621.png" alt="image-20220702003739621"></p>
<p>PCI驱动则是整个目录</p>
<p><img src="/2022/06/26/pve-all/image-20220702005506528.png" alt="image-20220702005506528"></p>
<p><img src="/2022/06/26/pve-all/image-20220702005538804.png" alt="image-20220702005538804"></p>
<h3 id="激活"><a href="#激活" class="headerlink" title="激活"></a>激活</h3><p>强烈建议使用萌卡大佬的<a target="_blank" rel="noopener" href="https://www.moerats.com/kms/%EF%BC%8C%E6%8C%89%E6%95%99%E7%A8%8B%E8%8E%B7%E5%BE%97%E8%84%9A%E6%9C%AC%E5%8D%B3%E5%8F%AF">https://www.moerats.com/kms/，按教程获得脚本即可</a></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="windows系统设置"><a href="#windows系统设置" class="headerlink" title="windows系统设置"></a>windows系统设置</h3><p>设置管理员密码，方便远程桌面登陆</p>
<p><img src="/2022/06/26/pve-all/image-20220702004542363.png" alt="image-20220702004542363"></p>
<h4 id="虚拟机开启远程桌面权限"><a href="#虚拟机开启远程桌面权限" class="headerlink" title="虚拟机开启远程桌面权限"></a>虚拟机开启远程桌面权限</h4><p>LTSC 2019原版需要</p>
<p>首先参照 <a target="_blank" rel="noopener" href="http://www.aichunjing.com/xtjc/14444.html">http://www.aichunjing.com/xtjc/14444.html</a> 修改为个人电脑。然后在系统处设置相关</p>
<h4 id="远程桌面设置"><a href="#远程桌面设置" class="headerlink" title="远程桌面设置"></a>远程桌面设置</h4><p>把所有选项勾上，共享磁盘</p>
<p><img src="/2022/06/26/pve-all/image-20220702005208836.png" alt="image-20220702005208836"></p>
<h3 id="挂载NFS"><a href="#挂载NFS" class="headerlink" title="挂载NFS"></a>挂载NFS</h3><p>参考：<a target="_blank" rel="noopener" href="https://blog.51cto.com/huny/3265487">https://blog.51cto.com/huny/3265487</a></p>
<p>首先按照NFS客户端</p>
<p><img src="/2022/06/26/pve-all/image-20220702221834014.png" alt="image-20220702221834014"></p>
<p>然后找到本机ip，在DSM上添加对应的ip</p>
<p><img src="/2022/06/26/pve-all/image-20220702221935622.png" alt="image-20220702221935622"></p>
<p><img src="/2022/06/26/pve-all/image-20220702222044490.png" alt="image-20220702222044490"></p>
<p>参考参考：</p>
<p><img src="/2022/06/26/pve-all/image-20220702222253896.png" alt="image-20220702222253896"></p>
<p>这里使用的命令类似，同样是挂载的X盘，<strong>注意下面的命令要在命令提示符里面，而不能在powershel</strong>l</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mount</span> <span class="token number">192.168</span>.68.189:/volume1/nas4t X:<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/06/26/pve-all/image-20220702222247356.png" alt="image-20220702222247356"></p>
<p><img src="/2022/06/26/pve-all/image-20220702222414798.png" alt="image-20220702222414798"></p>
<p> 但是重启后刚刚的挂载已经不见了，为此需要开机自动挂载</p>
<p><img src="/2022/06/26/pve-all/image-20220702222542133.png" alt="image-20220702222542133"></p>
<h4 id="windows开机自动挂载"><a href="#windows开机自动挂载" class="headerlink" title="windows开机自动挂载"></a>windows开机自动挂载</h4><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/baidu_27583743/article/details/113524415">https://blog.csdn.net/baidu_27583743/article/details/113524415</a></p>
<p>为了实现开机自动自动挂载NFS</p>
<p>右键我的电脑-计算机管理</p>
<p><img src="/2022/06/26/pve-all/image-20220702223311175.png" alt="image-20220702223311175"></p>
<p><img src="/2022/06/26/pve-all/image-20220702223454215.png" alt="image-20220702223454215"></p>
<p><img src="/2022/06/26/pve-all/image-20220702223510660.png" alt="image-20220702223510660"></p>
<p><img src="/2022/06/26/pve-all/image-20220702223539829.png" alt="image-20220702223539829"></p>
<p>新建操作，其中的参数使用刚刚的命令行里用的参数</p>
<p><img src="/2022/06/26/pve-all/image-20220702223649938.png" alt="image-20220702223649938"></p>
<p><img src="/2022/06/26/pve-all/image-20220702223709060.png" alt="image-20220702223709060"></p>
<p><img src="/2022/06/26/pve-all/image-20220702223728305.png" alt="image-20220702223728305"></p>
<p>设置运行后尝试重启，发现已经有了</p>
<p><img src="/2022/06/26/pve-all/image-20220702223755551.png" alt="image-20220702223755551"></p>
<p>可以看到已经成功挂载了（虽然图标是X），但看任务记录已经运行成功，且可以成功传输文件</p>
<p><img src="/2022/06/26/pve-all/image-20220702224047646.png" alt="image-20220702224047646"></p>
<p><img src="/2022/06/26/pve-all/image-20220702224057957.png" alt="image-20220702224057957"></p>
<h4 id="中文乱码"><a href="#中文乱码" class="headerlink" title="中文乱码"></a>中文乱码</h4><p>参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/baidu_41909866/article/details/116305972">https://blog.csdn.net/baidu_41909866/article/details/116305972</a></p>
<p><img src="/2022/06/26/pve-all/image-20220703112537394.png" alt="image-20220703112537394"></p>
<p><img src="/2022/06/26/pve-all/image-20220703112556081.png" alt="image-20220703112556081"></p>
<p><img src="/2022/06/26/pve-all/image-20220703112613933.png" alt="image-20220703112613933"></p>
<p>重启即可</p>
<h3 id="挂载SMB"><a href="#挂载SMB" class="headerlink" title="挂载SMB"></a>挂载SMB</h3><p>注意只能挂载dsm目录下的某一个文件夹</p>
<p><img src="/2022/06/26/pve-all/image-20220702233724013.png" alt="image-20220702233724013"></p>
<p><img src="/2022/06/26/pve-all/image-20220702234033638.png" alt="image-20220702234033638"></p>
<p>比如我要挂载nas4t文件夹，则对应如下：</p>
<p><img src="/2022/06/26/pve-all/image-20220702234129272.png" alt="image-20220702234129272"></p>
<p>最后再输入账户和密码</p>
<p><img src="/2022/06/26/pve-all/image-20220702233755019.png" alt="image-20220702233755019"></p>
<p>可以看到已经映射成功了</p>
<p><img src="/2022/06/26/pve-all/image-20220702234153516.png" alt="image-20220702234153516"></p>
<p><del>实测速度比较慢</del></p>
<p><img src="/2022/06/26/pve-all/image-20220702234243747.png" alt="image-20220702234243747"></p>
<p>重新测试，速度达到千兆</p>
<p><img src="/2022/06/26/pve-all/image-20220730214523859.png" alt="image-20220730214523859"></p>
<h3 id="直接看这个！！最佳的挂载方法"><a href="#直接看这个！！最佳的挂载方法" class="headerlink" title="直接看这个！！最佳的挂载方法"></a>直接看这个！！最佳的挂载方法</h3><p>其实直接用 映射网络驱动器 即可</p>
<p>第一次映射的时候，需要登陆群晖的账号和密码</p>
<p><img src="/2022/06/26/pve-all/image-20220828223702106.png" alt="image-20220828223702106"></p>
<p>登陆成功后就能看到所有的硬盘和文件夹</p>
<p><img src="/2022/06/26/pve-all/image-20220828223856520.png" alt="image-20220828223856520"></p>
<h3 id="安卓usb文件传输"><a href="#安卓usb文件传输" class="headerlink" title="安卓usb文件传输"></a>安卓usb文件传输</h3><p>实测需要开启usb调试+运行usb安装，才有可能连接上。如果不行，反复关闭开启试试看</p>
<h1 id="pve备份"><a href="#pve备份" class="headerlink" title="pve备份"></a>pve备份</h1><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/lyace2010/article/details/108918070">https://blog.csdn.net/lyace2010/article/details/108918070</a></p>
<p><img src="/2022/06/26/pve-all/image-20220626152130072.png" alt="image-20220626152130072"></p>
<p>scp存下来即可</p>
<p>在新pve上再用scp传回去（<code>/var/lib/vz/dump</code>）即可</p>
<p><img src="/2022/06/26/pve-all/image-20220626180115245.png" alt="image-20220626180115245"></p>
<h1 id="LXC-jellyfin"><a href="#LXC-jellyfin" class="headerlink" title="LXC jellyfin"></a>LXC jellyfin</h1><h2 id="常用路径"><a href="#常用路径" class="headerlink" title="常用路径"></a>常用路径</h2><p><img src="/2022/06/26/pve-all/image-20220702231641803.png" alt="image-20220702231641803"></p>
<p>在控制台里都有，尤其关注log文件</p>
<h2 id="硬解"><a href="#硬解" class="headerlink" title="硬解"></a>硬解</h2><p>首先按照<a href="#%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A%E7%BB%99LXC%E5%AE%B9%E5%99%A8%E5%B9%B6%E7%A1%AC%E4%BB%B6">显卡直通给LXC容器并硬件</a>让LXC容器至少<code>vainfo</code>能够正确显示</p>
<p><img src="/2022/06/26/pve-all/image-20220704224715682.png" alt="image-20220704224715682"></p>
<p>然后设置<code>/dev/dri</code>的权限（这里参考司波图的教程的评论区<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ME411o7H2?share_source=copy_web%EF%BC%89">https://www.bilibili.com/video/BV1ME411o7H2?share_source=copy_web）</a></p>
<p><img src="/2022/06/26/pve-all/image-20220704225809011.png" alt="image-20220704225809011"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">777</span> /dev/dri
<span class="token comment"># 下面这一步没问题的话就不要用了</span>
<span class="token function">chown</span> <span class="token parameter variable">-R</span> nobody:users /dev/dri<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>建议只用第一步<code>chmod -R 777 /dev/dri</code>，实在还是硬件不了再用第二步</p>
<p>根据vainfo得到指令集，在jellyfin上进行设置</p>
<p><img src="/2022/06/26/pve-all/image-20220704230417162.png" alt="image-20220704230417162"></p>
<p><img src="/2022/06/26/pve-all/image-20220704230425510.png" alt="image-20220704230425510"></p>
<p><strong>注意！！非常重要</strong></p>
<p>测试硬件必须在调整成与原始视频不同的码率来进行播放，才会调用接码。如果是原始视频的码率，则不会调用GPU进行转码。例如：</p>
<ul>
<li>1080P视频调整成360P 40Mbps的码率解码</li>
<li>4K视频调整成1080P</li>
</ul>
<p>像下面这样就是已经有调用了，虽然是快的</p>
<p><img src="/2022/06/26/pve-all/image-20220704231503807.png" alt="image-20220704231503807"></p>
<h3 id="硬件权限设置"><a href="#硬件权限设置" class="headerlink" title="硬件权限设置"></a>硬件权限设置</h3><p>参考 <a target="_blank" rel="noopener" href="https://www.reddit.com/r/jellyfin/comments/r5pur8/best_transcoding_settings_for_synology_ds920/">https://www.reddit.com/r/jellyfin/comments/r5pur8/best_transcoding_settings_for_synology_ds920/</a></p>
<p><img src="/2022/06/26/pve-all/image-20220704232110725.png" alt="image-20220704232110725"></p>
<p><img src="/2022/06/26/pve-all/image-20220705223948205.png" alt="image-20220705223948205"></p>
<p>可以看到每次重启之后，<code>/dev/dri</code>目录的权限都会被重新变更（因为实际上这个目录是重新创建的），所以需要设置一个脚本自动设置权限</p>
<p>设置开机权限</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="挂载NFS目录问题"><a href="#挂载NFS目录问题" class="headerlink" title="挂载NFS目录问题"></a>挂载NFS目录问题</h3><p><img src="/2022/06/26/pve-all/image-20220702231606087.png" alt="image-20220702231606087"></p>
<p>主要是默认的启动用户是jellyfin</p>
<p><img src="/2022/06/26/pve-all/image-20220702232552621.png" alt="image-20220702232552621"></p>
<p>所以jellyfin用户并没有权限。需要添加把jellyfin添加权限</p>
<p>参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/u013197629/article/details/73608613">https://blog.csdn.net/u013197629/article/details/73608613</a></p>
<p>直接为改成所有用户都可读写即可</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> <span class="token parameter variable">-R</span> a+rw *<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>













<h3 id="备份还原后的容器问题"><a href="#备份还原后的容器问题" class="headerlink" title="备份还原后的容器问题"></a>备份还原后的容器问题</h3><p>The server is expected to host the web client, but the provided content directory is either invalid or empty: &#x2F;usr&#x2F;lib&#x2F;jellyfin&#x2F;bin&#x2F;jellyfin-web</p>
<p>参考 <a target="_blank" rel="noopener" href="https://github.com/jellyfin/jellyfin/issues/3638">https://github.com/jellyfin/jellyfin/issues/3638</a></p>
<p>直接新建软连即可</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/share/jellyfin/web/ /usr/lib/jellyfin/bin/jellyfin-web<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>





<h3 id="扫描慢"><a href="#扫描慢" class="headerlink" title="扫描慢"></a>扫描慢</h3><p>实测是刮削器慢，所以可以手动把所有刮削器和元数据器关了</p>
<p>参考 <a target="_blank" rel="noopener" href="https://blog.pakro.top/2020/solve_the_problem_that_jellyfin_scans_the_media_library_abnormally_after_manually_importing_a_large_number_of_files_at_one_time/">https://blog.pakro.top/2020/solve_the_problem_that_jellyfin_scans_the_media_library_abnormally_after_manually_importing_a_large_number_of_files_at_one_time/</a></p>
<h3 id="扫描不出本地文件夹"><a href="#扫描不出本地文件夹" class="headerlink" title="扫描不出本地文件夹"></a>扫描不出本地文件夹</h3><p>参考<a target="_blank" rel="noopener" href="https://forum.manjaro.org/t/jellyfin-cant-detect-external-drives-and-files-in-home-directory/90994/2">https://forum.manjaro.org/t/jellyfin-cant-detect-external-drives-and-files-in-home-directory/90994/2</a></p>
<p>实测是因为权限问题，默认是root用户创建的文件夹。通过这个即可解决</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> <span class="token parameter variable">-R</span> a+rx /root<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>修改权限后都能显示</p>
<p><img src="/2022/06/26/pve-all/image-20220708010823030.png" alt="image-20220708010823030"></p>
<h3 id="感觉好像没有解码？"><a href="#感觉好像没有解码？" class="headerlink" title="感觉好像没有解码？"></a>感觉好像没有解码？</h3><p>比如这个4k的视频，GPU利用率才不到10%，实测是因为编码的问题。g3220的核显不支持HEVC</p>
<p><img src="/2022/06/26/pve-all/image-20220708011342814.png" alt="image-20220708011342814"></p>
<p><img src="/2022/06/26/pve-all/image-20220708011311975.png" alt="image-20220708011311975"></p>
<h1 id="docker使用"><a href="#docker使用" class="headerlink" title="docker使用"></a>docker使用</h1><h2 id="jellyfin（更推荐使用这个）"><a href="#jellyfin（更推荐使用这个）" class="headerlink" title="jellyfin（更推荐使用这个）"></a>jellyfin（更推荐使用这个）</h2><p>核心是要硬解</p>
<p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://jellyfin.org/docs/general/administration/hardware-acceleration.html#va-api-and-qsv-hardware-acceleration-on-lxc-on-proxmox">https://jellyfin.org/docs/general/administration/hardware-acceleration.html#va-api-and-qsv-hardware-acceleration-on-lxc-on-proxmox</a> 硬解的docker配置</li>
<li><a target="_blank" rel="noopener" href="https://jellyfin.org/docs/general/administration/installing.html#container-images">https://jellyfin.org/docs/general/administration/installing.html#container-images</a> jellyfin官方文档，docker下如何配置</li>
<li><a target="_blank" rel="noopener" href="https://wp.xanderye.cn/archives/284%EF%BC%8C%E4%B8%BB%E8%A6%81%E5%8F%82%E8%80%83%E9%87%8C%E9%9D%A2docker%E7%9A%84%E9%85%8D%E7%BD%AE%E9%83%A8%E5%88%86">https://wp.xanderye.cn/archives/284，主要参考里面docker的配置部分</a></li>
</ol>
<p>前置条件：</p>
<ul>
<li>先把docker装好。docker最好是装在ubuntu的ct模板里</li>
<li>ubuntu的lxc容器已经直通了显卡</li>
</ul>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p><strong>建议直接使用jellyfin特供版</strong>的。如果是不支持iHD的核显（比如4代的cpu），也可以用官方版本的</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> pull nyanmisaka/jellyfin:latest 
<span class="token comment"># 四代也可以用jellyfin/jellfin:latest</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>







<p>参考 <a target="_blank" rel="noopener" href="https://jellyfin.org/docs/general/administration/installing.html#container-images">参考2</a>，首先创建一个文件夹<code>jellyfin</code>，同时在里面创建两个文件夹<code>cache</code>和<code>config</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> jellyfin/cache
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> jellyfin/config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p>然后新建一个<code>docker-compose.yml</code>：</p>
<ul>
<li><code>group_add</code>：参考 参考1， 在<code>/etc/group</code>里找到lxc容器的render的组(注意不是docker内部的！！！)，比如这里是108</li>
</ul>
<p><img src="/2022/06/26/pve-all/image-20220829003913351.png" alt="image-20220829003913351"></p>
<ul>
<li><code>volumes</code>：主要就是config、cache以及媒体文件夹</li>
<li><code>devices</code>：就是把宿主机（即LXC容器）里的硬件映射到container里</li>
</ul>
<p>结合参考3</p>
<p><img src="/2022/06/26/pve-all/image-20220903010544097.png" alt="image-20220903010544097"></p>
<p>最后的成品如下：</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.5"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">jellyfin</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> jellyfin/jellyfin
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> jellyfin
    <span class="token key atrule">group_add</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"108"</span>
    <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">"host"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /root/jellyfin/config<span class="token punctuation">:</span>/config
      <span class="token punctuation">-</span> /root/jellyfin/cache<span class="token punctuation">:</span>/cache
      <span class="token punctuation">-</span> /mnt/nas_wd_4t_1<span class="token punctuation">:</span>/mnt/nas_wd_4t_1
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> <span class="token string">"unless-stopped"</span>
    <span class="token key atrule">devices</span><span class="token punctuation">:</span>
      <span class="token comment"># VAAPI Devices (examples)</span>
      <span class="token punctuation">-</span> /dev/dri/renderD128<span class="token punctuation">:</span>/dev/dri/renderD128
      <span class="token punctuation">-</span> /dev/dri/card0<span class="token punctuation">:</span>/dev/dri/card0
    <span class="token comment"># Optional - alternative address used for autodiscovery</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> JELLYFIN_PublishedServerUrl=http<span class="token punctuation">:</span>//example.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>特供版的<code>nyanmisaka/jellyfin</code>的配置：</p>
<ul>
<li>多了<code>privileged</code>参数</li>
</ul>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.5"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">jellyfin</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nyanmisaka/jellyfin
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> nya<span class="token punctuation">-</span>jellyfin
    <span class="token key atrule">group_add</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"108"</span>
    <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">"host"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /root/nya<span class="token punctuation">-</span>jellyfin/config<span class="token punctuation">:</span>/config
      <span class="token punctuation">-</span> /root/nya<span class="token punctuation">-</span>jellyfin/cache<span class="token punctuation">:</span>/cache
      <span class="token punctuation">-</span> /mnt/nas_wd_4t_1<span class="token punctuation">:</span>/mnt/nas_wd_4t_1
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> <span class="token string">"unless-stopped"</span>
    <span class="token key atrule">devices</span><span class="token punctuation">:</span>
      <span class="token comment"># VAAPI Devices (examples)</span>
      <span class="token punctuation">-</span> /dev/dri/renderD128<span class="token punctuation">:</span>/dev/dri/renderD128
      <span class="token punctuation">-</span> /dev/dri/card0<span class="token punctuation">:</span>/dev/dri/card0
    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># Optional - alternative address used for autodiscovery</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> JELLYFIN_PublishedServerUrl=http<span class="token punctuation">:</span>//example.com
      <span class="token punctuation">-</span> TZ=Asia/Shanghai<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<p>最后开启容器：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h3 id="进入container进行配置"><a href="#进入container进行配置" class="headerlink" title="进入container进行配置"></a>进入container进行配置</h3><p>首先找到docker container的id，用docker ps可以看到。</p>
<p>然后用下面的命令进入docker container</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> container_id <span class="token function">bash</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p><del>进入之后，依次安装驱动和vainfo。由于g3220是haswell架构，不支持iHD，所以直接安装i965的驱动即可</del> 特供版的已经安装好了驱动，只需要安装<code>vainfo</code>即可</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> dist-upgrade <span class="token parameter variable">-y</span> <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">vim</span> <span class="token function">sudo</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> i965-va-driver vainfo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p>最后看vainfo是否能正确输出结果，没问题说明能够硬解</p>
<p><img src="/2022/06/26/pve-all/image-20220829004559661.png" alt="image-20220829004559661"></p>
<h2 id="qbittorrent"><a href="#qbittorrent" class="headerlink" title="qbittorrent"></a>qbittorrent</h2><p>同样是先创建文件夹<code>/root/qbittorrent/config</code></p>
<p><strong>不建议使用下面的镜像</strong>，而是直接使用<code>nevinee/qbittorrent</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">version: <span class="token string">"2.1"</span>
services:
  qbittorrent <span class="token builtin class-name">:</span>
    image: docker.mirrors.ustc.edu.cn/johngong/qbittorrent:latest
    container_name: qbittorrent
    environment:
      - <span class="token assign-left variable">TZ</span><span class="token operator">=</span>Asia/Shanghai
      - <span class="token assign-left variable">QB_WEBUI_PORT</span><span class="token operator">=</span><span class="token number">8989</span>
      - <span class="token assign-left variable">QB_EE_BIN</span><span class="token operator">=</span>false
      - <span class="token assign-left variable">QB_TRACKERS_UPDATE_AUTO</span><span class="token operator">=</span>true
      - <span class="token assign-left variable"><span class="token environment constant">UID</span></span><span class="token operator">=</span><span class="token number">1000</span>
      - <span class="token assign-left variable">GID</span><span class="token operator">=</span><span class="token number">1000</span>
      - <span class="token assign-left variable">UMASK</span><span class="token operator">=</span>022
    volumes:
      - /root/qbittorrent/config:/config
      - /mnt/nas_wd_4t_1:/mnt/nas_wd_4t_1
    ports:
      - <span class="token number">6881</span>:6881
      - <span class="token number">8989</span>:8989
      - <span class="token number">6881</span>:6881/udp
    restart: unless-stopped<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<p>参考<a href="nevinee/qbittorrent%E5%AE%98%E6%96%B9%E9%A1%B5%E9%9D%A2">nevinee&#x2F;qbittorrent官方页面</a>里的docker compose文件</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"2.0"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">qbittorrent</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nevinee/qbittorrent  <span class="token comment"># 如想参与测试工作可以指定nevinee/qbittorrent:unstable，如想使用集成了iyuu的版本请指定nevinee/qbittorrent:iyuu</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> qbittorrent
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> bridge
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> qbitorrent
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./data<span class="token punctuation">:</span>/data      <span class="token comment"># 配置保存目录</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>          <span class="token comment"># 下面未列出的其他环境变量请根据环境变量清单自行添加</span>
      <span class="token punctuation">-</span> WEBUI_PORT=8080   <span class="token comment"># WEBUI控制端口，可自定义</span>
      <span class="token punctuation">-</span> BT_PORT=34567     <span class="token comment"># BT监听端口，可自定义</span>
      <span class="token punctuation">-</span> PUID=1000         <span class="token comment"># 输入id -u可查询，群晖必须改</span>
      <span class="token punctuation">-</span> PGID=100          <span class="token comment"># 输入id -g可查询，群晖必须改</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8080<span class="token punctuation">:</span><span class="token number">8080</span>        <span class="token comment"># 冒号左右一致，必须同WEBUI_PORT一样，本文件中的3个8080要改一起改</span>
      <span class="token punctuation">-</span> 34567<span class="token punctuation">:</span><span class="token number">34567</span>      <span class="token comment"># 冒号左右一致，必须同BT_PORT一样，本文件中的5个34567要改一起改</span>
      <span class="token punctuation">-</span> 34567<span class="token punctuation">:</span>34567/udp  <span class="token comment"># 冒号左右一致，必须同BT_PORT一样，本文件中的5个34567要改一起改</span>
      <span class="token comment">#- 8787:8787       # 如使用的是nevinee/qbittorrent:iyuu标签，请解除本行注释</span>
    <span class="token comment">#security_opt:       # armv7设备请解除本行和下一行的注释</span>
      <span class="token comment">#- seccomp=unconfined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>得到如下成品：</p>
<ul>
<li>映射下载的文件夹</li>
<li>添加企业微信机器人。其中的web url可以参考<a target="_blank" rel="noopener" href="https://developer.work.weixin.qq.com/document/path/91770">群机器人配置说明</a>，只需在一个已有群里里添加机器人，即可获得</li>
<li>添加爱语飞飞，申请很简单，参考<a target="_blank" rel="noopener" href="http://iyuu.cn/">这里</a></li>
<li>添加python</li>
</ul>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"2.0"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">qbittorrent</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nevinee/qbittorrent<span class="token punctuation">:</span>latest<span class="token punctuation">-</span>iyuu 
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> qbittorrent
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> bridge
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> qbitorrent
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /root/qbittorrent/data<span class="token punctuation">:</span>/data
      <span class="token punctuation">-</span> /mnt/nas_wd_4t_1<span class="token punctuation">:</span>/mnt/nas_wd_4t_1
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>         
      <span class="token punctuation">-</span> WEBUI_PORT=8080 
      <span class="token punctuation">-</span> BT_PORT=34567   
      <span class="token punctuation">-</span> PUID=0       
      <span class="token punctuation">-</span> PGID=0
      <span class="token punctuation">-</span> INSTALL_PYTHON=true
      <span class="token punctuation">-</span> IYUU_TOKEN=<span class="token punctuation">...</span> <span class="token comment"># mask</span>
      <span class="token punctuation">-</span> WORK_WECHAT_BOT_KEY=<span class="token comment">#### #mask</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8080<span class="token punctuation">:</span><span class="token number">8080</span>       
      <span class="token punctuation">-</span> 34567<span class="token punctuation">:</span><span class="token number">34567</span>      
      <span class="token punctuation">-</span> 34567<span class="token punctuation">:</span>34567/udp  
      <span class="token punctuation">-</span> 8787<span class="token punctuation">:</span><span class="token number">8787</span>       <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="分类配置"><a href="#分类配置" class="headerlink" title="分类配置"></a>分类配置</h3><p>参考<a target="_blank" rel="noopener" href="https://blog.17lai.site/posts/bb600b4b/#qbittorrent%E4%BD%BF%E7%94%A8%E8%AE%BE%E7%BD%AE">https://blog.17lai.site/posts/bb600b4b/#qbittorrent%E4%BD%BF%E7%94%A8%E8%AE%BE%E7%BD%AE</a></p>
<p><img src="/2022/06/26/pve-all/image-20220904003950622.png" alt="image-20220904003950622"></p>
<p>在下载目录新建两个（or多个）文件夹，分别与标签对应</p>
<p><img src="/2022/06/26/pve-all/image-20220904004106961.png" alt="image-20220904004106961"></p>
<p><img src="/2022/06/26/pve-all/image-20220904004413045.png" alt="image-20220904004413045"></p>
<p><img src="/2022/06/26/pve-all/image-20220904004455764.png" alt="image-20220904004455764"></p>
<p><img src="/2022/06/26/pve-all/image-20220904004507778.png" alt="image-20220904004507778"></p>
<h3 id="豆瓣配置"><a href="#豆瓣配置" class="headerlink" title="豆瓣配置"></a>豆瓣配置</h3><p>参考<a target="_blank" rel="noopener" href="https://post.smzdm.com/p/ao9epg4m/">https://post.smzdm.com/p/ao9epg4m/</a></p>
<p><img src="/2022/06/26/pve-all/image-20220904011214341.png" alt="image-20220904011214341"></p>
<h2 id="jackett"><a href="#jackett" class="headerlink" title="jackett"></a>jackett</h2><p>直接安装<a target="_blank" rel="noopener" href="https://github.com/jxxghp/nas-tools/wiki/%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B">nas-tool</a>的安装教程，参考jackett官方镜像<a target="_blank" rel="noopener" href="https://hub.docker.com/r/linuxserver/jackett">https://hub.docker.com/r/linuxserver/jackett</a></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"2.1"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">jackett</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> lscr.io/linuxserver/jackett<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> jackett
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> PUID=1000
      <span class="token punctuation">-</span> PGID=1000
      <span class="token punctuation">-</span> TZ=Europe/London
      <span class="token punctuation">-</span> AUTO_UPDATE=true <span class="token comment">#optional</span>
      <span class="token punctuation">-</span> RUN_OPTS=&lt;run options here<span class="token punctuation">></span> <span class="token comment">#optional</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> &lt;path to data<span class="token punctuation">></span><span class="token punctuation">:</span>/config
      <span class="token punctuation">-</span> &lt;path to blackhole<span class="token punctuation">></span><span class="token punctuation">:</span>/downloads
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 9117<span class="token punctuation">:</span><span class="token number">9117</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>参考官方的compose文件，得到如下的<code>compose.yml</code></p>
<ul>
<li>所谓的<code>blackhole</code>，指的是jackett刮削得到的torrent种子存放目录，直接和qbitorrent的共享即可</li>
<li><code>PGID</code> <code>PUID</code>设置：参考这一段，直接用root权限即可</li>
</ul>
<p><img src="/2022/06/26/pve-all/image-20220903172901511.png" alt="image-20220903172901511"></p>
<p><img src="/2022/06/26/pve-all/image-20220903172853051.png" alt="image-20220903172853051"></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"2.1"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">jackett</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> lscr.io/linuxserver/jackett<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> jackett
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> PUID=0
      <span class="token punctuation">-</span> PGID=
      <span class="token punctuation">-</span> TZ=Asia/Shanghai
      <span class="token punctuation">-</span> AUTO_UPDATE=true <span class="token comment">#optional</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /root/jackett/config<span class="token punctuation">:</span>/config
      <span class="token punctuation">-</span> /mnt/nas_wd_4t_1/downloads/qbitorrent_download/torrent<span class="token punctuation">:</span>/downloads
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 9117<span class="token punctuation">:</span><span class="token number">9117</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="ChineseSubFinder"><a href="#ChineseSubFinder" class="headerlink" title="ChineseSubFinder"></a>ChineseSubFinder</h2><p>参考 <a target="_blank" rel="noopener" href="https://github.com/allanpk716/ChineseSubFinder/blob/master/docker/readme.md">https://github.com/allanpk716/ChineseSubFinder/blob/master/docker/readme.md</a></p>
<p>根据参考yml</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">chinesesubfinder</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> allanpk716/chinesesubfinder<span class="token punctuation">:</span>latest
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./config<span class="token punctuation">:</span>/config  <span class="token comment"># 冒号左边请修改为你想在主机上保存配置、日志等文件的路径</span>
      <span class="token punctuation">-</span> ./media<span class="token punctuation">:</span>/media    <span class="token comment"># 请修改为你的媒体目录，冒号右边可以改成你方便记忆的目录，多个媒体目录需要分别映射进来</span>
      <span class="token punctuation">-</span> ./browser<span class="token punctuation">:</span>/root/.cache/rod/browser    <span class="token comment"># 容器重启后无需再次下载 chrome，除非 go-rod 更新</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> PUID=1026         <span class="token comment"># uid</span>
      <span class="token punctuation">-</span> PGID=100          <span class="token comment"># gid</span>
      <span class="token punctuation">-</span> PERMS=true        <span class="token comment"># 是否重设/media权限</span>
      <span class="token punctuation">-</span> TZ=Asia/Shanghai  <span class="token comment"># 时区</span>
      <span class="token punctuation">-</span> UMASK=022         <span class="token comment"># 权限掩码</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> bridge
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> chinesesubfinder
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> chinesesubfinder
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 19035<span class="token punctuation">:</span><span class="token number">19035</span>  <span class="token comment"># 从0.20.0版本开始，通过webui来设置</span>
      <span class="token punctuation">-</span> 19037<span class="token punctuation">:</span><span class="token number">19037</span>  <span class="token comment"># webui 的视频列表读取图片用，务必设置不要暴露到外网</span>
    <span class="token key atrule">logging</span><span class="token punctuation">:</span>
        <span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">"json-file"</span>
        <span class="token key atrule">options</span><span class="token punctuation">:</span>
          <span class="token key atrule">max-size</span><span class="token punctuation">:</span> <span class="token string">"100m"</span> <span class="token comment"># 限制docker控制台日志大小，可自行调整</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>得到成品：</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">chinesesubfinder</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> allanpk716/chinesesubfinder<span class="token punctuation">:</span>latest
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /root/ChineseSubFinder/config<span class="token punctuation">:</span>/config
      <span class="token punctuation">-</span> /mnt/nas_wd_4t_1/videos<span class="token punctuation">:</span>/videos
      <span class="token punctuation">-</span> /root/ChineseSubFinder/browser<span class="token punctuation">:</span>/root/.cache/rod/browser   
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> PUID=0         
      <span class="token punctuation">-</span> PGID=0          
      <span class="token punctuation">-</span> PERMS=true        
      <span class="token punctuation">-</span> TZ=Asia/Shanghai  
      <span class="token punctuation">-</span> UMASK=022        
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> bridge
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> chinesesubfinder
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> chinesesubfinder
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 19035<span class="token punctuation">:</span><span class="token number">19035</span>  
      <span class="token punctuation">-</span> 19037<span class="token punctuation">:</span><span class="token number">19037</span>  
    <span class="token key atrule">logging</span><span class="token punctuation">:</span>
        <span class="token key atrule">driver</span><span class="token punctuation">:</span> <span class="token string">"json-file"</span>
        <span class="token key atrule">options</span><span class="token punctuation">:</span>
          <span class="token key atrule">max-size</span><span class="token punctuation">:</span> <span class="token string">"100m"</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="nas-tools-强烈推荐，神器！"><a href="#nas-tools-强烈推荐，神器！" class="headerlink" title="nas-tools(强烈推荐，神器！)"></a>nas-tools(强烈推荐，神器！)</h2><p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/jxxghp/nas-tools/wiki/%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B">wiki安装教程</a>，包括了各种额外的连接！强烈推荐</li>
<li><a target="_blank" rel="noopener" href="https://post.smzdm.com/p/a7nxrz2g/%E5%BC%A0%E5%A4%A7%E5%A6%88%E4%B8%8A%E7%9A%84%E6%95%99%E7%A8%8B%EF%BC%8C%E5%BE%88%E8%AF%A6%E7%BB%86">https://post.smzdm.com/p/a7nxrz2g/张大妈上的教程，很详细</a></li>
<li><a target="_blank" rel="noopener" href="https://post.smzdm.com/p/arqgoqp7/%E5%8F%A6%E4%B8%80%E4%B8%AA%E5%BC%A0%E5%A4%A7%E5%A6%88%E7%9A%84%E6%95%99%E7%A8%8B%EF%BC%8C%E4%B9%9F%E5%BE%88%E8%AF%A6%E7%BB%86">https://post.smzdm.com/p/arqgoqp7/另一个张大妈的教程，也很详细</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.17lai.site/posts/9912bd5d/">使用jeckett,sonarr,iyuu,qt,emby打造全自动追剧流程</a>，安装wiki里的学习资源，<strong>强烈推荐看看！！！</strong>，对各种工具都介绍得很详细，方便直接按图上手</li>
</ol>
<p>参考下面的<code>compose.yml</code></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.4"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">nastools</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> jxxghp/nas<span class="token punctuation">-</span>tools<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> nastools
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> nastools
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 3000<span class="token punctuation">:</span><span class="token number">3000</span>        <span class="token comment"># 默认的webui控制端口</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> $<span class="token punctuation">&#123;</span>USERDIR<span class="token punctuation">&#125;</span>/nastools/config<span class="token punctuation">:</span>/config   <span class="token comment"># 冒号左边请修改为你想保存配置的路径</span>
      <span class="token punctuation">-</span> $<span class="token punctuation">&#123;</span>USERDIR<span class="token punctuation">&#125;</span>/<span class="token punctuation">[</span>path<span class="token punctuation">]</span>/Download<span class="token punctuation">:</span>/share/Download <span class="token comment"># 映射数据目录</span>
      <span class="token comment">#- /你的媒体目录:/你想设置的容器内能见到的目录   # 媒体目录，多个目录需要分别映射进来</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> PUID=$<span class="token punctuation">&#123;</span>PUID<span class="token punctuation">&#125;</span>
      <span class="token punctuation">-</span> PGID=$<span class="token punctuation">&#123;</span>PGID<span class="token punctuation">&#125;</span>
      <span class="token punctuation">-</span> TZ=$<span class="token punctuation">&#123;</span>TZ<span class="token punctuation">&#125;</span>
      <span class="token punctuation">-</span> UMASK=022 <span class="token comment"># 掩码权限，默认000，可以考虑设置为022</span>
     <span class="token comment">#- REPO_URL=https://ghproxy.com/https://github.com/jxxghp/nas-tools.git  # 访问github困难的用户，可以取消本行注释，用以加速访问github</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.4"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">nastools</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> jxxghp/nas<span class="token punctuation">-</span>tools<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> nastools
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> nastools
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 3000<span class="token punctuation">:</span><span class="token number">3000</span>        
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /root/nas<span class="token punctuation">-</span>tools/config<span class="token punctuation">:</span>/config   
      <span class="token punctuation">-</span> /mnt/nas_wd_4t_1/downloads<span class="token punctuation">:</span>/share/Download 
      <span class="token punctuation">-</span> /mnt/nas_wd_4t_1/videos<span class="token punctuation">:</span>/videos
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> PUID=0
      <span class="token punctuation">-</span> PGID=0
      <span class="token punctuation">-</span> TZ=Asia/Shanghai
      <span class="token punctuation">-</span> UMASK=022 
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>







<h1 id="LXC-xray"><a href="#LXC-xray" class="headerlink" title="LXC xray"></a>LXC xray</h1><h1 id="LXC-clash"><a href="#LXC-clash" class="headerlink" title="LXC clash"></a>LXC clash</h1><p>需要用特权容器，否则没有<code>iptables</code></p>
<h2 id="卡死在这个界面"><a href="#卡死在这个界面" class="headerlink" title="卡死在这个界面"></a>卡死在这个界面</h2><p><img src="/2022/06/26/pve-all/image-20220706010434212.png" alt="image-20220706010434212"></p>
<p>参考 <a target="_blank" rel="noopener" href="https://github.com/vernesong/OpenClash/issues/1591">https://github.com/vernesong/OpenClash/issues/1591</a></p>
<p>切换为官方皮肤之后，发现实际是 外部控制设置</p>
<p><img src="/2022/06/26/pve-all/image-20220706011634834.png" alt="image-20220706011634834"></p>
<p>设置为当前LXC容器地址即可</p>
<h1 id="LXC-容器"><a href="#LXC-容器" class="headerlink" title="LXC 容器"></a>LXC 容器</h1><h2 id="新建特权lxc容器"><a href="#新建特权lxc容器" class="headerlink" title="新建特权lxc容器"></a>新建特权lxc容器</h2><p>注意设为特权（去除选择无特权，即有特权）。还可以把当前电脑默认的ssh公钥放上来</p>
<p><img src="/2022/06/26/pve-all/image-20220703151009100.png" alt="image-20220703151009100"></p>
<p>IP最好固定下来，网关填写路由器地址即可</p>
<p><img src="/2022/06/26/pve-all/image-20220703110344665.png" alt="image-20220703110344665"></p>
<p>最后再把这些选项都勾上，全部开启</p>
<p><img src="/2022/06/26/pve-all/image-20220703111131175.png" alt="image-20220703111131175"></p>
<p>注意！！实测用debian做容器更好！！</p>
<p><img src="/2022/06/26/pve-all/image-20220703150636521.png" alt="image-20220703150636521"></p>
<h3 id="中文乱码-1"><a href="#中文乱码-1" class="headerlink" title="中文乱码"></a>中文乱码</h3><p>参考<a target="_blank" rel="noopener" href="https://lala.im/8090.html">https://lala.im/8090.html</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">dpkg-reconfigure locales<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>按空格确定</p>
<p><img src="/2022/06/26/pve-all/image-20220703185806837.png" alt="image-20220703185806837"></p>
<h2 id="显卡直通给LXC容器硬件"><a href="#显卡直通给LXC容器硬件" class="headerlink" title="显卡直通给LXC容器硬件"></a>显卡直通给LXC容器硬件</h2><p>参考</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_38208216/article/details/122145751">https://blog.csdn.net/weixin_38208216/article/details/122145751</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.timzhong.top/2020/10/13/jellyfin-in-lxc/#%E9%87%8D%E5%A4%B4%E6%88%8F%EF%BC%8C%E9%85%8D%E7%BD%AE%E6%98%BE%E5%8D%A1%E6%8C%82%E8%BD%BD">https://blog.timzhong.top/2020/10/13/jellyfin-in-lxc/#%E9%87%8D%E5%A4%B4%E6%88%8F%EF%BC%8C%E9%85%8D%E7%BD%AE%E6%98%BE%E5%8D%A1%E6%8C%82%E8%BD%BD</a></li>
<li><strong>jellyfin的官方操作，非常重要</strong><a target="_blank" rel="noopener" href="https://jellyfin.org/docs/general/administration/hardware-acceleration.html#va-api-and-qsv-hardware-acceleration-on-lxc-on-proxmox">https://jellyfin.org/docs/general/administration/hardware-acceleration.html#va-api-and-qsv-hardware-acceleration-on-lxc-on-proxmox</a></li>
</ol>
<h3 id="在pve宿主机上安装驱动"><a href="#在pve宿主机上安装驱动" class="headerlink" title="在pve宿主机上安装驱动"></a>在pve宿主机上安装驱动</h3><p>直接<code>apt install intel-media-va-driver-non-free</code>可能会报错，原因是没有对应的源</p>
<p><img src="/2022/06/26/pve-all/image-20220703003356773.png" alt="image-20220703003356773"></p>
<p>参考</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/385401945">https://zhuanlan.zhihu.com/p/385401945</a></li>
</ol>
<p>先去<a href="https://link.zhihu.com/?target=https://software.intel.com/content/www/us/en/develop/topics/graphics-linux-drivers.html">General Purpose GPU Drivers for Linux* Operating Systems</a>，按照教程一步步来</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lspci <span class="token parameter variable">-nn</span> <span class="token operator">|</span> <span class="token function">grep</span> VGA<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/06/26/pve-all/image-20220703004411938.png" alt="image-20220703004411938"></p>
<p><img src="/2022/06/26/pve-all/image-20220703004434448.png" alt="image-20220703004434448"></p>
<p>查看到对应的核显直接用intel源，可能有问题</p>
<p><img src="/2022/06/26/pve-all/image-20220703004515037.png" alt="image-20220703004515037"></p>
<p>但实测没所谓。后退到前一页，点击ubuntu的安装方法， 按照<a target="_blank" rel="noopener" href="https://dgpu-docs.intel.com/installation-guides/ubuntu/ubuntu-focal.html">Ubuntu* 20.04 (focal)</a>的安装方法来</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> gpg-agent <span class="token function">wget</span>
<span class="token function">wget</span> <span class="token parameter variable">-qO</span> - https://repositories.intel.com/graphics/intel-graphics.key <span class="token operator">|</span>
  <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> software-properties-common
<span class="token function">sudo</span> apt-add-repository <span class="token punctuation">\</span>
  <span class="token string">'deb [arch=amd64] https://repositories.intel.com/graphics/ubuntu focal main'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>再安装所有应用。实测速度比较慢，需要用代理</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> proxychains4 <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token punctuation">\</span>
  intel-opencl-icd <span class="token punctuation">\</span>
  intel-level-zero-gpu level-zero <span class="token punctuation">\</span>
  intel-media-va-driver-non-free libmfx1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>再按照参考1的教程安装一遍</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libmfx1 libmfx-tools
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libva-dev libmfx-dev intel-media-va-driver-non-free
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> vainfo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<p>按照官方教程</p>
<p><img src="/2022/06/26/pve-all/image-20220703005251022.png" alt="image-20220703005251022"></p>
<p>可以看到root是并没有权限的</p>
<p><img src="/2022/06/26/pve-all/image-20220703005305427.png" alt="image-20220703005305427"></p>
<p>因此需要用到这一步</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> gpasswd <span class="token parameter variable">-a</span> <span class="token variable">$&#123;<span class="token environment constant">USER</span>&#125;</span> render
newgrp render<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p><strong>最后在安装vainfo，但发现并不行</strong>，原因参考知乎里说的，以及这个<a target="_blank" rel="noopener" href="https://askubuntu.com/questions/1395620/chrome-libva-error-usr-lib-x86-64-linux-gnu-dri-ihd-drv-video-so-init-failed">https://askubuntu.com/questions/1395620/chrome-libva-error-usr-lib-x86-64-linux-gnu-dri-ihd-drv-video-so-init-failed</a></p>
<p><img src="/2022/06/26/pve-all/image-20220703011050663.png" alt="image-20220703011050663"></p>
<p><img src="/2022/06/26/pve-all/image-20220703011206252.png" alt="image-20220703011206252"></p>
<p>发现pve早已经安装了所需的驱动i965-va-driver。<strong>所以只需要按照vainfo</strong></p>
<p><strong>所以需要重新把所有驱动都卸载了</strong>，参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/get_set/article/details/51276609">https://blog.csdn.net/get_set/article/details/51276609</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 删除软件及其配置文件</span>
<span class="token function">apt-get</span> <span class="token parameter variable">--purge</span> remove <span class="token operator">&lt;</span>package<span class="token operator">></span>
<span class="token comment"># 删除没用的依赖包</span>
<span class="token function">apt-get</span> autoremove <span class="token operator">&lt;</span>package<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="合理步骤"><a href="#合理步骤" class="headerlink" title="合理步骤"></a>合理步骤</h4><ul>
<li>按照intel的页面添加源</li>
<li>仅仅只按照vainfo</li>
<li>根据<a target="_blank" rel="noopener" href="https://forum.manjaro.org/t/va-api-driver-broken/30529">VA-API driver broken</a>以及知乎，在bashrc末尾添加<code>LIBVA_DRIVER_NAME=i965</code></li>
</ul>
<p>重新测试vainfo，发现无error正确输出</p>
<p><img src="/2022/06/26/pve-all/image-20220703011451062.png" alt="image-20220703011451062"></p>
<h4 id="关于4代架构的cpu是否可以使用ihd（即intel-media-driver"><a href="#关于4代架构的cpu是否可以使用ihd（即intel-media-driver" class="headerlink" title="关于4代架构的cpu是否可以使用ihd（即intel-media-driver)"></a>关于4代架构的cpu是否可以使用ihd（即<code>intel-media-driver</code>)</h4><p>参考<a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Hardware_video_acceleration_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">https://wiki.archlinux.org/title/Hardware_video_acceleration_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)</a></p>
<p><img src="/2022/06/26/pve-all/image-20220903010234914.png" alt="image-20220903010234914"></p>
<p><strong>可以看到g3220这种haswell架构的并不能使用<code>intel-media-driver</code>，即不支持iHD，也即无法使用qsv硬解！</strong>，所以<strong>只能用i965的驱动，使用vaapi硬解</strong></p>
<h3 id="配置lxc容器的conf（关键步骤！！看这里！！）"><a href="#配置lxc容器的conf（关键步骤！！看这里！！）" class="headerlink" title="配置lxc容器的conf（关键步骤！！看这里！！）"></a>配置lxc容器的conf（关键步骤！！看这里！！）</h3><p>按照官方教程中的方法</p>
<p><img src="/2022/06/26/pve-all/image-20220703111436135.png" alt="image-20220703111436135"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lxc.cgroup2.devices.allow: c <span class="token number">226</span>:0 rwm
lxc.cgroup2.devices.allow: c <span class="token number">226</span>:128 rwm
lxc.mount.entry: /dev/dri/card0 dev/dri/card0 none bind,optional,create<span class="token operator">=</span>file
lxc.mount.entry: /dev/dri/renderD128 dev/dri/renderD128 none bind,optional,create<span class="token operator">=</span>file<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<p><img src="/2022/06/26/pve-all/image-20220703111646408.png" alt="image-20220703111646408"></p>
<p>复制进来保存</p>
<h3 id="在lxc容器中安装驱动并配置"><a href="#在lxc容器中安装驱动并配置" class="headerlink" title="在lxc容器中安装驱动并配置"></a>在lxc容器中安装驱动并配置</h3><h4 id="前置设置"><a href="#前置设置" class="headerlink" title="前置设置"></a>前置设置</h4><p>首先登陆进去后调整ssh配置，允许root登陆</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vi</span> /etc/ssh/sshd_config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p><img src="/2022/06/26/pve-all/image-20220703112041725.png" alt="image-20220703112041725"></p>
<p>保存后重启ssh服务</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">service</span> <span class="token function">ssh</span> restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h5 id="更换源"><a href="#更换源" class="headerlink" title="更换源"></a>更换源</h5><ul>
<li><del>ubuntu</del>，<strong>不推荐用ubuntu，docker可能有问题</strong></li>
</ul>
<p>首先进来更换源，参考<a target="_blank" rel="noopener" href="https://mirrors.ustc.edu.cn/help/ubuntu.html">https://mirrors.ustc.edu.cn/help/ubuntu.html</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/archive.ubuntu.com/mirrors.ustc.edu.cn/g'</span> /etc/apt/sources.list<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/06/26/pve-all/image-20220703125502472.png" alt="image-20220703125502472"></p>
<p>然后也是全部更新一遍</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> dist-upgrade <span class="token parameter variable">-y</span> <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">vim</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>debian</li>
</ul>
<p>Debian的话类似 <a target="_blank" rel="noopener" href="https://mirrors.ustc.edu.cn/help/debian.html">https://mirrors.ustc.edu.cn/help/debian.html</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s|^deb http://ftp.debian.org|deb https://mirrors.ustc.edu.cn|g'</span> /etc/apt/sources.list
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s|^deb http://security.debian.org|deb https://mirrors.ustc.edu.cn/debian-security|g'</span> /etc/apt/sources.list
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/deb.debian.org/mirrors.ustc.edu.cn/g'</span> /etc/apt/sources.list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 合并成一条</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s|^deb http://ftp.debian.org|deb https://mirrors.ustc.edu.cn|g'</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s|^deb http://security.debian.org|deb https://mirrors.ustc.edu.cn/debian-security|g'</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/deb.debian.org/mirrors.ustc.edu.cn/g'</span> /etc/apt/sources.list <span class="token operator">&amp;&amp;</span> <span class="token function">cat</span> /etc/apt/sources.list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2022/06/26/pve-all/image-20220703150030190.png" alt="image-20220703150030190"></p>
<p>安装sudo，然后把驱动全部更新一遍</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> dist-upgrade <span class="token parameter variable">-y</span> <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">vim</span> <span class="token function">sudo</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h4 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> i965-va-driver vainfo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>再配置<code>bashrc</code>,<code>LIBVA_DRIVER_NAME=i965</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">LIBVA_DRIVER_NAME</span><span class="token operator">=</span>i965<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/06/26/pve-all/image-20220703125953748.png" alt="image-20220703125953748"></p>
<p>可以看到已经成功拿到了驱动</p>
<p><img src="/2022/06/26/pve-all/image-20220703151757436.png" alt="image-20220703151757436"></p>
<h2 id="安装portainer"><a href="#安装portainer" class="headerlink" title="安装portainer"></a>安装portainer</h2><p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://post.smzdm.com/p/aek7m57k/">https://post.smzdm.com/p/aek7m57k/</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.portainer.io/v/ce-2.9/start/install/server/docker/linux">Portainer官方教程</a>，</li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/">docker安装官方教程</a></li>
</ol>
<h3 id="首先得安装docker"><a href="#首先得安装docker" class="headerlink" title="首先得安装docker"></a>首先得安装docker</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token punctuation">\</span>
    ca-certificates <span class="token punctuation">\</span>
    <span class="token function">curl</span> <span class="token punctuation">\</span>
    gnupg <span class="token punctuation">\</span>
    lsb-release


<span class="token comment"># Add Docker’s official GPG key:</span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/apt/keyrings
<span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> gpg <span class="token parameter variable">--dearmor</span> <span class="token parameter variable">-o</span> /etc/apt/keyrings/docker.gpg


<span class="token comment"># Use the following command to set up the repository:</span>
<span class="token builtin class-name">echo</span> <span class="token punctuation">\</span>
  <span class="token string">"deb [arch=<span class="token variable"><span class="token variable">$(</span>dpkg --print-architecture<span class="token variable">)</span></span> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  <span class="token variable"><span class="token variable">$(</span>lsb_release <span class="token parameter variable">-cs</span><span class="token variable">)</span></span> stable"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/docker.list <span class="token operator">></span> /dev/null
  
<span class="token comment"># Preparation for docker installation</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> docker-ce docker-ce-cli containerd.io docker-compose-plugin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>查看可用的docker版本</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-cache</span> madison docker-ce<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/06/26/pve-all/image-20220703144105717.png" alt="image-20220703144105717"></p>
<p>这里选择最新版本</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> docker-ce<span class="token operator">=</span><span class="token number">5</span>:20.10.17~3-0~ubuntu-jammy docker-ce-cli<span class="token operator">=</span><span class="token number">5</span>:20.10.17~3-0~ubuntu-jammy containerd.io docker-compose-plugin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>





<p>可能遇到这个问题  docker: Error response from daemon: AppArmor enabled on system but the docker-default profile could not be loaded: </p>
<p><img src="/2022/06/26/pve-all/image-20220703144355395.png" alt="image-20220703144355395"></p>
<p><del>原因：<strong>可能和CT模版是ubuntu有关。因此需要重新更换Debian模板！！！，实测ubuntu20也一样！！！</strong></del></p>
<p>原因已查明，实测是conf的问题，调整之后就可以了</p>
<h4 id="更简单的做法（推荐！！直接一键搞定）"><a href="#更简单的做法（推荐！！直接一键搞定）" class="headerlink" title="更简单的做法（推荐！！直接一键搞定）"></a>更简单的做法（推荐！！直接一键搞定）</h4><p>参考 <a target="_blank" rel="noopener" href="https://kawsing.gitbook.io/opensystem/andoid-shou-ji/pomoxve/lxc-run-docker">https://kawsing.gitbook.io/opensystem/andoid-shou-ji/pomoxve/lxc-run-docker</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> <span class="token function">install</span> <span class="token function">curl</span> <span class="token operator">&amp;&amp;</span> <span class="token function">curl</span> <span class="token parameter variable">-sSL</span> https://get.docker.com <span class="token operator">|</span> <span class="token function">sh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>安装好之后，再运行一下helloworld测试一下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run hello-world<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/06/26/pve-all/image-20220703151941065.png" alt="image-20220703151941065"></p>
<p>最后再把docker compose安装上。参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/pushiqiang/article/details/78682323">https://blog.csdn.net/pushiqiang/article/details/78682323</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-L</span> https://get.daocloud.io/docker/compose/releases/download/1.25.1/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">`</span></span> <span class="token parameter variable">-o</span> /usr/local/bin/docker-compose
<span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2022/06/26/pve-all/image-20220703152216748.png" alt="image-20220703152216748"></p>
<h4 id="修改docker镜像源（强烈推荐改一下）"><a href="#修改docker镜像源（强烈推荐改一下）" class="headerlink" title="修改docker镜像源（强烈推荐改一下）"></a>修改docker镜像源（强烈推荐改一下）</h4><p>参考<a target="_blank" rel="noopener" href="https://mirrors.ustc.edu.cn/help/dockerhub.html">https://mirrors.ustc.edu.cn/help/dockerhub.html</a></p>
<p><img src="/2022/06/26/pve-all/image-20220703172036760.png" alt="image-20220703172036760"></p>
<p>在<code>/etc/docker/daemon.json</code>修改</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span>
  <span class="token string">"registry-mirrors"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"https://docker.mirrors.ustc.edu.cn/"</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<p>重启服务</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl restart <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h3 id="20220828-update-ubuntu-22安装docker全流程，强烈建议用ubuntu来作为ct模版！！"><a href="#20220828-update-ubuntu-22安装docker全流程，强烈建议用ubuntu来作为ct模版！！" class="headerlink" title="20220828 update ubuntu 22安装docker全流程，强烈建议用ubuntu来作为ct模版！！"></a>20220828 update ubuntu 22安装docker全流程，强烈建议用ubuntu来作为ct模版！！</h3><p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://forum.proxmox.com/threads/run-docker-inside-lxc.112004/post-483176">https://forum.proxmox.com/threads/run-docker-inside-lxc.112004/post-483176</a> 完全就是一模一样的问题！！按照其中这个老哥的回答就能解决</li>
</ol>
<p>按照下面的配置，默认是<strong>特权容器+显卡直通</strong>！！</p>
<p>核心步骤：</p>
<ul>
<li>配置特权容器+所有选项开启</li>
</ul>
<p><img src="/2022/06/26/pve-all/image-20220829002752085.png" alt="image-20220829002752085"></p>
<ul>
<li>配置conf文件</li>
</ul>
<h4 id="新建ubuntu-22的LXC容器"><a href="#新建ubuntu-22的LXC容器" class="headerlink" title="新建ubuntu 22的LXC容器"></a>新建ubuntu 22的LXC容器</h4><p>要点：</p>
<ul>
<li>特权容器！！方便直通显卡</li>
<li>所有功能都开起来</li>
</ul>
<p><img src="/2022/06/26/pve-all/image-20220829002837623.png" alt="image-20220829002837623"></p>
<p>网关这里直接使用了openwrt的虚拟机作为旁路由，<strong>这样该lxc容器里的一切源都不需要更换了</strong></p>
<p><img src="/2022/06/26/pve-all/image-20220829002846701.png" alt="image-20220829002846701"></p>
<h4 id="配置conf（核心！！）"><a href="#配置conf（核心！！）" class="headerlink" title="配置conf（核心！！）"></a>配置conf（核心！！）</h4><p>参考参考1</p>
<p><img src="/2022/06/26/pve-all/image-20220829003034055.png" alt="image-20220829003034055"></p>
<p>加上显卡直通的配置，最后该lxc容器的conf如下：</p>
<p><img src="/2022/06/26/pve-all/image-20220829003208753.png" alt="image-20220829003208753"></p>
<p>核心即下面这段</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 解决AppArmor的问题</span>
lxc.apparmor.profile: unconfined
lxc.cap.drop:
<span class="token comment"># 显卡直通，来自jellyfin的安装教程</span>
lxc.cgroup2.devices.allow: c <span class="token number">226</span>:0 rwm
lxc.cgroup2.devices.allow: c <span class="token number">226</span>:128 rwm
lxc.mount.entry: /dev/dri/card0 dev/dri/card0 none bind,optional,create<span class="token operator">=</span>file
lxc.mount.entry: /dev/dri/renderD128 dev/dri/renderD128 none bind,optional,create<span class="token operator">=</span>file<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>其余的和原来的配置相同</p>
<h3 id="安装Portainer"><a href="#安装Portainer" class="headerlink" title="安装Portainer"></a>安装Portainer</h3><p>参考：<a target="_blank" rel="noopener" href="https://docs.portainer.io/start/install/server/docker/linux%E4%BB%A5%E5%8F%8Ahttps://docs.portainer.io/start/upgrade%EF%BC%88%E5%AE%89%E8%A3%85%E7%9A%84%E5%91%BD%E4%BB%A4%E4%B8%BB%E8%A6%81%E6%98%AF%E5%90%8E%E9%9D%A2%EF%BC%89">https://docs.portainer.io/start/install/server/docker/linux以及https://docs.portainer.io/start/upgrade（安装的命令主要是后面）</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> volume create portainer_data
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8000</span>:8000 <span class="token parameter variable">-p</span> <span class="token number">9443</span>:9443 <span class="token parameter variable">--name</span><span class="token operator">=</span>portainer <span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token parameter variable">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="token parameter variable">-v</span> portainer_data:/data portainer/portainer-ce:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>docker ps</code>查看情况</p>
<p><img src="/2022/06/26/pve-all/image-20220703152710439.png" alt="image-20220703152710439"></p>
<p>用<code>https://xxx.xxx.xx.xx:9443</code>登陆</p>
<p><img src="/2022/06/26/pve-all/image-20220703152816055.png" alt="image-20220703152816055"></p>
<h3 id="docker问题"><a href="#docker问题" class="headerlink" title="docker问题"></a>docker问题</h3><h4 id="docker-exec-it-lt-container-name-gt-bin-bash执行失败"><a href="#docker-exec-it-lt-container-name-gt-bin-bash执行失败" class="headerlink" title="docker exec -it &lt;container-name&gt; /bin/bash执行失败"></a><code>docker exec -it &lt;container-name&gt; /bin/bash</code>执行失败</h4><p>提示<code>OCI runtime exec failed: exec failed: unable to start container process: open /dev/pts/0: operation not permitted: unknown</code></p>
<p>参考：<a target="_blank" rel="noopener" href="https://askubuntu.com/questions/1424317/docker-20-10-ubuntu-22-04-oci-runtime-exec-failed">https://askubuntu.com/questions/1424317/docker-20-10-ubuntu-22-04-oci-runtime-exec-failed</a></p>
<p>实测应该是版本不对，失败了，重新安装低版本的就好</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token assign-left variable">containerd.io</span><span class="token operator">=</span><span class="token number">1.6</span>.6-1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>





<h2 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h2><h3 id="挂载nfs"><a href="#挂载nfs" class="headerlink" title="挂载nfs"></a>挂载nfs</h3><p>参考</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nfs-common<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>创建本地文件夹并设置权限</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /mnt/nas_wd_4t_1 <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> <span class="token parameter variable">-R</span> a+rw /mnt/nas_wd_4t_1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>挂载命令</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mount</span> <span class="token parameter variable">-t</span> nfs <span class="token number">192.168</span>.68.189:/volume1/nas4t /mnt/nas_wd_4t_1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h4 id="设置自动挂载"><a href="#设置自动挂载" class="headerlink" title="设置自动挂载"></a>设置自动挂载</h4><p>参考：</p>
<ol>
<li>man page，主要是看看参数的含义 <a target="_blank" rel="noopener" href="https://linux.die.net/man/5/nfs">https://linux.die.net/man/5/nfs</a></li>
<li>不错的教程，还有部分参数的含义，<a target="_blank" rel="noopener" href="https://linuxopsys.com/topics/linux-nfs-mount-entry-in-fstab-with-example">https://linuxopsys.com/topics/linux-nfs-mount-entry-in-fstab-with-example</a></li>
</ol>
<p>基本的范式是</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Server:/path/to/export /local_mountpoint nfs <span class="token operator">&lt;</span>options<span class="token operator">></span> <span class="token number">0</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>所以这里可以是</p>
<ul>
<li><code>timeo</code>参数不设置，默认是60sec的等待时间</li>
<li></li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">192.168</span>.68.189:/volume1/nas4t /mnt/nas_wd_4t_1 nfs rw,hard,intr <span class="token number">0</span> <span class="token number">0</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>编辑<code> /etc/fstab</code></p>
<p><img src="/2022/06/26/pve-all/image-20220703220334055.png" alt="image-20220703220334055"></p>
<h1 id="Portainer使用"><a href="#Portainer使用" class="headerlink" title="Portainer使用"></a>Portainer使用</h1><h2 id="基础设置"><a href="#基础设置" class="headerlink" title="基础设置"></a>基础设置</h2><h3 id="设置dockerhub账号"><a href="#设置dockerhub账号" class="headerlink" title="设置dockerhub账号"></a>设置dockerhub账号</h3><p><img src="/2022/06/26/pve-all/image-20220703161123780.png" alt="image-20220703161123780"></p>
<p>不设置的话，一天只有一百次</p>
<p>先去<a target="_blank" rel="noopener" href="https://hub.docker.com/signup%E6%B3%A8%E5%86%8C%E8%B4%A6%E5%8F%B7">https://hub.docker.com/signup注册账号</a></p>
<p><img src="/2022/06/26/pve-all/image-20220703161839792.png" alt="image-20220703161839792"></p>
<p>然后输入账号密码即可</p>
<h3 id="新增中科大dockerhub源"><a href="#新增中科大dockerhub源" class="headerlink" title="新增中科大dockerhub源"></a>新增中科大dockerhub源</h3><p>直接添加<code>https://docker.mirrors.ustc.edu.cn/</code>即可</p>
<p><img src="/2022/06/26/pve-all/image-20220703172242287.png" alt="image-20220703172242287"></p>
<h2 id="jellyfin（不推荐下面的特供版，实测都会硬解失败）建议直接参考docker-jellyfin"><a href="#jellyfin（不推荐下面的特供版，实测都会硬解失败）建议直接参考docker-jellyfin" class="headerlink" title="jellyfin（不推荐下面的特供版，实测都会硬解失败）建议直接参考docker jellyfin"></a><del>jellyfin（不推荐下面的特供版，实测都会硬解失败）</del>建议直接参考<a href="#jellyfin%EF%BC%88%E6%9B%B4%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA%EF%BC%89">docker jellyfin</a></h2><h3 id="jellyfin-docker版本选择"><a href="#jellyfin-docker版本选择" class="headerlink" title="jellyfin docker版本选择"></a><del>jellyfin docker版本选择</del></h3><p>参考自<a target="_blank" rel="noopener" href="https://post.smzdm.com/p/ar65vrp7/">https://post.smzdm.com/p/ar65vrp7/</a></p>
<p><img src="/2022/06/26/pve-all/image-20220703212637080.png" alt="image-20220703212637080"></p>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><p>参考：</p>
<ol>
<li>官方docker教程<a target="_blank" rel="noopener" href="https://jellyfin.org/docs/general/administration/installing.html">https://jellyfin.org/docs/general/administration/installing.html</a></li>
<li>张大妈上很不错的教程<a target="_blank" rel="noopener" href="https://post.smzdm.com/p/avxe2p87/">https://post.smzdm.com/p/avxe2p87/</a></li>
<li>稍微有点旧<a target="_blank" rel="noopener" href="https://post.smzdm.com/p/andr9g9p/">https://post.smzdm.com/p/andr9g9p/</a></li>
</ol>
<p><del>这里选择的是中国特供版 <a target="_blank" rel="noopener" href="https://registry.hub.docker.com/r/nyanmisaka/jellyfin/">https://registry.hub.docker.com/r/nyanmisaka/jellyfin/</a></del>实测不是很好用</p>
<p>然后基于官方教程</p>
<p><img src="/2022/06/26/pve-all/image-20220703165306864.png" alt="image-20220703165306864"></p>
<p>创建两个文件夹</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> jellyfin/config 
<span class="token function">mkdir</span> jellyfin/cache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h4 id="特供版"><a href="#特供版" class="headerlink" title="特供版"></a><del>特供版</del></h4><p>拉取最新的镜像，注意更换源，或者直接在portainer界面拉</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> pull nyanmisaka/jellyfin:latest<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>根据官方参数进行修改，以及张大妈上的教程，进行修改</p>
<p><img src="/2022/06/26/pve-all/image-20220703172554992.png" alt="image-20220703172554992"></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.5"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">jellyfin</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.mirrors.ustc.edu.cn/nyanmisaka/jellyfin
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> jellyfin
    <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">"host"</span>
    <span class="token key atrule">user</span><span class="token punctuation">:</span> root
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /root/jellyfin/config<span class="token punctuation">:</span>/config
      <span class="token punctuation">-</span> /root/jellyfin/cache<span class="token punctuation">:</span>/cache
      <span class="token punctuation">-</span> /mnt/nas_wd_4t_1<span class="token punctuation">:</span>/mnt/nas_wd_4t_1
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> <span class="token string">"unless-stopped"</span>
    <span class="token key atrule">devices</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /dev/dri/renderD128<span class="token punctuation">:</span>/dev/dri/renderD128
      <span class="token punctuation">-</span> /dev/dri/card0<span class="token punctuation">:</span>/dev/dri/card0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h4 id="linuxserver版本"><a href="#linuxserver版本" class="headerlink" title="linuxserver版本"></a>linuxserver版本</h4><p>参考：<a target="_blank" rel="noopener" href="https://wbsu2003.4everland.app/2021/03/12/%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96PUID%E5%92%8CPGID/">https://wbsu2003.4everland.app/2021/03/12/%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96PUID%E5%92%8CPGID/</a></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"2.1"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">jellyfin</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.mirrors.ustc.edu.cn/linuxserver/jellyfin<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> jellyfin
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> PUID=1000
      <span class="token punctuation">-</span> PGID=1000
      <span class="token punctuation">-</span> TZ=Asia/Shanghai
      <span class="token punctuation">-</span> JELLYFIN_PublishedServerUrl=192.168.0.5 <span class="token comment">#optional</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /root/jellyfin/config<span class="token punctuation">:</span>/config
      <span class="token punctuation">-</span> /root/jellyfin/cache<span class="token punctuation">:</span>/cache
      <span class="token punctuation">-</span> /mnt/nas_wd_4t_1<span class="token punctuation">:</span>/mnt/nas_wd_4t_1
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8096<span class="token punctuation">:</span><span class="token number">8096</span>
      <span class="token punctuation">-</span> 8920<span class="token punctuation">:</span><span class="token number">8920</span> <span class="token comment">#optional</span>
      <span class="token punctuation">-</span> 7359<span class="token punctuation">:</span>7359/udp <span class="token comment">#optional</span>
      <span class="token punctuation">-</span> 1900<span class="token punctuation">:</span>1900/udp <span class="token comment">#optional</span>
    <span class="token key atrule">devices</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /dev/dri<span class="token punctuation">:</span>/dev/dri
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<ul>
<li>PGID和PUID的设置</li>
</ul>
<p><img src="/2022/06/26/pve-all/image-20220703213302019.png" alt="image-20220703213302019"></p>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p>启动后出现下面这种情况，直接把原有的库删了然后就会自动重建了</p>
<h3 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h3><p>无论是特供版还是linux-sever版，硬解始终会出问题，所以最后还是用LXC容器实现</p>
<p><img src="/2022/06/26/pve-all/image-20220703215958088.png" alt="image-20220703215958088"></p>
<h2 id="升级Portainer"><a href="#升级Portainer" class="headerlink" title="升级Portainer"></a>升级Portainer</h2><p>参考<a target="_blank" rel="noopener" href="https://docs.portainer.io/v/ce-2.9/start/upgrade/docker">https://docs.portainer.io/v/ce-2.9/start/upgrade/docker</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> stop portainer
<span class="token function">docker</span> <span class="token function">rm</span> portainer
<span class="token function">docker</span> pull portainer/portainer-ce:latest 
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8000</span>:8000 <span class="token parameter variable">-p</span> <span class="token number">9000</span>:9000 <span class="token parameter variable">-p</span> <span class="token number">9443</span>:9443 <span class="token punctuation">\</span>
    <span class="token parameter variable">--name</span><span class="token operator">=</span>portainer <span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\</span>
    <span class="token parameter variable">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="token punctuation">\</span>
    <span class="token parameter variable">-v</span> portainer_data:/data <span class="token punctuation">\</span>
    portainer/portainer-ce:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h1 id="云映像Cloud-image使用"><a href="#云映像Cloud-image使用" class="headerlink" title="云映像Cloud-image使用"></a>云映像Cloud-image使用</h1><h2 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h2><p>参考<a target="_blank" rel="noopener" href="https://pve.proxmox.com/wiki/Cloud-Init_Support">https://pve.proxmox.com/wiki/Cloud-Init_Support</a></p>
<h2 id="debian"><a href="#debian" class="headerlink" title="debian"></a>debian</h2><p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://fairysen.com/742.html%EF%BC%8C%E9%9D%9E%E5%B8%B8%E8%AF%A6%E7%BB%86%EF%BC%8C%E4%B8%94%E5%BE%88%E6%96%B0%E5%BE%88%E5%85%A8%EF%BC%8C%E5%BC%BA%E7%83%88%E5%BB%BA%E8%AE%AE">https://fairysen.com/742.html，非常详细，且很新很全，强烈建议</a></li>
<li><a target="_blank" rel="noopener" href="https://262235.xyz/index.php/archives/611/%EF%BC%8C%E9%83%A8%E5%88%86%E5%8F%82%E8%80%83">https://262235.xyz/index.php/archives/611/，部分参考</a></li>
</ol>
<p>首先下载qcow2文件，比如这里就下载到了<code>/root/images</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://cloud.debian.org/images/cloud/bullseye/latest/debian-11-nocloud-amd64.qcow2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>按照参考1的教程创建虚拟机，注意直接把硬盘删除（省了后续分离硬盘的操作），创建好的容器配置如下：</p>
<p><img src="/2022/06/26/pve-all/image-20220709175713724.png" alt="image-20220709175713724"></p>
<p>再添加cloud-init设备</p>
<p><img src="/2022/06/26/pve-all/image-20220709175738117.png" alt="image-20220709175738117"></p>
<p>进入下载目录，导入镜像</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">qm importdisk <span class="token number">108</span> debian-11-nocloud-amd64.qcow2 local-lvm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/06/26/pve-all/image-20220709175924730.png" alt="image-20220709175924730"></p>
<p>修改新添加的磁盘为SCSI，添加，并修改启动顺序</p>
<p><img src="/2022/06/26/pve-all/image-20220709175947592.png" alt="image-20220709175947592"></p>
<p><img src="/2022/06/26/pve-all/image-20220709180124867.png" alt="image-20220709180124867"></p>
<p>接下来修改Cloud-init的配置</p>
<p>参考参考1中所说的，这里具体设置用户为root，密码和网络设置自定义</p>
<blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">用户：Debian11 的模板系统，默认用户是 debian。如果是配置 root 或用户登录，此处需输入用户名即可，不输入用户名，则用默认的用户可登录。
密码：可在此处输入上面用户的密码，建议输入，否则控制台端不能登录系统。
DNS域：可输入虚拟机的域名，不输入则继承 PVE 主机的域名。
DNS服务器：如果 VM 使用其它域名解析，可在此输入，不输入则继承 PVE 主机的域名解析服务器地址。
SSH公钥：SSH 连接虚拟机的公钥，使用密钥登录 SSH。
IP配置：不输入则使用 DHCP 给虚拟机分配 IPV4 和 IPV6，可在此定义该虚拟机的 IP 地址、子网掩码以及网关地址。
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


</blockquote>
<p><img src="/2022/06/26/pve-all/image-20220709180256796.png" alt="image-20220709180256796"></p>
<h3 id="debian更换源"><a href="#debian更换源" class="headerlink" title="debian更换源"></a>debian更换源</h3><p>除了按照，<a href="#%E6%9B%B4%E6%8D%A2%E6%BA%90">更换源</a>里面debian一节进行替换外，还需要更换security的源，参考<a target="_blank" rel="noopener" href="https://mirrors.ustc.edu.cn/help/debian-security.html">https://mirrors.ustc.edu.cn/help/debian-security.html</a></p>
<p><img src="/2022/06/26/pve-all/image-20220710224335095.png" alt="image-20220710224335095"></p>
<p>具体来说就是把多余的<code>debian-security</code>删除</p>
<p>最后的<code>sources.list</code>文件</p>
<h3 id="cloud-init安装"><a href="#cloud-init安装" class="headerlink" title="cloud-init安装"></a><code>cloud-init</code>安装</h3><p>默认情况下是没有安装的，导致控制台那的配置无法生效。</p>
<p><img src="/2022/06/26/pve-all/image-20220710224451003.png" alt="image-20220710224451003"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> <span class="token function">install</span> cloud-init <span class="token parameter variable">-y</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/06/26/pve-all/image-20220710224552213.png" alt="image-20220710224552213"></p>
<h2 id="问题-2"><a href="#问题-2" class="headerlink" title="问题"></a>问题</h2><h2 id="ssh服务无法启动"><a href="#ssh服务无法启动" class="headerlink" title="ssh服务无法启动"></a>ssh服务无法启动</h2><h3 id="Failed-to-start-OpenBSD-Secure-Shell-server"><a href="#Failed-to-start-OpenBSD-Secure-Shell-server" class="headerlink" title="Failed to start OpenBSD Secure Shell server"></a>Failed to start OpenBSD Secure Shell server</h3><p><img src="/2022/06/26/pve-all/image-20220709181115530.png" alt="image-20220709181115530"></p>
<p>参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38225558/article/details/117793432">https://blog.csdn.net/qq_38225558/article/details/117793432</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ssh-keygen <span class="token parameter variable">-A</span>
systemctl restart <span class="token function">ssh</span>
systemctl restart sshd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>





<h3 id="Permission-denied-publickey"><a href="#Permission-denied-publickey" class="headerlink" title="Permission denied (publickey)."></a>Permission denied (publickey).</h3><p>参考 <a target="_blank" rel="noopener" href="https://askubuntu.com/a/337827">https://askubuntu.com/a/337827</a></p>
<p>默认情况下<code>PasswordAuthentication</code>是no，所以需要把<code>PasswordAuthentication</code>改成yes</p>
<p>之后就可以通过这个password登陆了</p>
<p>然后再把本地公钥复制到<code>~/.ssh/authorized_key</code>进去，就可以免密码登陆了</p>
<h3 id="ip设置可能无效"><a href="#ip设置可能无效" class="headerlink" title="ip设置可能无效"></a>ip设置可能无效</h3><p>虽然在设置里面设置了192.168.68.34，但是在路由器里实际看到的是</p>
<p><img src="/2022/06/26/pve-all/image-20220709181514323.png" alt="image-20220709181514323"></p>
<h1 id="openwrt（旁路由）"><a href="#openwrt（旁路由）" class="headerlink" title="openwrt（旁路由）"></a>openwrt（旁路由）</h1><p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://post.smzdm.com/p/awrx4lxm/p2/#comments">https://post.smzdm.com/p/awrx4lxm/p2/#comments</a> 相当详细，但是仅仅参考前面的配置即可</li>
<li><a target="_blank" rel="noopener" href="https://post.smzdm.com/p/a7dg5pko/">https://post.smzdm.com/p/a7dg5pko/</a> 看看单臂路由即旁路由的设置</li>
<li><a target="_blank" rel="noopener" href="https://azhuge233.com/proxmox-ve-%E5%8D%95%E7%BD%91%E5%8F%A3%E5%AE%89%E8%A3%85-koolshare-lede-x86/">https://azhuge233.com/proxmox-ve-%E5%8D%95%E7%BD%91%E5%8F%A3%E5%AE%89%E8%A3%85-koolshare-lede-x86/</a> 主要看看其中的安装步骤</li>
<li><a target="_blank" rel="noopener" href="https://moisfool.notion.site/Openwrt-3c4be24395a94c3eb887247ad6d2754f">https://moisfool.notion.site/Openwrt-3c4be24395a94c3eb887247ad6d2754f</a> openwrt旁路网关的解说</li>
<li><del><a target="_blank" rel="noopener" href="https://www.right.com.cn/forum/thread-4035785-1-1.html">https://www.right.com.cn/forum/thread-4035785-1-1.html</a> 旁路网关的基本概念</del>。实测不是很好用，esir佛跳墙版本的固件，直接默认的端口配置即可，<strong>而且当且仅当使用默认配置的时候，其余容器才能正常通过openwrt的固件进行访问</strong></li>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/drive/folders/1uRXg_krKHPrQneI3F2GNcSVRoCgkqESr">https://drive.google.com/drive/folders/1uRXg_krKHPrQneI3F2GNcSVRoCgkqESr</a> esir的固件</li>
<li><a target="_blank" rel="noopener" href="https://www.scarletdrop.cn/archives/19#toc-head-9">https://www.scarletdrop.cn/archives/19#toc-head-9</a> <strong>重点看看这个的安装步骤！！</strong></li>
<li><a target="_blank" rel="noopener" href="https://www.right.com.cn/forum/thread-2884039-1-1.html%EF%BC%8C%E5%92%8C%E7%9B%AE%E5%89%8D%E7%9A%84%E9%85%8D%E7%BD%AE%E5%87%A0%E4%B9%8E%E7%9B%B8%E5%90%8C%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%A5%BD%E5%A5%BD%E7%9C%8B%E7%9C%8B">https://www.right.com.cn/forum/thread-2884039-1-1.html，和目前的配置几乎相同，可以好好看看</a></li>
</ol>
<h2 id="新建虚拟机"><a href="#新建虚拟机" class="headerlink" title="新建虚拟机"></a>新建虚拟机</h2><p>基本按照默认配置来就可以了</p>
<ul>
<li>内存用1G绰绰有余</li>
</ul>
<p><img src="/2022/06/26/pve-all/image-20220814123514614.png" alt="image-20220814123514614"></p>
<ul>
<li>下载固件：<a target="_blank" rel="noopener" href="https://drive.google.com/drive/folders/1uRXg_krKHPrQneI3F2GNcSVRoCgkqESr">https://drive.google.com/drive/folders/1uRXg_krKHPrQneI3F2GNcSVRoCgkqESr</a> 。这里选择了佛跳墙版本的，基本选择最新的就好</li>
</ul>
<p><img src="/2022/06/26/pve-all/image-20220828133054760.png" alt="image-20220828133054760"></p>
<ul>
<li>下载好之后加载img，并且通过下面这个命令加载进来，然后修改成sata或者scsi都可。然后修改启动顺序</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">## 注意把 202 替换成自己的虚拟机 VM ID</span>
<span class="token comment">## 路径替换成上面上传镜像是记录的地址</span>
qm importdisk <span class="token number">202</span> /var/lib/vz/template/iso/openwrt-buddha-version-v5_2022_-x86-64-generic-squashfs-legacy.img local-lvm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/2022/06/26/pve-all/image-20220904112432372.png" alt="image-20220904112432372"></p>
<h2 id="设置-1"><a href="#设置-1" class="headerlink" title="设置"></a>设置</h2><p>用vnc进去之后，第一件事就是修改ip，<code>vi /etc/config/network</code>，主要是修改lan这部分：</p>
<ul>
<li>只需要修改<code>ipaddr</code>即可，后续的可以在前端管理页面修改</li>
</ul>
<p><img src="/2022/06/26/pve-all/image-20220904112719647.png" alt="image-20220904112719647"></p>
<p>修改好之后进入，默认的账号密码是root password</p>
<h3 id="网络-接口设置"><a href="#网络-接口设置" class="headerlink" title="网络-接口设置"></a>网络-接口设置</h3><p>进去之后先修改lan接口</p>
<p><img src="/2022/06/26/pve-all/image-20220904112943749.png" alt="image-20220904112943749"></p>
<p>修改重点：</p>
<ul>
<li><p>网关改成主路由的</p>
</li>
<li><p>关闭DHCP服务</p>
</li>
</ul>
<p>其余保持默认即可</p>
<p><img src="/2022/06/26/pve-all/image-20220904113028495.png" alt="image-20220904113028495"></p>
<p><img src="/2022/06/26/pve-all/image-20220904113059374.png" alt="image-20220904113059374"></p>
<p><img src="/2022/06/26/pve-all/image-20220904113145030.png" alt="image-20220904113145030"></p>
<p><img src="/2022/06/26/pve-all/image-20220904113153925.png" alt="image-20220904113153925"></p>
<p><img src="/2022/06/26/pve-all/image-20220904113218117.png" alt="image-20220904113218117"></p>
<p><img src="/2022/06/26/pve-all/image-20220904113227651.png" alt="image-20220904113227651"></p>
<p>额外可以优化的点：</p>
<ul>
<li>做旁路由的话，无需桥接，因此可以把桥接的选项去除，记得选择eth0</li>
</ul>
<h3 id="网络-防火墙设置"><a href="#网络-防火墙设置" class="headerlink" title="网络-防火墙设置"></a>网络-防火墙设置</h3><p>基本保持默认即可，<del>只需去除FullCone-NAT</del>，存疑，根据<a target="_blank" rel="noopener" href="https://moisfool.notion.site/Openwrt-3c4be24395a94c3eb887247ad6d2754f">Openwrt 作为旁路网关</a>，只需要关闭SYN-flood防御，开启FullCone-NAT，<strong>实测开着FullCone-NAT也能正常代理，且速度差不多</strong></p>
<p><img src="/2022/06/26/pve-all/image-20220904113331934.png" alt="image-20220904113331934"></p>
<h3 id="PassWall设置"><a href="#PassWall设置" class="headerlink" title="PassWall设置"></a>PassWall设置</h3><p>按照上述步骤操作完之后，去PassWall先看看百度的连接状态，可以看到是联通的</p>
<p><img src="/2022/06/26/pve-all/image-20220904113452971.png" alt="image-20220904113452971"></p>
<p>接下来的设置比较简单，只需要添加订阅定制，然后自动订阅即可</p>
<p><img src="/2022/06/26/pve-all/image-20220904113547725.png" alt="image-20220904113547725"></p>
<p>配置完成后，直接连接，注意面板谷歌连接和ins连接不一定通（此时并不代表设置失败）</p>
<p><img src="/2022/06/26/pve-all/image-20220904113811088.png" alt="image-20220904113811088"></p>
<ul>
<li>可以在其他客户端直接改网关看看能否成功</li>
<li>也可以在LXC容器的网关处直接改成openwrt的地址，然后用<code>curl www.google.com</code>试试</li>
</ul>
<p><img src="/2022/06/26/pve-all/image-20220904115809196.png" alt="image-20220904115809196"></p>
<p>可以看到有内容返回，说明成功了</p>
<p><img src="/2022/06/26/pve-all/image-20220904120419484.png" alt="image-20220904120419484"></p>
<h3 id="smartdns-adgurad设置"><a href="#smartdns-adgurad设置" class="headerlink" title="smartdns+adgurad设置"></a>smartdns+adgurad设置</h3><p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/luckyyyyy/blog/issues/57%EF%BC%8C%E9%9D%9E%E5%B8%B8%E8%AF%A6%E7%BB%86%E7%9A%84%E6%8F%8F%E8%BF%B0%EF%BC%8C%E6%BA%90%E4%BB%A3%E7%A0%81%E5%87%BA%E5%A4%84">https://github.com/luckyyyyy/blog/issues/57，非常详细的描述，源代码出处</a></li>
<li><a target="_blank" rel="noopener" href="https://www.robinxb.com/posts/2022/setting-smartdns-with-adguardhome-and-passwall/%EF%BC%8C%E4%B8%8D%E9%94%99%E7%9A%84%E6%95%99%E7%A8%8B%EF%BC%8C%E5%8F%AF%E5%8F%82%E8%80%83">https://www.robinxb.com/posts/2022/setting-smartdns-with-adguardhome-and-passwall/，不错的教程，可参考</a></li>
<li><a target="_blank" rel="noopener" href="https://www.xtime.fun/smartdns.html%EF%BC%8C%E5%9B%BE%E6%96%87%E5%B9%B6%E8%8C%82">https://www.xtime.fun/smartdns.html，图文并茂</a></li>
</ol>
<p>实测配了之后，提升不大，因此可以考虑不使用</p>
<h1 id="ipv6设置"><a href="#ipv6设置" class="headerlink" title="ipv6设置"></a>ipv6设置</h1><h2 id="路由器以及光猫ipv6设置"><a href="#路由器以及光猫ipv6设置" class="headerlink" title="路由器以及光猫ipv6设置"></a>路由器以及光猫ipv6设置</h2><p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://post.smzdm.com/p/amxllm2d/%EF%BC%8C%E7%A7%BB%E5%8A%A8%E7%9A%84%E5%85%89%E7%8C%AB+%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F%E4%B8%8B%EF%BC%8C%E5%A6%82%E4%BD%95%E8%AE%BE%E7%BD%AEipv6%EF%BC%8C%E5%BE%88%E4%B8%8D%E9%94%99">https://post.smzdm.com/p/amxllm2d/，移动的光猫+桥接模式下，如何设置ipv6，很不错</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/479819582%EF%BC%8C%E7%9F%A5%E4%B9%8E%E7%9A%84%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E7%9C%8B%E5%A6%82%E6%9E%9C%E6%AD%A3%E7%A1%AE%E8%AE%BE%E7%BD%AE%E4%BA%86%EF%BC%8Cipv6%E5%9C%B0%E5%9D%80%E5%BA%94%E8%AF%A5%E6%98%AF%E6%80%8E%E4%B9%88%E6%A0%B7%E7%9A%84">https://www.zhihu.com/question/479819582，知乎的一个问题，可以看看如果正确设置了，ipv6地址应该是怎么样的</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/146528034%EF%BC%8C%E6%9B%B4%E8%AF%A6%E7%BB%86%E7%9A%84%E7%A7%BB%E5%8A%A8%E5%85%89%E7%8C%AB+%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F+%E5%BC%80%E5%90%AFipv6">https://zhuanlan.zhihu.com/p/146528034，更详细的移动光猫+桥接模式+开启ipv6</a></li>
</ol>
<p>光猫除了改桥接，还需要<strong>关闭ipv6防火墙</strong></p>
<p><img src="/2022/06/26/pve-all/image-20220904143705384.png" alt="image-20220904143705384"></p>
<p>使用的路由器是京东路由宝：</p>
<ul>
<li>打开开关</li>
<li><strong>关闭防火墙！！特别注意这一点！！！！！！</strong></li>
</ul>
<p><img src="/2022/06/26/pve-all/image-20220904143402964.png" alt="image-20220904143402964"></p>
<h2 id="pve-7-ipv6设置"><a href="#pve-7-ipv6设置" class="headerlink" title="pve 7 ipv6设置"></a>pve 7 ipv6设置</h2><p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.haiyun.me/archives/1416.html#comment-688">https://www.haiyun.me/archives/1416.html#comment-688</a> 感觉不一定好用，参考</li>
<li><a target="_blank" rel="noopener" href="https://forum.proxmox.com/threads/ipv6-slaac-after-upgrading-from-6-4-to-7-1-6.100501/">https://forum.proxmox.com/threads/ipv6-slaac-after-upgrading-from-6-4-to-7-1-6.100501/</a> 亲测有用！！</li>
</ol>
<p><img src="/2022/06/26/pve-all/image-20220904162018482.png" alt="image-20220904162018482"></p>
<p>添加下面这三行到<code>/etc/network/interfaces</code>即可</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#This line needs to be here so that the next two get recognized</span>
pre-up <span class="token builtin class-name">echo</span> <span class="token number">2</span> <span class="token operator">></span> /proc/sys/net/ipv6/conf/vmbr0/accept_ra
post-up <span class="token builtin class-name">echo</span> <span class="token number">2</span> <span class="token operator">></span> /proc/sys/net/ipv6/conf/vmbr0/accept_ra<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<p>修改完之后重启，最后<code>ifconfig</code>看到有<code>240x</code>开头的ip即可</p>
<p><img src="/2022/06/26/pve-all/image-20220904162331722.png" alt="image-20220904162331722"></p>
<p>尝试直接用<code>http://[ipv6 addr]:8006</code>访问，可以正常打开</p>
<h2 id="群晖ipv6设置"><a href="#群晖ipv6设置" class="headerlink" title="群晖ipv6设置"></a>群晖ipv6设置</h2><p>不需要设置，只要光猫和路由器设置好之后，装在pve里的dsm能够自动获取到</p>
<p><img src="/2022/06/26/pve-all/image-20220904162737410.png" alt="image-20220904162737410"></p>
<p>同样可以通过<code>http://[ipv6 addr]:5000</code>来访问，<strong>注意要用下面长的那串ipv6地址！！</strong></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://khalitt.github.io">Walter</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://khalitt.github.io/2022/06/26/pve-all/">https://khalitt.github.io/2022/06/26/pve-all/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/pve/">pve</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2021/10/16/hexo-algolia-usage/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">hexo algolia 使用</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#PVE%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">PVE安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8diskgenius%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89%E5%88%86%E5%8C%BA%E9%87%8D%E6%96%B0%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">1.1.</span> <span class="toc-text">用diskgenius删除所有分区重新格式化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#update-%E5%85%88%E7%94%A8rufus%E5%AE%89%E8%A3%85%EF%BC%8C%E5%86%8D%E5%88%87%E6%8D%A2%E5%88%B0ultraiso%E9%87%8D%E6%96%B0%E5%AE%89%E8%A3%85%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86"><span class="toc-number">1.2.</span> <span class="toc-text">update 先用rufus安装，再切换到ultraiso重新安装就可以了</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pve%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text">pve设置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ssh%E5%85%8D%E5%AF%86%E7%99%BB%E9%99%86"><span class="toc-number">2.1.</span> <span class="toc-text">ssh免密登陆</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.2.</span> <span class="toc-text">网络设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%8D%A2%E6%BA%90%EF%BC%88%E5%BC%BA%E7%83%88%E5%BB%BA%E8%AE%AE%E6%9B%B4%E6%8D%A2%EF%BC%89"><span class="toc-number">2.3.</span> <span class="toc-text">更换源（强烈建议更换）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#APT%E6%BA%90"><span class="toc-number">2.3.1.</span> <span class="toc-text">APT源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CT-template%E6%BA%90"><span class="toc-number">2.3.2.</span> <span class="toc-text">CT template源</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85proxychains-ng%E4%BB%A5%E5%8F%8ATxray"><span class="toc-number">2.4.</span> <span class="toc-text">安装proxychains-ng以及Txray</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#proxychains-ng%E5%AE%89%E8%A3%85"><span class="toc-number">2.4.1.</span> <span class="toc-text">proxychains-ng安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Txray%E5%AE%89%E8%A3%85"><span class="toc-number">2.4.2.</span> <span class="toc-text">Txray安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Txray%E4%BD%BF%E7%94%A8"><span class="toc-number">2.4.3.</span> <span class="toc-text">Txray使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#linux%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">linux基础使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8wget%E6%88%96%E8%80%85curl%E4%B8%8B%E8%BD%BDgithub-release"><span class="toc-number">3.1.</span> <span class="toc-text">用wget或者curl下载github release</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E7%BE%A4%E6%99%96"><span class="toc-number">4.</span> <span class="toc-text">安装群晖</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">4.1.</span> <span class="toc-text">创建虚拟机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E9%95%9C%E5%83%8F%EF%BC%88%E6%8E%A8%E8%8D%90%E6%96%B9%E6%B3%95%EF%BC%89"><span class="toc-number">4.2.</span> <span class="toc-text">导入镜像（推荐方法）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E6%9C%BAconf%EF%BC%88%E4%B8%8D%E6%8E%A8%E8%8D%90%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%89"><span class="toc-number">4.3.</span> <span class="toc-text">配置虚拟机conf（不推荐这个方法）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84grub"><span class="toc-number">4.4.</span> <span class="toc-text">修改镜像文件中的grub</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%A1%AC%E7%9B%98%E7%9B%B4%E9%80%9A"><span class="toc-number">4.5.</span> <span class="toc-text">设置硬盘直通</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E7%A1%AC%E7%9B%98%E7%9B%B4%E9%80%9A%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">4.5.1.</span> <span class="toc-text">关于硬盘直通的问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">4.6.</span> <span class="toc-text">遇到的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E7%9B%B4%E5%9C%A8%E8%BF%98%E5%8E%9F%E7%95%8C%E9%9D%A2%E5%BE%AA%E7%8E%AF"><span class="toc-number">4.6.1.</span> <span class="toc-text">一直在还原界面循环</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E6%B3%95%E8%AF%86%E5%88%AB%E5%8D%83%E5%85%86%E7%BD%91%E5%8D%A1%EF%BC%88%E5%AE%9E%E6%B5%8B%E5%B9%B6%E4%B8%8D%E6%98%AF%EF%BC%8Cvirtio%E8%83%BD%E5%A4%9F%E8%B7%91%E6%BB%A1%E5%8D%83%E5%85%86%EF%BC%89"><span class="toc-number">4.7.</span> <span class="toc-text">无法识别千兆网卡（实测并不是，virtio能够跑满千兆）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BE%A4%E6%99%96%E4%BD%BF%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">群晖使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E6%B1%A0"><span class="toc-number">5.1.</span> <span class="toc-text">存储池</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%B7%B2%E6%9C%89%E7%9A%84%E5%AD%98%E5%82%A8%E6%B1%A0"><span class="toc-number">5.1.1.</span> <span class="toc-text">导入已有的存储池</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AENFS"><span class="toc-number">5.2.</span> <span class="toc-text">设置NFS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%A5%BD%E7%9A%84%E6%8C%82%E8%BD%BD%E6%96%B9%E6%B3%95"><span class="toc-number">5.2.1.</span> <span class="toc-text">更好的挂载方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#20220904%E6%9B%B4%E6%96%B0%EF%BC%88%E4%BB%A5%E8%BF%99%E4%B8%AA%E4%B8%BA%E5%87%86%EF%BC%89"><span class="toc-number">5.2.2.</span> <span class="toc-text">20220904更新（以这个为准）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%92%8Cwindows-x2F-Mac%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB"><span class="toc-number">5.3.</span> <span class="toc-text">和windows&#x2F;Mac文件共享</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NFS-x2F-SMB%E9%80%9F%E5%BA%A6%E6%85%A2%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%88%E5%AE%9E%E6%B5%8B%E5%B9%B6%E4%B8%8D%E5%AD%98%E5%9C%A8%E9%80%9F%E5%BA%A6%E4%B8%8D%E5%90%8C%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%89"><span class="toc-number">5.3.1.</span> <span class="toc-text">NFS&#x2F;SMB速度慢的问题（实测并不存在速度不同的问题）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#portainer%E4%B8%AD%E6%B7%BB%E5%8A%A0%E4%BA%86%E8%87%AA%E5%8A%A8%E6%8C%82%E8%BD%BD%EF%BC%8C%E4%BD%86%E6%98%AFdocker-jellyfin%E7%BB%8F%E5%B8%B8%E6%B2%A1%E6%9C%89%E6%8C%82%E8%BD%BD%E6%88%90%E5%8A%9F%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">5.4.</span> <span class="toc-text">portainer中添加了自动挂载，但是docker jellyfin经常没有挂载成功的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DDNS"><span class="toc-number">5.5.</span> <span class="toc-text">DDNS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E5%B7%A5%E4%BD%9C"><span class="toc-number">5.5.1.</span> <span class="toc-text">前置工作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cloudflare%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%B8%8D%E6%8E%A8%E8%8D%90%EF%BC%8C%E5%B7%B2%E7%BB%8F%E6%97%A0%E6%B3%95%E9%80%9A%E8%BF%87api%E4%BF%AE%E6%94%B9freenom%E5%85%8D%E8%B4%B9%E5%9F%9F%E5%90%8D%E8%AE%B0%E5%BD%95"><span class="toc-number">5.5.1.1.</span> <span class="toc-text">cloudflare配置，不推荐，已经无法通过api修改freenom免费域名记录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dnspod"><span class="toc-number">5.5.2.</span> <span class="toc-text">dnspod</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ddns-go%E9%83%A8%E7%BD%B2"><span class="toc-number">5.5.3.</span> <span class="toc-text">ddns go部署</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E8%AE%BE%E7%BD%AE"><span class="toc-number">5.6.</span> <span class="toc-text">安全设置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PVE%E4%BD%BF%E7%94%A8windows%E7%B3%BB%E7%BB%9F"><span class="toc-number">6.</span> <span class="toc-text">PVE使用windows系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">6.1.</span> <span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Ewindows%E7%89%88%E6%9C%AC%E9%80%89%E6%8B%A9"><span class="toc-number">6.1.1.</span> <span class="toc-text">关于windows版本选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87ISO"><span class="toc-number">6.1.2.</span> <span class="toc-text">准备ISO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E5%AE%89%E8%A3%85"><span class="toc-number">6.1.3.</span> <span class="toc-text">开始安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5PE%E5%AE%89%E8%A3%85%EF%BC%88esd%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95%EF%BC%89"><span class="toc-number">6.1.3.1.</span> <span class="toc-text">进入PE安装（esd格式的安装方法）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E6%8C%82%E8%BD%BDiso%E5%AE%89%E8%A3%85"><span class="toc-number">6.1.3.2.</span> <span class="toc-text">直接挂载iso安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PS%EF%BC%9A%E5%A6%82%E4%BD%95%E7%9B%B4%E6%8E%A5%E4%BB%8E%E7%A1%AC%E7%9B%98%E4%BB%8E%E6%8C%82%E8%BD%BD%E8%80%8C%E4%B8%8D%E5%85%88%E4%BC%A0%E5%88%B0local-%E5%AE%9E%E6%B5%8B%E4%B8%8B%E9%9D%A2%E7%9A%84%E6%96%B9%E6%B3%95%E4%B8%8D%E8%A1%8C%EF%BC%8C%E5%BF%85%E9%A1%BB%E5%85%88%E5%BE%97%E5%AF%BC%E5%85%A5%E6%88%90cd-rom%E9%95%9C%E5%83%8F"><span class="toc-number">6.1.3.3.</span> <span class="toc-text">PS：如何直接从硬盘从挂载而不先传到local  实测下面的方法不行，必须先得导入成cd rom镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A3%E7%A1%AE%E5%81%9A%E6%B3%95"><span class="toc-number">6.1.3.3.1.</span> <span class="toc-text">正确做法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%AE%8C%E6%88%90%E5%90%8E%EF%BC%8C%E8%B0%83%E6%95%B4%E5%90%AF%E5%8A%A8%E9%A1%BA%E5%BA%8F"><span class="toc-number">6.1.4.</span> <span class="toc-text">安装完成后，调整启动顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A9%B1%E5%8A%A8%E5%AE%89%E8%A3%85"><span class="toc-number">6.1.5.</span> <span class="toc-text">驱动安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BF%80%E6%B4%BB"><span class="toc-number">6.1.6.</span> <span class="toc-text">激活</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">6.2.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#windows%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE"><span class="toc-number">6.2.1.</span> <span class="toc-text">windows系统设置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%BC%80%E5%90%AF%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E6%9D%83%E9%99%90"><span class="toc-number">6.2.1.1.</span> <span class="toc-text">虚拟机开启远程桌面权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E8%AE%BE%E7%BD%AE"><span class="toc-number">6.2.1.2.</span> <span class="toc-text">远程桌面设置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%82%E8%BD%BDNFS"><span class="toc-number">6.2.2.</span> <span class="toc-text">挂载NFS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#windows%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E6%8C%82%E8%BD%BD"><span class="toc-number">6.2.2.1.</span> <span class="toc-text">windows开机自动挂载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81"><span class="toc-number">6.2.2.2.</span> <span class="toc-text">中文乱码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%82%E8%BD%BDSMB"><span class="toc-number">6.2.3.</span> <span class="toc-text">挂载SMB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E7%9C%8B%E8%BF%99%E4%B8%AA%EF%BC%81%EF%BC%81%E6%9C%80%E4%BD%B3%E7%9A%84%E6%8C%82%E8%BD%BD%E6%96%B9%E6%B3%95"><span class="toc-number">6.2.4.</span> <span class="toc-text">直接看这个！！最佳的挂载方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%8D%93usb%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93"><span class="toc-number">6.2.5.</span> <span class="toc-text">安卓usb文件传输</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pve%E5%A4%87%E4%BB%BD"><span class="toc-number">7.</span> <span class="toc-text">pve备份</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LXC-jellyfin"><span class="toc-number">8.</span> <span class="toc-text">LXC jellyfin</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E8%B7%AF%E5%BE%84"><span class="toc-number">8.1.</span> <span class="toc-text">常用路径</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E8%A7%A3"><span class="toc-number">8.2.</span> <span class="toc-text">硬解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E6%9D%83%E9%99%90%E8%AE%BE%E7%BD%AE"><span class="toc-number">8.2.1.</span> <span class="toc-text">硬件权限设置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">8.3.</span> <span class="toc-text">问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%82%E8%BD%BDNFS%E7%9B%AE%E5%BD%95%E9%97%AE%E9%A2%98"><span class="toc-number">8.3.1.</span> <span class="toc-text">挂载NFS目录问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E5%90%8E%E7%9A%84%E5%AE%B9%E5%99%A8%E9%97%AE%E9%A2%98"><span class="toc-number">8.3.2.</span> <span class="toc-text">备份还原后的容器问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%AB%E6%8F%8F%E6%85%A2"><span class="toc-number">8.3.3.</span> <span class="toc-text">扫描慢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%AB%E6%8F%8F%E4%B8%8D%E5%87%BA%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">8.3.4.</span> <span class="toc-text">扫描不出本地文件夹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%84%9F%E8%A7%89%E5%A5%BD%E5%83%8F%E6%B2%A1%E6%9C%89%E8%A7%A3%E7%A0%81%EF%BC%9F"><span class="toc-number">8.3.5.</span> <span class="toc-text">感觉好像没有解码？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#docker%E4%BD%BF%E7%94%A8"><span class="toc-number">9.</span> <span class="toc-text">docker使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#jellyfin%EF%BC%88%E6%9B%B4%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA%EF%BC%89"><span class="toc-number">9.1.</span> <span class="toc-text">jellyfin（更推荐使用这个）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">9.1.1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5container%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE"><span class="toc-number">9.1.2.</span> <span class="toc-text">进入container进行配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#qbittorrent"><span class="toc-number">9.2.</span> <span class="toc-text">qbittorrent</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB%E9%85%8D%E7%BD%AE"><span class="toc-number">9.2.1.</span> <span class="toc-text">分类配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B1%86%E7%93%A3%E9%85%8D%E7%BD%AE"><span class="toc-number">9.2.2.</span> <span class="toc-text">豆瓣配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jackett"><span class="toc-number">9.3.</span> <span class="toc-text">jackett</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ChineseSubFinder"><span class="toc-number">9.4.</span> <span class="toc-text">ChineseSubFinder</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nas-tools-%E5%BC%BA%E7%83%88%E6%8E%A8%E8%8D%90%EF%BC%8C%E7%A5%9E%E5%99%A8%EF%BC%81"><span class="toc-number">9.5.</span> <span class="toc-text">nas-tools(强烈推荐，神器！)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LXC-xray"><span class="toc-number">10.</span> <span class="toc-text">LXC xray</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LXC-clash"><span class="toc-number">11.</span> <span class="toc-text">LXC clash</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%A1%E6%AD%BB%E5%9C%A8%E8%BF%99%E4%B8%AA%E7%95%8C%E9%9D%A2"><span class="toc-number">11.1.</span> <span class="toc-text">卡死在这个界面</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LXC-%E5%AE%B9%E5%99%A8"><span class="toc-number">12.</span> <span class="toc-text">LXC 容器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E7%89%B9%E6%9D%83lxc%E5%AE%B9%E5%99%A8"><span class="toc-number">12.1.</span> <span class="toc-text">新建特权lxc容器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81-1"><span class="toc-number">12.1.1.</span> <span class="toc-text">中文乱码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A%E7%BB%99LXC%E5%AE%B9%E5%99%A8%E7%A1%AC%E4%BB%B6"><span class="toc-number">12.2.</span> <span class="toc-text">显卡直通给LXC容器硬件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8pve%E5%AE%BF%E4%B8%BB%E6%9C%BA%E4%B8%8A%E5%AE%89%E8%A3%85%E9%A9%B1%E5%8A%A8"><span class="toc-number">12.2.1.</span> <span class="toc-text">在pve宿主机上安装驱动</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%88%E7%90%86%E6%AD%A5%E9%AA%A4"><span class="toc-number">12.2.1.1.</span> <span class="toc-text">合理步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E4%E4%BB%A3%E6%9E%B6%E6%9E%84%E7%9A%84cpu%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8ihd%EF%BC%88%E5%8D%B3intel-media-driver"><span class="toc-number">12.2.1.2.</span> <span class="toc-text">关于4代架构的cpu是否可以使用ihd（即intel-media-driver)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AElxc%E5%AE%B9%E5%99%A8%E7%9A%84conf%EF%BC%88%E5%85%B3%E9%94%AE%E6%AD%A5%E9%AA%A4%EF%BC%81%EF%BC%81%E7%9C%8B%E8%BF%99%E9%87%8C%EF%BC%81%EF%BC%81%EF%BC%89"><span class="toc-number">12.2.2.</span> <span class="toc-text">配置lxc容器的conf（关键步骤！！看这里！！）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8lxc%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%AE%89%E8%A3%85%E9%A9%B1%E5%8A%A8%E5%B9%B6%E9%85%8D%E7%BD%AE"><span class="toc-number">12.2.3.</span> <span class="toc-text">在lxc容器中安装驱动并配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E8%AE%BE%E7%BD%AE"><span class="toc-number">12.2.3.1.</span> <span class="toc-text">前置设置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9B%B4%E6%8D%A2%E6%BA%90"><span class="toc-number">12.2.3.1.1.</span> <span class="toc-text">更换源</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E9%A9%B1%E5%8A%A8"><span class="toc-number">12.2.3.2.</span> <span class="toc-text">安装驱动</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85portainer"><span class="toc-number">12.3.</span> <span class="toc-text">安装portainer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E5%BE%97%E5%AE%89%E8%A3%85docker"><span class="toc-number">12.3.1.</span> <span class="toc-text">首先得安装docker</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E7%AE%80%E5%8D%95%E7%9A%84%E5%81%9A%E6%B3%95%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%81%EF%BC%81%E7%9B%B4%E6%8E%A5%E4%B8%80%E9%94%AE%E6%90%9E%E5%AE%9A%EF%BC%89"><span class="toc-number">12.3.1.1.</span> <span class="toc-text">更简单的做法（推荐！！直接一键搞定）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9docker%E9%95%9C%E5%83%8F%E6%BA%90%EF%BC%88%E5%BC%BA%E7%83%88%E6%8E%A8%E8%8D%90%E6%94%B9%E4%B8%80%E4%B8%8B%EF%BC%89"><span class="toc-number">12.3.1.2.</span> <span class="toc-text">修改docker镜像源（强烈推荐改一下）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#20220828-update-ubuntu-22%E5%AE%89%E8%A3%85docker%E5%85%A8%E6%B5%81%E7%A8%8B%EF%BC%8C%E5%BC%BA%E7%83%88%E5%BB%BA%E8%AE%AE%E7%94%A8ubuntu%E6%9D%A5%E4%BD%9C%E4%B8%BAct%E6%A8%A1%E7%89%88%EF%BC%81%EF%BC%81"><span class="toc-number">12.3.2.</span> <span class="toc-text">20220828 update ubuntu 22安装docker全流程，强烈建议用ubuntu来作为ct模版！！</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%BB%BAubuntu-22%E7%9A%84LXC%E5%AE%B9%E5%99%A8"><span class="toc-number">12.3.2.1.</span> <span class="toc-text">新建ubuntu 22的LXC容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEconf%EF%BC%88%E6%A0%B8%E5%BF%83%EF%BC%81%EF%BC%81%EF%BC%89"><span class="toc-number">12.3.2.2.</span> <span class="toc-text">配置conf（核心！！）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Portainer"><span class="toc-number">12.3.3.</span> <span class="toc-text">安装Portainer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E9%97%AE%E9%A2%98"><span class="toc-number">12.3.4.</span> <span class="toc-text">docker问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-exec-it-lt-container-name-gt-bin-bash%E6%89%A7%E8%A1%8C%E5%A4%B1%E8%B4%A5"><span class="toc-number">12.3.4.1.</span> <span class="toc-text">docker exec -it &lt;container-name&gt; &#x2F;bin&#x2F;bash执行失败</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE"><span class="toc-number">12.4.</span> <span class="toc-text">设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%82%E8%BD%BDnfs"><span class="toc-number">12.4.1.</span> <span class="toc-text">挂载nfs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%8A%A8%E6%8C%82%E8%BD%BD"><span class="toc-number">12.4.1.1.</span> <span class="toc-text">设置自动挂载</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Portainer%E4%BD%BF%E7%94%A8"><span class="toc-number">13.</span> <span class="toc-text">Portainer使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE"><span class="toc-number">13.1.</span> <span class="toc-text">基础设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AEdockerhub%E8%B4%A6%E5%8F%B7"><span class="toc-number">13.1.1.</span> <span class="toc-text">设置dockerhub账号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E4%B8%AD%E7%A7%91%E5%A4%A7dockerhub%E6%BA%90"><span class="toc-number">13.1.2.</span> <span class="toc-text">新增中科大dockerhub源</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jellyfin%EF%BC%88%E4%B8%8D%E6%8E%A8%E8%8D%90%E4%B8%8B%E9%9D%A2%E7%9A%84%E7%89%B9%E4%BE%9B%E7%89%88%EF%BC%8C%E5%AE%9E%E6%B5%8B%E9%83%BD%E4%BC%9A%E7%A1%AC%E8%A7%A3%E5%A4%B1%E8%B4%A5%EF%BC%89%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E5%8F%82%E8%80%83docker-jellyfin"><span class="toc-number">13.2.</span> <span class="toc-text">jellyfin（不推荐下面的特供版，实测都会硬解失败）建议直接参考docker jellyfin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#jellyfin-docker%E7%89%88%E6%9C%AC%E9%80%89%E6%8B%A9"><span class="toc-number">13.2.1.</span> <span class="toc-text">jellyfin docker版本选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-number">13.2.2.</span> <span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E4%BE%9B%E7%89%88"><span class="toc-number">13.2.2.1.</span> <span class="toc-text">特供版</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#linuxserver%E7%89%88%E6%9C%AC"><span class="toc-number">13.2.2.2.</span> <span class="toc-text">linuxserver版本</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8"><span class="toc-number">13.2.3.</span> <span class="toc-text">启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98-1"><span class="toc-number">13.2.4.</span> <span class="toc-text">问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%87%E7%BA%A7Portainer"><span class="toc-number">13.3.</span> <span class="toc-text">升级Portainer</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%91%E6%98%A0%E5%83%8FCloud-image%E4%BD%BF%E7%94%A8"><span class="toc-number">14.</span> <span class="toc-text">云映像Cloud-image使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="toc-number">14.1.</span> <span class="toc-text">基础配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#debian"><span class="toc-number">14.2.</span> <span class="toc-text">debian</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#debian%E6%9B%B4%E6%8D%A2%E6%BA%90"><span class="toc-number">14.2.1.</span> <span class="toc-text">debian更换源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cloud-init%E5%AE%89%E8%A3%85"><span class="toc-number">14.2.2.</span> <span class="toc-text">cloud-init安装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98-2"><span class="toc-number">14.3.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ssh%E6%9C%8D%E5%8A%A1%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8"><span class="toc-number">14.4.</span> <span class="toc-text">ssh服务无法启动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Failed-to-start-OpenBSD-Secure-Shell-server"><span class="toc-number">14.4.1.</span> <span class="toc-text">Failed to start OpenBSD Secure Shell server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Permission-denied-publickey"><span class="toc-number">14.4.2.</span> <span class="toc-text">Permission denied (publickey).</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ip%E8%AE%BE%E7%BD%AE%E5%8F%AF%E8%83%BD%E6%97%A0%E6%95%88"><span class="toc-number">14.4.3.</span> <span class="toc-text">ip设置可能无效</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#openwrt%EF%BC%88%E6%97%81%E8%B7%AF%E7%94%B1%EF%BC%89"><span class="toc-number">15.</span> <span class="toc-text">openwrt（旁路由）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">15.1.</span> <span class="toc-text">新建虚拟机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-1"><span class="toc-number">15.2.</span> <span class="toc-text">设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C-%E6%8E%A5%E5%8F%A3%E8%AE%BE%E7%BD%AE"><span class="toc-number">15.2.1.</span> <span class="toc-text">网络-接口设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C-%E9%98%B2%E7%81%AB%E5%A2%99%E8%AE%BE%E7%BD%AE"><span class="toc-number">15.2.2.</span> <span class="toc-text">网络-防火墙设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PassWall%E8%AE%BE%E7%BD%AE"><span class="toc-number">15.2.3.</span> <span class="toc-text">PassWall设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#smartdns-adgurad%E8%AE%BE%E7%BD%AE"><span class="toc-number">15.2.4.</span> <span class="toc-text">smartdns+adgurad设置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ipv6%E8%AE%BE%E7%BD%AE"><span class="toc-number">16.</span> <span class="toc-text">ipv6设置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E4%BB%A5%E5%8F%8A%E5%85%89%E7%8C%ABipv6%E8%AE%BE%E7%BD%AE"><span class="toc-number">16.1.</span> <span class="toc-text">路由器以及光猫ipv6设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pve-7-ipv6%E8%AE%BE%E7%BD%AE"><span class="toc-number">16.2.</span> <span class="toc-text">pve 7 ipv6设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BE%A4%E6%99%96ipv6%E8%AE%BE%E7%BD%AE"><span class="toc-number">16.3.</span> <span class="toc-text">群晖ipv6设置</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Walter</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>